<ng-template #Upload>
    <nz-upload
        class="avatar-uploader" style="display: grid;"
        [nzListType]="uploadTemplate ? 'text' : 'picture'"
        [nzBeforeUpload]="beforeUpload" 
        [nzMultiple]="isMultiple"
        >

        <div *ngTemplateOutlet="uploadTemplate || UploadImage"></div>
        <ng-template #UploadImage>
            <div class="divBorder divGridCenter" [ngStyle]="{ 'width': borderWidth, 'height': borderHeight }">
                <div *ngTemplateOutlet="uploadTextTemplate || UploadText"></div>
            </div>
        </ng-template>

        <ng-template #UploadText>
            <div style="font-size: 16px; text-align: center;">
                <div class="ant-upload-text">Upload</div>
            </div>
        </ng-template>
    </nz-upload>
</ng-template>

<ng-template #Image let-item>
    <div class="divBorder imgGrid divGridCenter" 
        [ngStyle]="{ 'width': borderWidth, 'height': borderHeight }"
        (click)="controllModal(true, item.file)">

        <div class="imgGridClose">
            <i (click)="deleteFile(item.file.fileName)" nz-icon nzType="close" nzTheme="outline"></i>
        </div>

        <img [src]="item.file.fileUrl" style="max-width: 100%;" [ngStyle]="{ 'max-height': imageHeight }" />
    </div>
</ng-template>

<div [ngClass]="{ 'divGrid': inLine }" [ngStyle]="{ 'grid-template-columns': inLine ? 'repeat(auto-fit, ' + borderWidth + ')' : 'unset' }">
    <!-- 上傳按鈕(前) -->
    <ng-container *ngIf="canUpload && showFrontButton">
        <div *ngTemplateOutlet="Upload"></div>
    </ng-container>

    <!-- 傳入的圖片 -->
    <ng-container *ngFor="let item of existFiles; let i = index">
        <div *ngTemplateOutlet="imageTemplate || Image; context: {$implicit: { file: item, i: i }}"></div>
    </ng-container>

    <!-- 上傳的圖片 -->
    <ng-container *ngFor="let item of showFiles; let i = index">
        <div *ngTemplateOutlet="imageTemplate || Image; context: {$implicit: { file: item, i: i }}"></div>
    </ng-container>

    <!-- 上傳按鈕(後) -->
    <ng-container *ngIf="canUpload && !showFrontButton">
        <div *ngTemplateOutlet="Upload"></div>
    </ng-container>
    
</div>

<nz-modal [nzOkText]="null" nzCancelText="關閉" [nzWidth]="1000"
        [nzTitle]="'預覽圖'" 
        [(nzVisible)]="viewImage.isVisabled" 
        (nzOnCancel)="controllModal(false, viewImage.image)">
    <div class="divGridCenter">
        <img [src]="viewImage.image.fileUrl" style="max-width: 100%; max-height: 500px;" />
    </div>
</nz-modal>