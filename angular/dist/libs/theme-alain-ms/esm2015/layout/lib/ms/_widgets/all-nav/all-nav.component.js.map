{"version":3,"file":"all-nav.component.js","sourceRoot":"","sources":["../../../../../../../../../libs/theme-alain-ms/layout/src/lib/ms/_widgets/all-nav/all-nav.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { DOCUMENT } from '@angular/common';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ElementRef,\r\n  HostListener,\r\n  Inject,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChild,\r\n} from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { auditTime, takeUntil } from 'rxjs/operators';\r\n\r\nimport { BrandService } from '../../ms.service';\r\nimport { MSAllNav, MSAllNavData, MSAllNavService } from './all-nav.service';\r\n\r\nconst ANT_TIMEOUT = 150;\r\n\r\n/**\r\n * 顶部所有菜单组件，当单页布局模式时渲染\r\n */\r\n@Component({\r\n  selector: 'ms-all-nav',\r\n  templateUrl: './all-nav.component.html',\r\n  host: {\r\n    '[class.alain-ms__an-active]': 'validOpen',\r\n  },\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class MSAllNavComponent implements OnInit, OnDestroy {\r\n  private unsubscribe$ = new Subject<void>();\r\n\r\n  @ViewChild('dropdown', { static: true })\r\n  private dropdownEl!: ElementRef;\r\n  private loading = false;\r\n\r\n  $mouse = new Subject<{ i: MSAllNav; status: boolean }>();\r\n  open = false;\r\n  data!: MSAllNavData;\r\n\r\n  get allL2(): MSAllNav[] {\r\n    return this.srv.allL2;\r\n  }\r\n\r\n  get allPanel(): MSAllNav[] {\r\n    return this.srv.allPanel;\r\n  }\r\n\r\n  get validOpen(): boolean {\r\n    return this.data && this.open;\r\n  }\r\n\r\n  constructor(\r\n    private srv: MSAllNavService,\r\n    private brandSrv: BrandService,\r\n    private cdr: ChangeDetectorRef,\r\n    @Inject(DOCUMENT) private doc?: any,\r\n  ) {}\r\n\r\n  private handleOpen(status: boolean): void {\r\n    this.doc.body.classList[status ? 'add' : 'remove']('alain-ms__an-body');\r\n    this.open = status;\r\n    this.cdr.markForCheck();\r\n    this.updateHeight().load();\r\n  }\r\n\r\n  private load(): void {\r\n    if (this.loading || this.data) {\r\n      return;\r\n    }\r\n    this.loading = true;\r\n    this.srv.getData().subscribe((res) => {\r\n      this.data = res;\r\n      this.cdr.markForCheck();\r\n    });\r\n  }\r\n\r\n  private updateHeight(): this {\r\n    const height = window.innerHeight - this.brandSrv.topHeight;\r\n    (this.dropdownEl.nativeElement as HTMLElement).style.height = `${height}px`;\r\n    return this;\r\n  }\r\n\r\n  @HostListener('mouseenter')\r\n  _enter(): void {\r\n    if (!this.validOpen) {\r\n      this.handleOpen(true);\r\n    }\r\n  }\r\n\r\n  @HostListener('mouseleave')\r\n  _leave(): void {\r\n    this.handleOpen(false);\r\n  }\r\n\r\n  mouseHandle(i: MSAllNav, status: boolean): void {\r\n    this.$mouse.next({ i, status });\r\n  }\r\n\r\n  private handleMouse(i: MSAllNav): void {\r\n    this.srv.refreshActive(i);\r\n    this.cdr.detectChanges();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // this._enter();\r\n    const { $mouse, unsubscribe$ } = this;\r\n    $mouse\r\n      .asObservable()\r\n      .pipe(takeUntil(unsubscribe$), auditTime(ANT_TIMEOUT))\r\n      .subscribe((res) => this.handleMouse(res.i));\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    const { unsubscribe$ } = this;\r\n    unsubscribe$.next();\r\n    unsubscribe$.complete();\r\n  }\r\n}\r\n"]}