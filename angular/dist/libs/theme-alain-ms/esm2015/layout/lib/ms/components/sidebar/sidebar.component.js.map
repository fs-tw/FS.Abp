{"version":3,"file":"sidebar.component.js","sourceRoot":"","sources":["../../../../../../../../../libs/theme-alain-ms/layout/src/lib/ms/components/sidebar/sidebar.component.ts","../../../../../../../../../libs/theme-alain-ms/layout/src/lib/ms/components/sidebar/sidebar.component.html"],"names":[],"mappings":"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","sourcesContent":["import { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\r\nimport {\r\n  AfterViewInit,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ElementRef,\r\n  OnDestroy,\r\n  ViewChild,\r\n} from '@angular/core';\r\nimport { _HttpClient } from '@delon/theme';\r\nimport { NzMessageService } from 'ng-zorro-antd/message';\r\nimport { Observable } from 'rxjs';\r\nimport { Layout, MSProduct, MSProductCategory, MSProductI18n } from '../../../models';\r\nimport { LayoutStateService } from '../../../services/layout-state.service';\r\nimport { BrandService } from '../../ms.service';\r\nimport { MSProductService } from '../../services/product.service';\r\n\r\n@Component({\r\n  selector: 'ms-sidebar',\r\n  templateUrl: './sidebar.component.html',\r\n  host: {\r\n    '[class.alain-ms__sidebar]': 'true',\r\n    '[class.alain-ms__sidebar-showproduct]': 'showProduct',\r\n  },\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class MSSidebarComponent implements AfterViewInit, OnDestroy {\r\n  @ViewChild('categoryEl', { static: false })\r\n  private categoryEl!: ElementRef;\r\n\r\n  showProduct = false;\r\n  inited = false;\r\n\r\n  get store$(): Observable<Layout.State> {\r\n    return this.layoutStateService.getStore$();\r\n  }\r\n\r\n  get shortcuts$(): Observable<MSProduct[]> {\r\n    return this.layoutStateService.getShortcuts$();\r\n  }\r\n\r\n  get l(): MSProductI18n {\r\n    return this.srv.i18n;\r\n  }\r\n\r\n  q = '';\r\n  searchList?: MSProductCategory[][];\r\n  searchCategories: MSProductCategory[] = [];\r\n\r\n  constructor(\r\n    private layoutStateService:LayoutStateService,\r\n    private brand: BrandService,\r\n    private srv: MSProductService,\r\n    private cdr: ChangeDetectorRef\r\n  ) {\r\n    brand.setSidebar(true);\r\n  }\r\n\r\n  search(scroll: boolean = true): void {\r\n    const res = this.srv.search(this.q);\r\n    this.searchList = res.list;\r\n    this.searchCategories = res.categories;\r\n\r\n    this.cdr.detectChanges();\r\n\r\n    if (scroll) {\r\n      // wait angular render\r\n      setTimeout(() => {\r\n        // 滚动至顶部\r\n        this.categoryEl.nativeElement.scrollTop = 0;\r\n      });\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.srv.getData().subscribe((x) => {\r\n      this.inited = true;\r\n      this.search();\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.brand.setSidebar(false);\r\n  }\r\n}\r\n","<ng-container *ngIf=\"store$ | async as store\">\r\n  <div class=\"alain-ms__sidebar-wrap\">\r\n    <div\r\n      *ngIf=\"store.sidebarConfig.hasProductNav\"\r\n      class=\"alain-ms__sidebar-product-all\"\r\n      (click)=\"showProduct = !showProduct\"\r\n    >\r\n      <div class=\"alain-ms__sidebar-product alain-ms__sidebar-product-all-wrap\">\r\n        <i class=\"alain-ms__sidebar-product-icon\" nz-icon nzType=\"appstore\"></i>\r\n        <span class=\"alain-ms__sidebar-product-name\">{{ l.text }}</span>\r\n        <span class=\"alain-ms__sidebar-product-toolbar\">\r\n          <i nz-icon nzType=\"right\"></i>\r\n        </span>\r\n      </div>\r\n    </div>\r\n    <ul class=\"alain-ms__sidebar-product-quick\">\r\n      <li\r\n        class=\"alain-ms__sidebar-product\"\r\n        *ngFor=\"let i of shortcuts$ | async; let idx = index\"\r\n      >\r\n        <i\r\n          class=\"alain-ms__sidebar-product-icon {{ i.icon }} \"\r\n          [link-to]=\"i\"\r\n          (linkToChanged)=\"showProduct = false\"\r\n        ></i>\r\n        <a\r\n          class=\"alain-ms__sidebar-product-name\"\r\n          [link-to]=\"i\"\r\n          (linkToChanged)=\"showProduct = false\"\r\n        >\r\n          {{ i.name }}\r\n        </a>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n  <div class=\"alain-ms__sidebar-products\">\r\n    <div class=\"alain-ms__products\">\r\n      <div class=\"alain-ms__products-close\" (click)=\"showProduct = false\">\r\n        <i nz-icon nzType=\"close\"></i>\r\n      </div>\r\n      <div class=\"alain-ms__products-left\">\r\n        <div class=\"alain-ms__products-category-wrap\" #categoryEl>\r\n          <div class=\"d-flex\">\r\n            <div\r\n              *ngFor=\"let c of searchList\"\r\n              class=\"alain-ms__products-category-column\"\r\n            >\r\n              <div *ngFor=\"let p of c\" class=\"alain-ms__products-category\">\r\n                <h3\r\n                  class=\"alain-ms__products-category-title\"\r\n                  id=\"product-cat-{{ p._id }}\"\r\n                >\r\n                  {{ p.name }}\r\n                </h3>\r\n                <ul class=\"list-unstyled\">\r\n                  <li\r\n                    *ngFor=\"let i of p.products\"\r\n                    class=\"alain-ms__products-category-item\"\r\n                    [ngClass]=\"{\r\n                      'alain-ms__products-category-item-active': i.shortcut\r\n                    }\"\r\n                  >\r\n                    <a\r\n                      [link-to]=\"i\"\r\n                      (linkToChanged)=\"showProduct = false\"\r\n                      class=\"alain-ms__products-category-item-link\"\r\n                      >{{ i.name }}</a\r\n                    >\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"alain-ms__products-right\">\r\n        <nz-anchor\r\n          nzAffix=\"false\"\r\n          nzContainer=\".alain-ms__products-category-wrap\"\r\n          nzOffsetTop=\"150\"\r\n          nzShowInkInFixed=\"false\"\r\n        >\r\n          <nz-link\r\n            *ngFor=\"let i of searchCategories\"\r\n            nzHref=\"#product-cat-{{ i._id }}\"\r\n            [nzTitle]=\"i.name\"\r\n          ></nz-link>\r\n        </nz-anchor>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</ng-container>\r\n"]}