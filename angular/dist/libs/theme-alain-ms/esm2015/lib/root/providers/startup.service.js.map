{"version":3,"file":"startup.service.js","sourceRoot":"","sources":["../../../../../../../libs/theme-alain-ms/src/lib/root/providers/startup.service.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,iBAAiB,CAAC;AAC3C,OAAO,EAAE,UAAU,EAAE,MAAM,sBAAsB,CAAC;AAClD,OAAO,EAAE,eAAe,EAAE,MAAM,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AACpE,OAAO,EAAE,GAAG,EAAE,MAAM,MAAM,CAAC;AAC3B,OAAO,EAAE,UAAU,EAAE,MAAM,gBAAgB,CAAC;AAG5C,OAAO,EAAoB,eAAe,EAAE,YAAY,EAAE,MAAM,cAAc,CAAC;AAC/E,OAAO,EAAE,aAAa,EAAE,MAAM,oBAAoB,CAAC;AAEnD,gDAAgD;AAChD,0DAA0D;AAC1D,sDAAsD;AAEtD;;;GAGG;AAEH,MAAM,OAAO,cAAc;IACzB,YACE,OAAsB,EACd,cAA+B;IACvC,kCAAkC;IAC1B,UAAsB,EACJ,GAAQ;IAClC,uDAAuD;IAC/C,QAAsB;QALtB,mBAAc,GAAd,cAAc,CAAiB;QAE/B,eAAU,GAAV,UAAU,CAAY;QACJ,QAAG,GAAH,GAAG,CAAK;QAE1B,aAAQ,GAAR,QAAQ,CAAc;QAE9B,4CAA4C;IAC9C,CAAC;IAED,IAAI;QACF,2BAA2B;QAC3B,kDAAkD;QAClD,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;YAC7B,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;iBACjD,IAAI;YACH,kBAAkB;YAClB,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE;gBACvB,OAAO,CAAC,IAAI,CAAC,CAAC;gBACd,OAAO,CAAC,OAAO,CAAC,CAAC;YACnB,CAAC,CAAC,CACH;iBACA,SAAS,CACR,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE;gBACZ,6BAA6B;gBAC7B,kDAAkD;gBAElD,mBAAmB;gBACnB,MAAM,GAAG,GAAQ,OAAO,CAAC;gBACzB,mBAAmB;gBACnB,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACpC,oBAAoB;gBACpB,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBACtC,cAAc;gBACd,gCAAgC;gBAChC,OAAO;gBACP,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,EAAE,CAAC;gBAC3B,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,aAAa,CAAC;YACvC,CAAC,EACD,GAAG,EAAE,GAAE,CAAC,EACR,GAAG,EAAE;gBACH,OAAO,CAAC,IAAI,CAAC,CAAC;gBACd,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,CAAC,CACF,CAAC;QACN,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,aAAa;QACnB,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;QAClD,IAAI,EAAE,EAAE;YACN,EAAE,CAAC,MAAM,EAAE,CAAC;SACb;IACH,CAAC;;;YAzDF,UAAU;;;YAVF,aAAa;YADK,eAAe;YANjC,UAAU;4CAwBd,MAAM,SAAC,QAAQ;YAlBwB,YAAY;;AAsExD,0BAA0B;AAC1B,oCAAoC;AACpC,MAAM,UAAU,qBAAqB,CAAC,cAA8B;IAClE,OAAO,GAAG,EAAE,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC;AACrC,CAAC;AACD,MAAM,CAAC,MAAM,gBAAgB,GAAG;IAC9B,cAAc;IACd;QACE,OAAO,EAAE,eAAe;QACxB,UAAU,EAAE,qBAAqB;QACjC,IAAI,EAAE,CAAC,cAAc,CAAC;QACtB,KAAK,EAAE,IAAI;KACZ;CACF,CAAC;AACF,aAAa","sourcesContent":["import { DOCUMENT } from '@angular/common';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { APP_INITIALIZER, Inject, Injectable } from '@angular/core';\r\nimport { zip } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { ACLService } from '@delon/acl';\r\nimport { ALAIN_I18N_TOKEN, SettingsService, TitleService } from '@delon/theme';\r\nimport { NzIconService } from 'ng-zorro-antd/icon';\r\n\r\n// import { ICONS } from '../../../style-icons';\r\n// import { ICONS_AUTO } from '../../../style-icons-auto';\r\n// import { I18NService } from '../i18n/i18n.service';\r\n\r\n/**\r\n * 用于应用启动时\r\n * 一般用来获取应用所需要的基础数据等\r\n */\r\n@Injectable()\r\nexport class StartupService {\r\n  constructor(\r\n    iconSrv: NzIconService,\r\n    private settingService: SettingsService,\r\n    // private aclService: ACLService,\r\n    private httpClient: HttpClient,\r\n    @Inject(DOCUMENT) private doc: any,\r\n    // @Inject(ALAIN_I18N_TOKEN) private i18n: I18NService,\r\n    private titleSrv: TitleService,\r\n  ) {\r\n    // iconSrv.addIcon(...ICONS_AUTO, ...ICONS);\r\n  }\r\n\r\n  load(): Promise<any> {\r\n    // only works with promises\r\n    // https://github.com/angular/angular/issues/15088\r\n    return new Promise((resolve) => {\r\n      zip(this.httpClient.get(`assets/tmp/app-data.json`))\r\n        .pipe(\r\n          // 接收其他拦截器后产生的异常消息\r\n          catchError(([appData]) => {\r\n            resolve(null);\r\n            return [appData];\r\n          }),\r\n        )\r\n        .subscribe(\r\n          ([appData]) => {\r\n            // Load general language data\r\n            //this.i18n.load(this.i18n.currentLang, langData);\r\n\r\n            // application data\r\n            const res: any = appData;\r\n            // 应用信息：包括站点名、描述、年份\r\n            this.settingService.setApp(res.app);\r\n            // 用户信息：包括姓名、头像、邮箱地址\r\n            this.settingService.setUser(res.user);\r\n            // ACL：设置权限为全量\r\n            //this.aclService.setFull(true);\r\n            // 设置标题\r\n            this.titleSrv.default = '';\r\n            this.titleSrv.suffix = 'Ng Alain MS';\r\n          },\r\n          () => {},\r\n          () => {\r\n            resolve(null);\r\n            this.removeLoading();\r\n          },\r\n        );\r\n    });\r\n  }\r\n\r\n  private removeLoading(): void {\r\n    const el = this.doc.querySelector('#j-preloader');\r\n    if (el) {\r\n      el.remove();\r\n    }\r\n  }\r\n}\r\n// #region Startup Service\r\n// tslint:disable-next-line: typedef\r\nexport function StartupServiceFactory(startupService: StartupService) {\r\n  return () => startupService.load();\r\n}\r\nexport const APPINIT_PROVIDES = [\r\n  StartupService,\r\n  {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: StartupServiceFactory,\r\n    deps: [StartupService],\r\n    multi: true,\r\n  },\r\n];\r\n// #endregion"]}