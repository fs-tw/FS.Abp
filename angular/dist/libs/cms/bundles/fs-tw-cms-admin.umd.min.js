!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@abp/ng.core"),require("@angular/router"),require("@angular/common"),require("@angular/forms"),require("ngx-quill"),require("ng-zorro-antd/grid"),require("ng-zorro-antd/input"),require("ng-zorro-antd/table"),require("ng-zorro-antd/dropdown"),require("ng-zorro-antd/button"),require("ng-zorro-antd/icon"),require("ng-zorro-antd/modal"),require("ng-zorro-antd/radio"),require("ng-zorro-antd/upload"),require("ng-zorro-antd/spin"),require("ng-zorro-antd/card"),require("ng-zorro-antd/select"),require("ng-zorro-antd/date-picker"),require("ng-zorro-antd/tabs"),require("@delon/abc/se"),require("@fs-tw/cms/proxy"),require("@abp/ng.theme.shared"),require("lodash"),require("@fs-tw/theme-alain-ms/shared"),require("@fs-tw/theme-alain-ms/shared/extensions"),require("@abp/ng.theme.shared/extensions"),require("@fs-tw/cms/config")):"function"==typeof define&&define.amd?define("@fs-tw/cms/admin",["exports","@angular/core","@abp/ng.core","@angular/router","@angular/common","@angular/forms","ngx-quill","ng-zorro-antd/grid","ng-zorro-antd/input","ng-zorro-antd/table","ng-zorro-antd/dropdown","ng-zorro-antd/button","ng-zorro-antd/icon","ng-zorro-antd/modal","ng-zorro-antd/radio","ng-zorro-antd/upload","ng-zorro-antd/spin","ng-zorro-antd/card","ng-zorro-antd/select","ng-zorro-antd/date-picker","ng-zorro-antd/tabs","@delon/abc/se","@fs-tw/cms/proxy","@abp/ng.theme.shared","lodash","@fs-tw/theme-alain-ms/shared","@fs-tw/theme-alain-ms/shared/extensions","@abp/ng.theme.shared/extensions","@fs-tw/cms/config"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["fs-tw"]=e["fs-tw"]||{},e["fs-tw"].cms=e["fs-tw"].cms||{},e["fs-tw"].cms.admin={}),e.ng.core,e.i1,e.ng.router,e.ng.common,e.ng.forms,e.ngxQuill,e.grid,e.input,e.table,e.dropdown,e.button,e.icon,e.modal,e.radio,e.upload,e.spin,e.card,e.select,e.datePicker,e.tabs,e.se,e["fs-tw"].cms.proxy,e.ng_theme_shared,e._,e.shared,e.extensions,e.extensions$1,e["fs-tw"].cms.config)}(this,(function(e,t,n,r,i,o,a,l,s,d,p,c,u,g,m,f,h,y,b,v,z,x,I,S,w,F,M,k,T){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function C(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function B(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function P(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(B(arguments[t]));return e}Object.create;var q=function(){function e(){this.store=new n.InternalStore({})}return e.prototype.getBlog=function(){return this.store.sliceState((function(e){return e.Blog}))},e.prototype.setBlog=function(e){this.store.patch({Blog:e})},e}();q.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new q},token:q,providedIn:"root"}),q.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],q.ctorParameters=function(){return[]};var U=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();U.decorators=[{type:t.Component,args:[{selector:"fs-layout",template:"<router-outlet></router-outlet>\r\n",styles:[""]}]}],U.ctorParameters=function(){return[]};var D=function(){function e(e){this.injector=e,this.blogService=e.get(I.Fs.Cms.Blogs.BlogsApiService),this.postService=e.get(I.Fs.Cms.Posts.PostsApiService),this.directoriesApiService=e.get(I.Fs.Abp.File.Directories.DirectoriesApiService),this.fileDescriptorService=e.get(I.Volo.FileManagement.Files.FileDescriptorService)}return e.prototype.getBlogs=function(e){return this.blogService.getListByBlogGetList(e)},e.prototype.getBlogById=function(e){return this.blogService.getByBlogPrimaryKey({id:e})},e.prototype.createBlog=function(e){return this.blogService.createByBlogCreate(e)},e.prototype.updateBlog=function(e,t){return this.blogService.updateByBlogPrimaryKeyAndBlogUpdate({id:e},t)},e.prototype.findByProviderByKeyAndGroup=function(e,t){return this.directoriesApiService.findByProviderByKeyAndGroup(e,t)},e.prototype.deleteFile=function(e){return this.fileDescriptorService.deleteById(e)},e.prototype.getPostsByBlogId=function(e){return this.postService.getPostsByBlogIdByInput(e)},e.prototype.getPostById=function(e){return this.postService.getByPostPrimaryKey({id:e})},e.prototype.createPost=function(e){return this.postService.createByPostCreate(e)},e.prototype.updatePost=function(e,t){return this.postService.updateByPostPrimaryKeyAndPostUpdate({id:e},t)},e}();D.decorators=[{type:t.Injectable}],D.ctorParameters=function(){return[{type:t.Injector}]};var N=function(){function e(e,t,n){this.router=e,this.pageService=t,this.postStateService=n,this.postParams={skipCount:0,maxResultCount:10,keyword:"",blogId:null},this.posts=[],this.totalCount=0,this.loading=!1}return e.prototype.ngOnInit=function(){this.blog$=this.postStateService.getBlog(),this.onBlogChange()},e.prototype.onBlogChange=function(){var e=this;this.blog$.subscribe((function(t){e.blogId=null==t?null:t.id,e.blogName=null==t?"":t.displayName,e.postParams.blogId=e.blogId,e.changePage(1)}))},e.prototype.gotoDetail=function(e){e?this.router.navigate(["/cms/post/detail/"+e]):this.router.navigate(["/cms/post/detail"])},e.prototype.changePage=function(e){var t=this;this.postParams.skipCount=(e-1)*this.postParams.maxResultCount,this.loading=!0,this.pageService.getPostsByBlogId(this.postParams).subscribe((function(e){t.loading=!1,t.posts=e.items,t.totalCount=e.totalCount}))},e.prototype.deleteItem=function(e){},e}();N.decorators=[{type:t.Component,args:[{selector:"fs-main",template:'<nz-row nzGutter="16">\r\n  <nz-col nzSpan="8">\r\n    <fs-list></fs-list>\r\n  </nz-col>\r\n  <nz-col nzSpan="16">\r\n    <div>\r\n      <div class="mb-md">\r\n        <h5>類型：{{ blogName }}</h5>\r\n        <button nz-button nzType="primary" (click)="gotoDetail()" style="margin-right: 20px;">\r\n          新增\r\n        </button>\r\n        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton" style="width: 300px;">\r\n          <input type="text" [(ngModel)]="postParams.keyword" nz-input placeholder="輸入名稱" />\r\n        </nz-input-group>\r\n        <ng-template #suffixIconButton>\r\n          <button nz-button nzType="primary" (click)="changePage(1)" nzSearch>\r\n            <i nz-icon nzType="search"></i>\r\n          </button>\r\n        </ng-template>\r\n      </div>\r\n      <nz-table #listTable [nzData]="posts" nzSize="small" nzPageSize="10" [nzTotal]="totalCount"\r\n        [nzFrontPagination]="false" [nzLoading]="loading" (nzPageIndexChange)="changePage($event)" nzBordered>\r\n        <thead>\r\n          <tr>\r\n            <th nzWidth="110px"></th>\r\n            <th>啟用</th>\r\n            <th>標題</th>\r\n            <th>顯示模式</th>\r\n            <th>發佈日期</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <ng-container *ngFor="let item of listTable.data">\r\n            <tr class="bg-white">\r\n              <td nzShowExpand [(nzExpand)]="item.expand" nzWidth="110px">\r\n                <a nz-dropdown [nzDropdownMenu]="menu">\r\n                  {{ \'AbpIdentity::Actions\' | abpLocalization }}\r\n                  <i nz-icon nzType="down"></i>\r\n                </a>\r\n                <nz-dropdown-menu #menu="nzDropdownMenu">\r\n                  <ul nz-menu>\r\n                    <li nz-menu-item (click)="gotoDetail(item.id)">\r\n                      <a>編輯</a>\r\n                    </li>\r\n                    <li nz-menu-item (click)="deleteItem(item)">\r\n                      <a class="text-red">刪除</a>\r\n                    </li>\r\n                  </ul>\r\n                </nz-dropdown-menu>\r\n              </td>\r\n              <td>\r\n                <span *ngIf="item.published"><i nz-icon nzType="check" nzTheme="outline"></i></span>\r\n                <span *ngIf="!item.published"><i nz-icon nzType="close" nzTheme="outline"></i></span>\r\n              </td>\r\n              <td>\r\n                {{ item.title }}\r\n              </td>\r\n              <td>\r\n                <span *ngIf="item.displayMode == 0">內容</span>\r\n                <span *ngIf="item.displayMode == 1">連結</span>\r\n              </td>\r\n              <td>{{ item.published_At | date: \'yyyy-MM-dd HH:mm:ss\' }}</td>\r\n            </tr>\r\n\r\n            <tr [nzExpand]="item.expand">\r\n              <div>\r\n                <h3>副標題</h3>\r\n                <p>{{ item.subtitle || \'-\' }}</p>\r\n                <div *ngIf="item.displayMode == 0">\r\n                  <h3>內容：</h3>\r\n                  <quill-view [content]="item.content"></quill-view>\r\n                </div>\r\n                <div *ngIf="item.displayMode == 1">\r\n                  <h3>連結</h3>\r\n                  <p>{{ item.url }}</p>\r\n                </div>\r\n              </div>\r\n            </tr>\r\n          </ng-container>\r\n        </tbody>\r\n      </nz-table>\r\n    </div>\r\n  </nz-col>\r\n</nz-row>',styles:["nz-select{margin-right:8px;width:220px}.bg-white{background-color:#fff}"]}]}],N.ctorParameters=function(){return[{type:r.Router},{type:D},{type:q}]};var A=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.fileName=e,this.fileUrl=t},O=function(e,t,n){this.fileName=e,this.fileUrl=t,this.file=n,this.isUpload=null!=this.file},L=function(){this.image=new A,this.isVisabled=!1},G=function(){function e(e,t,n){var r=this;this.toasterService=e,this.environmentService=t,this.configStateService=n,this.imageWidth="104px",this.imageHeight="104px",this.borderWidth="104px",this.borderHeight="104px",this.maxImageCount=null,this.isMultiple=!0,this.inLine=!0,this.showFrontButton=!0,this.existFiles=[],this.deleteFiles=[],this.showFiles=[],this.uploadFiles=[],this.viewImage=new L,this.beforeUpload=function(e){if(!("image/jpeg"===e.type||"image/png"===e.type))return r.toasterService.error("圖片格式須為 jpg 或 png"),!1;var t=e.name,n=r.existFiles.findIndex((function(e){return e.fileName==t}))>-1,i=r.showFiles.findIndex((function(e){return e.fileName==t}))>-1;if(n||i)return!1;var o=e;return r.getBase64(o,(function(e){r.canUpload?(r.uploadFiles.push(o),r.showFiles.push(new A(t,e))):r.toasterService.error("圖片數已達上限")})),!1}}return Object.defineProperty(e.prototype,"canUpload",{get:function(){var e=this.existFiles.length+this.uploadFiles.length;return null==this.maxImageCount||e<this.maxImageCount},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){},e.prototype.ngOnChanges=function(){var e=this;this.existFiles=this.existFiles.filter((function(e){return e.fileUrl})).map((function(t){return new A(t.fileName,e.getHttpUrl(t.fileUrl))})),this.uploadFiles=[],this.showFiles=[]},e.prototype.clear=function(){this.existFiles=[],this.deleteFiles=[],this.uploadFiles=[],this.showFiles=[]},e.prototype.getHttpUrl=function(e){var t=e;return e.includes("http")?t:this.environmentService.getApiUrl()+e},e.prototype.getBase64=function(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result.toString())})),n.readAsDataURL(e)},e.prototype.deleteFile=function(e){var t=this.existFiles.findIndex((function(t){return t.fileName==e}))>-1,n=this.showFiles.findIndex((function(t){return t.fileName==e}))>-1;if(t)return this.existFiles=this.existFiles.filter((function(t){return t.fileName!=e})),void this.deleteFiles.push(e);n&&(this.showFiles=this.showFiles.filter((function(t){return t.fileName!=e})),this.uploadFiles=this.uploadFiles.filter((function(t){return t.name!=e})))},e.prototype.controllModal=function(e,t){void 0===t&&(t=new A),this.viewImage.image=t,this.viewImage.isVisabled=e},e.prototype.getDeleteFileNames=function(){return this.deleteFiles},e.prototype.getUploadFiles=function(){var e=this,t=this.existFiles.filter((function(t){return!e.deleteFiles.includes(t.fileName)})).map((function(e){return new O(e.fileName,e.fileUrl,null)})),n=this.uploadFiles.map((function(e){return new O(e.name,"",e)}));return t.concat(n)},e}();G.decorators=[{type:t.Component,args:[{selector:"image-picker",template:'<ng-template #Upload>\r\n    <nz-upload\r\n        class="avatar-uploader" style="display: grid;"\r\n        [nzListType]="uploadTemplate ? \'text\' : \'picture\'"\r\n        [nzBeforeUpload]="beforeUpload" \r\n        [nzMultiple]="isMultiple"\r\n        >\r\n\r\n        <div *ngTemplateOutlet="uploadTemplate || UploadImage"></div>\r\n        <ng-template #UploadImage>\r\n            <div class="divBorder divGridCenter" [ngStyle]="{ \'width\': borderWidth, \'height\': borderHeight }">\r\n                <div *ngTemplateOutlet="uploadTextTemplate || UploadText"></div>\r\n            </div>\r\n        </ng-template>\r\n\r\n        <ng-template #UploadText>\r\n            <div style="font-size: 16px; text-align: center;">\r\n                <div class="ant-upload-text">Upload</div>\r\n            </div>\r\n        </ng-template>\r\n    </nz-upload>\r\n</ng-template>\r\n\r\n<ng-template #Image let-item>\r\n    <div class="divBorder imgGrid divGridCenter" \r\n        [ngStyle]="{ \'width\': borderWidth, \'height\': borderHeight }"\r\n        (click)="controllModal(true, item.file)">\r\n\r\n        <div class="imgGridClose">\r\n            <i (click)="deleteFile(item.file.fileName)" nz-icon nzType="close" nzTheme="outline"></i>\r\n        </div>\r\n\r\n        <img [src]="item.file.fileUrl" style="max-width: 100%;" [ngStyle]="{ \'max-height\': imageHeight }" />\r\n    </div>\r\n</ng-template>\r\n\r\n<div [ngClass]="{ \'divGrid\': inLine }" [ngStyle]="{ \'grid-template-columns\': inLine ? \'repeat(auto-fit, \' + borderWidth + \')\' : \'unset\' }">\r\n    \x3c!-- 上傳按鈕(前) --\x3e\r\n    <ng-container *ngIf="canUpload && showFrontButton">\r\n        <div *ngTemplateOutlet="Upload"></div>\r\n    </ng-container>\r\n\r\n    \x3c!-- 傳入的圖片 --\x3e\r\n    <ng-container *ngFor="let item of existFiles; let i = index">\r\n        <div *ngTemplateOutlet="imageTemplate || Image; context: {$implicit: { file: item, i: i }}"></div>\r\n    </ng-container>\r\n\r\n    \x3c!-- 上傳的圖片 --\x3e\r\n    <ng-container *ngFor="let item of showFiles; let i = index">\r\n        <div *ngTemplateOutlet="imageTemplate || Image; context: {$implicit: { file: item, i: i }}"></div>\r\n    </ng-container>\r\n\r\n    \x3c!-- 上傳按鈕(後) --\x3e\r\n    <ng-container *ngIf="canUpload && !showFrontButton">\r\n        <div *ngTemplateOutlet="Upload"></div>\r\n    </ng-container>\r\n    \r\n</div>\r\n\r\n<nz-modal [nzOkText]="null" nzCancelText="關閉" [nzWidth]="1000"\r\n        [nzTitle]="\'預覽圖\'" \r\n        [(nzVisible)]="viewImage.isVisabled" \r\n        (nzOnCancel)="controllModal(false, viewImage.image)">\r\n    <div class="divGridCenter">\r\n        <img [src]="viewImage.image.fileUrl" style="max-width: 100%; max-height: 500px;" />\r\n    </div>\r\n</nz-modal>',styles:[".divBorder{display:block;border:1px dashed #d9d9d9;background:#fafafa}.divGridCenter{display:grid!important;place-items:center}.divGrid{display:grid;grid-gap:1rem}.imgGrid{border:1px solid #ddd;background-color:#f9f9f9;position:relative;cursor:pointer}.imgGridClose{top:-7px;position:absolute;text-align:right;font-size:18px;color:rgba(0,0,0,.55);width:100%}.imgGridClose i{padding:3px;border-radius:2px;opacity:.8;z-index:10;background-color:#ddd}::ng-deep .ant-upload.ant-upload-select-picture-card{margin:unset!important}::ng-deep .ant-upload.ant-upload-select-picture-card>.ant-upload{padding:unset!important}"]}]}],G.ctorParameters=function(){return[{type:S.ToasterService},{type:n.EnvironmentService},{type:n.ConfigStateService}]},G.propDecorators={imageWidth:[{type:t.Input}],imageHeight:[{type:t.Input}],borderWidth:[{type:t.Input}],borderHeight:[{type:t.Input}],maxImageCount:[{type:t.Input}],isMultiple:[{type:t.Input}],imageTemplate:[{type:t.Input}],uploadTemplate:[{type:t.Input}],uploadTextTemplate:[{type:t.Input}],inLine:[{type:t.Input}],showFrontButton:[{type:t.Input}],existFiles:[{type:t.Input}]};var R=function(){function e(e,t,n,r){this.router=e,this.activatedRoute=t,this.pageService=n,this.confirmationService=r,this.dateRange=[new Date,new Date],this.defaultImages=[],this.blogs=[],this.isLoading=!1,this.coverImage=""}return e.prototype.ngOnInit=function(){this.postId=this.activatedRoute.snapshot.paramMap.get("postId"),console.log(this.postId),this.getPost(),this.getBlogs()},e.prototype.getPost=function(){var e=this;this.data={blogId:null,title:"",subtitle:"",url:"",content:"",disable:!1,startTime:"",endTime:"",displayMode:0,sequence:0,attachmentFileUrls:[],postImages:[]},this.dateRange=[new Date,new Date],this.defaultImages=[new A("test","https://dummyimage.com/200x130/000/fff")],this.coverImage="test",this.postId&&this.pageService.getPostById(this.postId).subscribe((function(t){e.data=t;var n=t.startTime?new Date(t.startTime):new Date,r=t.endTime?new Date(t.endTime):new Date;e.dateRange=[n,r],e.defaultImages=t.postImages.map((function(e){return new A(e.url,e.url)}));var i=t.postImages.findIndex((function(e){return e.isCover}));i>-1&&(e.coverImage=t.postImages[i].url)}))},e.prototype.getBlogs=function(){var e=this;this.pageService.getBlogs({skipCount:0,maxResultCount:999,sorting:"sequence"}).subscribe((function(t){e.blogs=t.items}))},e.prototype.deleteFile=function(e){var t=this;this.confirmationService.warn("確定刪除 "+e+" 嗎？","系統訊息").subscribe((function(n){n==S.Confirmation.Status.confirm&&t.defaultImagePicker.deleteFile(e)}))},e.prototype.save=function(){var e=this,t=w.cloneDeep(this.data);t.startTime=this.dateRange[0].toLocalISOString(),t.endTime=this.dateRange[1].toLocalISOString(),(this.postId?this.pageService.updatePost(this.postId,t):this.pageService.createPost(t)).subscribe((function(t){e.router.navigate(["cms/post"])}))},e}();R.decorators=[{type:t.Component,args:[{selector:"fs-detail",template:'<nz-spin nzTip="載入中..." [nzSpinning]="isLoading">\r\n\r\n  <nz-card>\r\n\r\n    <form nz-form #f="ngForm" se-container="1" labelWidth="150" *ngIf="data">\r\n      <se label="公告類型">\r\n        <nz-select [(ngModel)]="data.blogId" name="blogId" required>\r\n          <nz-option *ngFor="let item of blogs" [nzValue]="item.id" [nzLabel]="item.displayName"></nz-option>\r\n        </nz-select>\r\n      </se>\r\n      <se label="前台顯示" required>\r\n        <nz-radio-group [(ngModel)]="data.disable" name="disable">\r\n          <label nz-radio [nzValue]="false">開</label>\r\n          <label nz-radio [nzValue]="true">關</label>\r\n        </nz-radio-group>\r\n      </se>\r\n      <se label="發佈時間" required>\r\n        \x3c!-- <nz-range-picker nzShowTime nzFormat="yyyy/MM/dd HH:mm:ss" name="dateRange" [(ngModel)]="dateRange"\r\n          [nzAllowClear]="false"></nz-range-picker> --\x3e\r\n        <nz-date-picker nzShowTime name="startDate" [nzAllowClear]="false"\r\n          [(ngModel)]="dateRange[0]"></nz-date-picker>\r\n\r\n        <nz-date-picker nzShowTime name="endDate" [nzAllowClear]="true"\r\n          [(ngModel)]="dateRange[1]"></nz-date-picker>\r\n        \x3c!-- <nz-date-picker nzShowTime name="published_At" nzPlaceHolder="Select Time" [nzAllowClear]="false"\r\n          [(ngModel)]="data.published_At"></nz-date-picker> --\x3e\r\n      </se>\r\n      <se label="標題" error="必填" required>\r\n        <input type="text" nz-input [(ngModel)]="data.title" name="title" required>\r\n      </se>\r\n      <se label="副標題">\r\n        <input type="text" nz-input [(ngModel)]="data.subtitle" name="Subtitle">\r\n      </se>\r\n      <se label="顯示類型" required>\r\n        <nz-select [(ngModel)]="data.displayMode" name="type">\r\n          <nz-option [nzValue]="0" nzLabel="內文"></nz-option>\r\n          <nz-option [nzValue]="1" nzLabel="連結"></nz-option>\r\n        </nz-select>\r\n      </se>\r\n\r\n      <se label="內文" *ngIf="data.displayMode == 0">\r\n\r\n        <quill-editor [(ngModel)]="data.content" [ngModelOptions]="{standalone: true}">\r\n          <div quill-editor-toolbar>\r\n            <span class="ql-formats">\r\n              <button class="ql-bold"></button>\r\n              <button class="ql-italic"></button>\r\n              <button class="ql-underline"></button>\r\n              <button class="ql-strike"></button>\r\n            </span>\r\n\r\n            <span class="ql-formats">\r\n              <button class="ql-list" value="ordered"></button>\r\n              <button class="ql-list" value="bullet"></button>\r\n            </span>\r\n\r\n            <span>\r\n              <button type="button" class="ql-header" value="1"></button>\r\n              <button type="button" class="ql-header" value="2"></button>\r\n            </span>\r\n\r\n            <span class="ql-formats">\r\n              <button class="ql-image"></button>\r\n            </span>\r\n\r\n          </div>\r\n        </quill-editor>\r\n      </se>\r\n\r\n\r\n      <se label="連結" *ngIf="data.displayMode == 1">\r\n        <input type="text" nz-input [(ngModel)]="data.url" name="url">\r\n      </se>\r\n\r\n      <se label="上傳檔案" optionalHelp="建議圖片比例：1080X608">\r\n        <nz-tabset>\r\n          <nz-tab nzTitle="圖片">\r\n            <se>\r\n              <image-picker #DefaultImagePicker [existFiles]="defaultImages" [uploadTextTemplate]="Upload"\r\n                [imageTemplate]="Image" [inLine]="false" borderWidth="100%" borderHeight="132px"></image-picker>\r\n            </se>\r\n          </nz-tab>\r\n          <nz-tab nzTitle="附件">\r\n            <se>\r\n              <fs-upload-file [existFileUrls]="data.attachmentFileUrls"></fs-upload-file>\r\n            </se>\r\n          </nz-tab>\r\n        </nz-tabset>\r\n      </se>\r\n\r\n      \x3c!-- <se label="標籤">\r\n        <fs-tag [postId]="data.id" [postTags]="data.postTags"></fs-tag>\r\n      </se> --\x3e\r\n\r\n      <se>\r\n        <button nz-button nzType="primary" (click)="save()" [disabled]="f.invalid">\r\n          {{ !data.id ? \'建立\' : \'更新\' }}\r\n        </button>\r\n      </se>\r\n    </form>\r\n  </nz-card>\r\n\r\n</nz-spin>\r\n\r\n\r\n<ng-template #Upload>\r\n  <div style="text-align: center;">\r\n    <div style="color: #26d7eb; font-size: 48px;">\r\n      <i nz-icon nzType="inbox" style="display: block;"></i>\r\n    </div>\r\n    <div style="font-size: 16px;">\r\n      請將檔案拖移至此，或按下此圖示上傳檔案\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n\r\n<ng-template #Image let-item>\r\n  <div nz-row style="border: 1px solid #ddd; border-right: 0px; margin-top: 5px;">\r\n    <div nz-col nzSpan="4" class="imgItemDiv">\r\n      <a class="text-blue" *ngIf="coverImage != item.file.fileName" (click)="coverImage = item.file.fileName">設為封面圖</a>\r\n      <i nz-icon nzType="check" nzTheme="outline" style="font-size: 16px;" class="text-green"\r\n        *ngIf="coverImage == item.file.fileName"></i>\r\n    </div>\r\n    <div nz-col nzSpan="8" class="imgItemDiv" style="cursor: pointer;"\r\n      (click)="defaultImagePicker.controllModal(true, item.file)">\r\n      <div style="width: 100%;">\r\n        <img [src]="item.file.fileUrl" style="max-height: 40px;" />\r\n      </div>\r\n    </div>\r\n    <div nz-col nzSpan="8" class="imgItemDiv">\r\n      <div style="width: 100%;">{{ item.file.fileName }}</div>\r\n    </div>\r\n    <div nz-col nzSpan="4" class="imgItemDiv">\r\n      <div style="width: 100%;">\r\n        <a class="text-red" (click)="deleteFile(item.file.fileName)">刪除</a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</ng-template>',styles:[".unchecked{border:1px solid #e4e4e4}.unchecked:hover{background-color:#00c1de;color:#fff}.imgItemDiv{border-right:1px solid #ddd;padding:5px;height:50px;display:grid;place-items:center}"]}]}],R.ctorParameters=function(){return[{type:r.Router},{type:r.ActivatedRoute},{type:D},{type:S.ConfirmationService}]},R.propDecorators={defaultImagePicker:[{type:t.ViewChild,args:["DefaultImagePicker"]}]};var j=function(){function e(e){this.postStateService=e}return e.prototype.resolve=function(){return this.postStateService.setBlog(null)},e}();j.decorators=[{type:t.Injectable}],j.ctorParameters=function(){return[{type:q}]};var V=[{path:"",component:U,resolve:{RouteConfig:j},children:[{path:"",component:N},{path:"detail",component:R},{path:"detail/:postId",component:R}]}],E=function(){};E.decorators=[{type:t.NgModule,args:[{imports:[r.RouterModule.forChild(V)],exports:[r.RouterModule],providers:[j]}]}];var H=function(){function e(e){this.environmentService=e}return e.prototype.transform=function(e){return this.environmentService.getApiUrl()+"/api/file-management/file-descriptor/file-content?id="+e},e}();H.decorators=[{type:t.Pipe,args:[{name:"getFileById"}]}],H.ctorParameters=function(){return[{type:n.EnvironmentService}]};var W=[H],_=function(){};_.decorators=[{type:t.NgModule,args:[{declarations:P(W),imports:[F.ThemeAlainMsSharedModule,M.UiExtensionsModule],exports:P(W,[F.ThemeAlainMsSharedModule,M.UiExtensionsModule])}]}];var $=function(){function e(e,t){this.restService=e,this.environmentService=t}return e.prototype.getFileUrl=function(e){return e?this.environmentService.getApiUrl()+"/api/file-management/file-descriptor/file-content?id="+e:""},e.prototype.uploadFile=function(e,t){var n=new FormData;return n.append("relativePath",null),n.append("file",e),n.append("name",e.name),n.append("type",e.type),this.restService.request({method:"POST",url:"/api/file-management/file-descriptor/upload",body:n,params:{directoryId:t}})},e}();$.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new $(t.ɵɵinject(n.RestService),t.ɵɵinject(n.EnvironmentService))},token:$,providedIn:"root"}),$.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],$.ctorParameters=function(){return[{type:n.RestService},{type:n.EnvironmentService}]};var K=function(){function e(e,t,n,r,i,o,a){var l=this;this.extensionsService=e,this.pageService=t,this.injector=n,this.list=r,this.fileService=i,this.toasterService=o,this.postStateService=a,this.datas=[],this.count=0,this.defaultImages=[],this.isVisible=!1,this.selected={},this.pageService.findByProviderByKeyAndGroup("FS.Cms.Blogs").subscribe((function(e){l.directory=e}))}return e.prototype.ngOnInit=function(){var e=this;this.extensionsService.Actions$["Cms::FS.Cms.Blogs"].subscribe((function(t){switch(t.name){case"Edit":e.edit(t.record.id);break;case"Delete":e.deleteBlog(t.record);break;case"Add":e.add()}})),this.reload()},e.prototype.reload=function(){var e=this,t={skipCount:0,maxResultCount:10,sorting:"sequence"};this.list.hookToQuery((function(n){return t,e.pageService.getBlogs(t)})).subscribe((function(t){e.datas=t.items,e.count=t.totalCount}))},e.prototype.showDetail=function(e){null!=e&&this.postStateService.setBlog(e)},e.prototype.deleteBlog=function(e){console.log(e),alert("開發中…")},e.prototype.handleCancel=function(){this.isVisible=!1},e.prototype.save=function(){var e=this;if(this.form.valid){var t=this.defaultImagePicker.getUploadFiles(),n=(this.defaultImagePicker.getDeleteFileNames(),"");if(t.length>0){if(this.selected.iconUrl==t[0].fileName)return void this.saveBlog(this.selected.iconUrl);this.fileService.uploadFile(t[0].file,this.directory.id).subscribe((function(t){n=t.id,e.saveBlog(n)}))}else this.saveBlog("")}},e.prototype.saveBlog=function(e){var t,n=this,r=Object.assign(Object.assign(Object.assign({},this.selected),this.form.value),{id:this.selected.id});r.iconUrl=e,r.id?t=this.pageService.updateBlog(r.id,r):(r.no=r.displayName,t=this.pageService.createBlog(r)),t.subscribe((function(e){n.toasterService.success("修改成功！"),n.isVisible=!1,n.list.get()}))},e.prototype.add=function(){this.selected={},this.defaultImages=[],this.openModal()},e.prototype.edit=function(e){var t=this;this.pageService.getBlogById(e).subscribe((function(e){t.selected=e,t.defaultImages=[],e.iconUrl&&t.defaultImages.push(new A(e.iconUrl,t.fileService.getFileUrl(e.iconUrl))),t.openModal()}))},e.prototype.buildForm=function(){var e=new k.FormPropData(this.injector,this.selected);this.form=null,this.form=k.generateFormFromProps(e)},e.prototype.openModal=function(){this.buildForm(),this.isVisible=!0},e}();K.decorators=[{type:t.Component,args:[{selector:"fs-list",template:'<div>\r\n  <div class="mb-md">\r\n    \x3c!-- <fs-create (onSave)="reload()" style="margin-right: 10px;"></fs-create> --\x3e\r\n    <button nz-button [nzType]="\'primary\'"  style="margin-right: 10px;" (click)="add()"><span>+建立</span></button>\r\n\r\n    <button nz-button [nzType]="\'primary\'" (click)="showDetail(null)">\r\n      全部\r\n    </button>\r\n  </div>\r\n\r\n  <nz-extensible-table [data]="datas" [recordsTotal]="count" [list]="list" [haveSelect]="true"\r\n    (select)="showDetail($event)">\r\n  </nz-extensible-table>\r\n\r\n</div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<nz-modal [(nzVisible)]="isVisible" nzTitle="blog" (nzOnCancel)="handleCancel()" [nzFooter]="footer">\r\n  <form [formGroup]="form" *ngIf="form" (ngSubmit)="save()" validateOnSubmit>\r\n    <abp-extensible-form *ngIf="form" [selectedRecord]="selected"></abp-extensible-form>\r\n    <div class="form-group">\r\n      <label for="exampleInputEmail1">圖示(建議圖片大小為 40*30，僅能上傳 jpg, png)</label>\r\n      <image-picker #DefaultImagePicker [existFiles]="defaultImages" [maxImageCount]="1" imageWidth="40px"\r\n        imageHeight="30px" borderWidth="80px" borderHeight="60px"></image-picker>\r\n    </div>\r\n  </form>\r\n</nz-modal>\r\n\r\n<ng-template #footer>\r\n  <button nz-button nzType="default" (click)="handleCancel()">取消</button>\r\n  <button nz-button nzType="primary" (click)="save()">儲存</button>\r\n</ng-template>',providers:[n.ListService,{provide:k.EXTENSIONS_IDENTIFIER,useValue:"Cms::FS.Cms.Blogs"}],styles:[".listSelected{background-color:#e6f2ff!important}nz-list-item{font-size:15px}.bg-white{background-color:#fff}"]}]}],K.ctorParameters=function(){return[{type:T.ExtensionsService},{type:D},{type:t.Injector},{type:n.ListService},{type:$},{type:S.ToasterService},{type:q}]},K.propDecorators={defaultImagePicker:[{type:t.ViewChild,args:["DefaultImagePicker"]}]};var Q=function(){function e(e){this.pageService=e,this.onSave=new t.EventEmitter,this.isVisible=!1,this.defaultImages=[]}return e.prototype.ngOnInit=function(){},e.prototype.showModal=function(){var e=this;this.data={no:"",displayName:"",description:"",parentId:null,disable:!1,listStyle:"",sequence:0,url:"",iconUrl:""},this.defaultImages=[],this.blogId&&this.pageService.getBlogById(this.blogId).subscribe((function(t){e.data=t,e.defaultImages=[new A("test","https://dummyimage.com/140x98/000/fff")]})),this.isVisible=!0},e.prototype.handleCancel=function(){this.isVisible=!1},e.prototype.save=function(){var e,t,n=this,r=this.defaultImagePicker.getUploadFiles(),i=this.defaultImagePicker.getDeleteFileNames(),o=new FormData;try{for(var a=C(r),l=a.next();!l.done;l=a.next()){var s=l.value;s.isUpload&&o.append("files[]",s.file,"")}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}console.log(r,i);var d,p=w.cloneDeep(this.data);this.blogId?d=this.pageService.updateBlog(this.blogId,p):(p.no=p.displayName,d=this.pageService.createBlog(p)),d.subscribe((function(){n.onSave.emit(),n.handleCancel()}),(function(e){console.error(e)}))},e}();Q.decorators=[{type:t.Component,args:[{selector:"fs-create",template:'<button nz-button [nzType]="\'primary\'" *ngIf="!blogId" (click)="showModal()"><span>+建立</span></button>\r\n<a (click)="showModal()" *ngIf="blogId">編輯</a>\r\n\r\n<nz-modal [(nzVisible)]="isVisible" nzTitle="建立消息種類" (nzOnCancel)="handleCancel()" [nzFooter]="footer">\r\n  <form nz-form #f="ngForm" se-container="1" labelWidth="100" *ngIf="data">\r\n    <se label="是否啟用" required>\r\n      <nz-radio-group [(ngModel)]="data.disable" name="disable">\r\n        <label nz-radio [nzValue]="false">是</label>\r\n        <label nz-radio [nzValue]="true">否</label>\r\n      </nz-radio-group>\r\n    </se>\r\n\r\n    \x3c!-- *ngIf="!isParent" --\x3e\r\n    <ng-container>\r\n      <se label="順序" required> \r\n        <input type="number" nz-input [(ngModel)]="data.sequence" name="no" required>\r\n      </se>\r\n      <se label="名稱" required>\r\n        <input type="text" nz-input [(ngModel)]="data.displayName" name="displayName" required>\r\n      </se>\r\n      <se label="說明">\r\n        <textarea nz-input type="text" nz-input [(ngModel)]="data.description" name="description"></textarea>\r\n      </se>\r\n  \r\n      <se label="網址">\r\n        <input type="text" nz-input [(ngModel)]="data.url" name="url">\r\n      </se>\r\n  \r\n      <se label="列表樣式" optionalHelp="目前可設定有效設定值為 2、3、4 預設為 3">\r\n        <input type="text" nz-input [(ngModel)]="data.listStyle" name="listStyle">\r\n      </se>\r\n  \r\n      <se label="圖示" optionalHelp="建議圖片大小為 40*30，僅能上傳 jpg, png">\r\n        <image-picker #DefaultImagePicker\r\n            [existFiles]="defaultImages"\r\n            [maxImageCount]="1"\r\n            imageWidth="40px"\r\n            imageHeight="30px"\r\n            borderWidth="80px"\r\n            borderHeight="60px"></image-picker>\r\n      </se>\r\n    </ng-container>\r\n    \r\n\r\n  </form>\r\n</nz-modal>\r\n\r\n\r\n<ng-template #footer>\r\n  <button nz-button nzType="default" (click)="handleCancel()">取消</button>\r\n  <button nz-button nzType="primary" (click)="save()" [disabled]="data.sequence == null || !data.displayName">儲存</button>\r\n</ng-template>',styles:[".uploadImgGrid{display:grid;place-items:center;border:1px dashed #ddd;padding:10px;justify-content:center;background-color:#fafafa}"]}]}],Q.ctorParameters=function(){return[{type:D}]},Q.propDecorators={defaultImagePicker:[{type:t.ViewChild,args:["DefaultImagePicker"]}],blogId:[{type:t.Input}],onSave:[{type:t.Output}]};var X=function(){function e(e){var t=this;this.confirmationService=e,this.existFileUrls=[],this.fileList=[],this.beforeUpload=function(e){return t.existFileUrls.findIndex((function(t){return t==e.name}))>-1||t.fileList.findIndex((function(t){return t.name==e.name}))>-1||(t.fileList=t.fileList.concat(e)),!1}}return e.prototype.ngOnInit=function(){},e.prototype.delete=function(e){var t=this;this.confirmationService.warn("確認刪除嗎？","系統訊息").subscribe((function(n){n===S.Confirmation.Status.confirm&&(t.existFileUrls=t.existFileUrls.filter((function(t){return t!=e})))}))},e}();X.decorators=[{type:t.Component,args:[{selector:"fs-upload-file",template:'\r\n\r\n<nz-upload nzType="drag" [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" [nzMultiple]="true">\r\n  <p class="ant-upload-drag-icon">\r\n    <i nz-icon nzType="inbox"></i>\r\n  </p>\r\n  <p class="ant-upload-text">點擊此處或將檔案拖拽至此處進行上傳</p>\r\n</nz-upload>\r\n\r\n<div class="my-md"></div>\r\n<nz-table #basicTable [nzData]="existFileUrls"  nzSimple="false" nzSize="small" [nzShowPagination]="false">\r\n  <thead>\r\n    <tr>\r\n      <th>檔名</th>\r\n      <th>-</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr *ngFor="let data of existFileUrls">\r\n      <td>\r\n        \x3c!-- <a [href]="getUrl(data)">{{getFileName(data)}}</a> --\x3e\r\n        <a>{{ data }}</a>\r\n      </td>\r\n      <td>\r\n        <a (click)="delete(data)" class="text-red">刪除</a>\r\n      </td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</nz-table>',styles:[""]}]}],X.ctorParameters=function(){return[{type:S.ConfirmationService}]},X.propDecorators={existFileUrls:[{type:t.Input}]};var J=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();J.decorators=[{type:t.Component,args:[{selector:"fs-tag",template:'<br>\r\n\x3c!-- <label>搜尋標籤：</label>\r\n\r\n<nz-select nzSize=\'small\' [(ngModel)]="select" nzAllowClear nzShowSearch style="width: 200px;">\r\n    <nz-option-group *ngFor="let item of tagGroups" [nzLabel]="item.tagGroupName">\r\n        <nz-option *ngFor="let i of item.tags" [nzLabel]="i.name" [nzValue]="i.name"></nz-option>\r\n    </nz-option-group>\r\n</nz-select>\r\n<button nz-button nzType="primary" nzShape="circle"><i nz-icon nzType="search"></i></button> --\x3e\r\n\r\n\x3c!-- 只啟用以下 table --\x3e\r\n\x3c!-- <nz-table #smallTable nzBordered nzSize="small" [nzData]="tagGroups" style="width: 500px;" nzShowPagination="false"\r\n    style="margin-top: 10px;">\r\n    <thead>\r\n        <tr>\r\n            <th nzAlign="center">分類</th>\r\n            <th nzAlign="center">標籤</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr *ngFor="let tagGroup of smallTable.data; let parentIndex = index" class="bg-white">\r\n            <td>\r\n                <nz-tag [nzColor]="tagGroup.check? \'green\' : \'default\'" (click)="checkParent(tagGroup)" class="pointer">\r\n                    <i nz-icon [nzType]="tagGroup.check ? \'check\' : \'close\'"></i>\r\n                    {{ tagGroup.tagGroupName }}\r\n                </nz-tag>\r\n            </td>\r\n            <td>               \r\n                <nz-tag *ngFor="let tagItem of tagGroup.tags; let childIndex = index" class="pointer"\r\n                    [nzColor]="tagItem.check ? \'green\' : \'default\'" (click)="checkChild(tagItem)">\r\n                    <i nz-icon [nzType]="tagItem.check ? \'check\' : \'close\'"></i>\r\n                    {{ tagItem.name }}\r\n                </nz-tag>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n</nz-table> --\x3e\r\n\r\n\x3c!-- <button (click)="save()">check</button> --\x3e',styles:[""]}]}];var Y=[l.NzGridModule,s.NzInputModule,d.NzTableModule,p.NzDropDownModule,c.NzButtonModule,u.NzIconModule,g.NzModalModule,m.NzRadioModule,f.NzUploadModule,h.NzSpinModule,y.NzCardModule,b.NzSelectModule,v.NzDatePickerModule,z.NzTabsModule,x.SEModule],Z=function(){function e(){}return e.forChild=function(){return{ngModule:e,providers:[]}},e.forLazy=function(){return new n.LazyModuleFactory(e.forChild())},e.forEarly=function(){return new n.LazyModuleFactory(e.forChild())},e}();Z.decorators=[{type:t.NgModule,args:[{declarations:[U,N,R,K,Q,X,J,G],imports:P([_,n.CoreModule,o.ReactiveFormsModule,o.FormsModule,i.CommonModule,E],Y,[a.QuillModule.forRoot()]),providers:[D]}]}];var ee=Z.forEarly,te=[{path:"",pathMatch:"full",redirectTo:"post"},{path:"",canActivate:[n.AuthGuard,n.PermissionGuard],children:[{path:"post",loadChildren:ee}]}],ne=function(){};ne.decorators=[{type:t.NgModule,args:[{imports:[r.RouterModule.forChild(te)],exports:[r.RouterModule]}]}];var re=function(){function e(){}return e.forChild=function(){return{ngModule:e,providers:[]}},e.forLazy=function(){return new n.LazyModuleFactory(e.forChild())},e}();re.decorators=[{type:t.NgModule,args:[{imports:[_,n.CoreModule,ne],exports:[_]}]}],e.CmsAdminModule=re,e.FileService=$,e.GetFileByIdPipe=H,e.SharedModule=_,e.ɵa=ne,e.ɵb=Z,e.ɵc=U,e.ɵd=N,e.ɵe=D,e.ɵf=q,e.ɵg=R,e.ɵh=K,e.ɵi=$,e.ɵj=Q,e.ɵk=X,e.ɵl=J,e.ɵm=G,e.ɵn=j,e.ɵo=E,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=fs-tw-cms-admin.umd.min.js.map