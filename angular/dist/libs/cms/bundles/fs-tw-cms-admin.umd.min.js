!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@abp/ng.core"),require("@angular/router"),require("@angular/common"),require("@angular/forms"),require("ngx-quill"),require("ng-zorro-antd/grid"),require("ng-zorro-antd/input"),require("ng-zorro-antd/table"),require("ng-zorro-antd/dropdown"),require("ng-zorro-antd/button"),require("ng-zorro-antd/icon"),require("ng-zorro-antd/modal"),require("ng-zorro-antd/radio"),require("ng-zorro-antd/upload"),require("ng-zorro-antd/spin"),require("ng-zorro-antd/card"),require("ng-zorro-antd/select"),require("ng-zorro-antd/date-picker"),require("ng-zorro-antd/tabs"),require("@delon/abc/se"),require("@abp/ng.theme.shared"),require("@abp/ng.theme.shared/extensions"),require("@fs-tw/cms/config"),require("rxjs"),require("@fs-tw/cms/proxy"),require("lodash"),require("date-fns"),require("@fs-tw/theme-alain-ms/shared"),require("@fs-tw/theme-alain-ms/shared/extensions"),require("rxjs/operators"),require("ng-zorro-antd/tag")):"function"==typeof define&&define.amd?define("@fs-tw/cms/admin",["exports","@angular/core","@abp/ng.core","@angular/router","@angular/common","@angular/forms","ngx-quill","ng-zorro-antd/grid","ng-zorro-antd/input","ng-zorro-antd/table","ng-zorro-antd/dropdown","ng-zorro-antd/button","ng-zorro-antd/icon","ng-zorro-antd/modal","ng-zorro-antd/radio","ng-zorro-antd/upload","ng-zorro-antd/spin","ng-zorro-antd/card","ng-zorro-antd/select","ng-zorro-antd/date-picker","ng-zorro-antd/tabs","@delon/abc/se","@abp/ng.theme.shared","@abp/ng.theme.shared/extensions","@fs-tw/cms/config","rxjs","@fs-tw/cms/proxy","lodash","date-fns","@fs-tw/theme-alain-ms/shared","@fs-tw/theme-alain-ms/shared/extensions","rxjs/operators","ng-zorro-antd/tag"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["fs-tw"]=e["fs-tw"]||{},e["fs-tw"].cms=e["fs-tw"].cms||{},e["fs-tw"].cms.admin={}),e.ng.core,e.i1,e.ng.router,e.ng.common,e.ng.forms,e.ngxQuill,e.grid,e.input,e.table,e.dropdown,e.button,e.icon,e.modal,e.radio,e.upload,e.spin,e.card,e.select,e.datePicker,e.tabs,e.se,e.ng_theme_shared,e.extensions,e["fs-tw"].cms.config,e.rxjs,e["fs-tw"].cms.proxy,e._,e.dns,e.shared,e.extensions$1,e.rxjs.operators,e.tag)}(this,(function(e,t,n,r,i,o,a,s,l,d,p,u,c,g,f,m,h,y,v,b,z,I,x,S,F,w,T,M,C,k,B,P,D){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function N(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function q(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(N(arguments[t]));return e}Object.create;var U=function(){function e(){this.store=new n.InternalStore({})}return e.prototype.getBlog=function(){return this.store.sliceState((function(e){return e.Blog}))},e.prototype.setBlog=function(e){this.store.patch({Blog:e})},e}();U.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new U},token:U,providedIn:"root"}),U.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],U.ctorParameters=function(){return[]};var O=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();O.decorators=[{type:t.Component,args:[{selector:"fs-layout",template:"<router-outlet></router-outlet>\r\n",styles:[""]}]}],O.ctorParameters=function(){return[]};var A=function(){function e(e){this.injector=e,this.blogService=e.get(T.Fs.Cms.Blogs.BlogsApiService),this.postService=e.get(T.Fs.Cms.Posts.PostsApiService),this.directoriesApiService=e.get(T.Fs.Abp.File.Directories.DirectoriesApiService),this.fileDescriptorService=e.get(T.Volo.FileManagement.Files.FileDescriptorService)}return e.prototype.getBlogs=function(e){return this.blogService.getListByBlogGetList(e)},e.prototype.getBlogById=function(e){return this.blogService.getByBlogPrimaryKey({id:e})},e.prototype.createBlog=function(e){return this.blogService.createByBlogCreate(e)},e.prototype.updateBlog=function(e,t){return this.blogService.updateByBlogPrimaryKeyAndBlogUpdate({id:e},t)},e.prototype.deleteBlog=function(e){return this.blogService.deleteByBlogPrimaryKey({id:e})},e.prototype.findByProviderByKeyAndGroup=function(e,t){return this.directoriesApiService.findByProviderByKeyAndGroup(e,t)},e.prototype.deleteFile=function(e){return this.fileDescriptorService.deleteById(e)},e.prototype.getFileDescriptor=function(e){return this.fileDescriptorService.getById(e)},e.prototype.getPostsByBlogId=function(e){return this.postService.getPostsByBlogIdByInput(e)},e.prototype.getPostById=function(e){return this.postService.getByPostPrimaryKey({id:e})},e.prototype.createPost=function(e){return this.postService.createByPostCreate(e)},e.prototype.updatePost=function(e,t){return this.postService.updateByPostPrimaryKeyAndPostUpdate({id:e},t)},e.prototype.deletePost=function(e){return this.postService.deleteByPostPrimaryKey({id:e})},e}();A.decorators=[{type:t.Injectable}],A.ctorParameters=function(){return[{type:t.Injector}]};var L=function(){function e(e,t,n,r,i,o,a,s){this.extensionsService=e,this.router=t,this.toasterService=n,this.confirmationService=r,this.pageService=i,this.list=o,this.activatedRoute=a,this.postStateService=s,this.postParams={skipCount:0,maxResultCount:10,keyword:"",blogId:null},this.posts=[],this.totalCount=0}return e.prototype.ngOnInit=function(){var e=this;this.extensionsService.Actions$["Cms::FS.Cms.PostManagement"].subscribe((function(t){switch(t.name){case"Edit":e.gotoDetail(t.record.id);break;case"Delete":e.deleteItem(t.record)}})),this.blog$=this.postStateService.getBlog(),this.onBlogChange()},e.prototype.onBlogChange=function(){var e=this;this.sub=this.blog$.subscribe((function(t){e.blogId=null==t?null:t.id,e.blogName=null==t?"全部":t.displayName,e.postParams.blogId=e.blogId,e.hookToQuery()}))},e.prototype.gotoDetail=function(e){e?this.router.navigate(["/cms/post/detail/"+e]):this.router.navigate(["/cms/post/detail"],{queryParams:{blogId:this.postParams.blogId}})},e.prototype.hookToQuery=function(){var e=this;this.hookToQueryScribe&&this.hookToQueryScribe.unsubscribe();this.hookToQueryScribe=this.list.hookToQuery((function(t){return t.keyword=e.postParams.keyword,t.blogId=e.postParams.blogId,e.pageService.getPostsByBlogId(t)})).subscribe((function(t){e.posts=t.items,e.totalCount=t.totalCount}))},e.prototype.deleteItem=function(e){var t=this;this.confirmationService.warn("確認要刪除嗎？","系統訊息",{cancelText:"取消",yesText:"確定"}).subscribe((function(n){if(n===x.Confirmation.Status.confirm){var r=e.attachmentFileInfos.map((function(e){return e.fileId})),i=e.postImages.map((function(e){return e.imageId})),o=r.concat(i).map((function(e){return t.pageService.deleteFile(e)}));w.forkJoin(o).subscribe(),t.pageService.deletePost(e.id).subscribe((function(e){t.toasterService.success("刪除成功！"),t.list.get()}))}}))},e.prototype.ngOnDestroy=function(){this.hookToQueryScribe&&this.hookToQueryScribe.unsubscribe(),this.sub&&this.sub.unsubscribe()},e}();L.decorators=[{type:t.Component,args:[{selector:"fs-main",template:'<nz-row nzGutter="16">\r\n  <nz-col nzSpan="8">\r\n    <fs-list></fs-list>\r\n  </nz-col>\r\n  <nz-col nzSpan="16">\r\n    <div>\r\n      <div class="mb-md">\r\n        <h5>類型：{{ blogName }}</h5>\r\n        <button nz-button nzType="primary" (click)="gotoDetail()" style="margin-right: 20px;">\r\n          {{\'AbpIdentityServer::Add\'|abpLocalization}}\r\n        </button>\r\n        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton" style="width: 300px;">\r\n          <input type="text" [(ngModel)]="postParams.keyword" nz-input placeholder="輸入名稱" />\r\n        </nz-input-group>\r\n        <ng-template #suffixIconButton>\r\n          <button nz-button nzType="primary" (click)="hookToQuery()" nzSearch>\r\n            <i nz-icon nzType="search"></i>\r\n          </button>\r\n        </ng-template>\r\n      </div>\r\n      <nz-extensible-table [data]="posts" [scroll]="{x:\'600px\'}" [recordsTotal]="totalCount" [list]="list"\r\n        [haveRowDetail]="false">\r\n     \r\n        <ng-template row-detail-template let-node>\r\n          <div>\r\n            <h3>副標題</h3>\r\n            <p>{{ node.subtitle || \'-\' }}</p>\r\n            <div *ngIf="node.displayMode == 0">\r\n              <h3>內容：</h3>\r\n              <quill-view [content]="node.content"></quill-view>\r\n            </div>\r\n            <div *ngIf="node.displayMode == 1">\r\n              <h3>連結</h3>\r\n              <p>{{ node.url }}</p>\r\n            </div>\r\n          </div>\r\n        </ng-template>\r\n        \r\n      </nz-extensible-table>\r\n      \x3c!-- <nz-table #listTable [nzData]="posts" nzSize="small" nzPageSize="10" [nzTotal]="totalCount"\r\n        [nzFrontPagination]="false" [nzLoading]="loading" (nzPageIndexChange)="changePage($event)" nzBordered>\r\n        <thead>\r\n          <tr>\r\n            <th nzWidth="110px"></th>\r\n            <th>啟用</th>\r\n            <th>標題</th>\r\n            <th>顯示模式</th>\r\n            <th>發佈日期</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <ng-container *ngFor="let item of listTable.data">\r\n            <tr class="bg-white">\r\n              <td nzShowExpand [(nzExpand)]="item.expand" nzWidth="110px">\r\n                <a nz-dropdown [nzDropdownMenu]="menu">\r\n                  {{ \'AbpIdentity::Actions\' | abpLocalization }}\r\n                  <i nz-icon nzType="down"></i>\r\n                </a>\r\n                <nz-dropdown-menu #menu="nzDropdownMenu">\r\n                  <ul nz-menu>\r\n                    <li nz-menu-item (click)="gotoDetail(item.id)">\r\n                      <a>編輯</a>\r\n                    </li>\r\n                    <li nz-menu-item (click)="deleteItem(item)">\r\n                      <a class="text-red">刪除</a>\r\n                    </li>\r\n                  </ul>\r\n                </nz-dropdown-menu>\r\n              </td>\r\n              <td>\r\n                <span *ngIf="item.published"><i nz-icon nzType="check" nzTheme="outline"></i></span>\r\n                <span *ngIf="!item.published"><i nz-icon nzType="close" nzTheme="outline"></i></span>\r\n              </td>\r\n              <td>\r\n                {{ item.title }}\r\n              </td>\r\n              <td>\r\n                <span *ngIf="item.displayMode == 0">內容</span>\r\n                <span *ngIf="item.displayMode == 1">連結</span>\r\n              </td>\r\n              <td>{{ item.published_At | date: \'yyyy-MM-dd HH:mm:ss\' }}</td>\r\n            </tr>\r\n\r\n            <tr [nzExpand]="item.expand">\r\n              <div>\r\n                <h3>副標題</h3>\r\n                <p>{{ item.subtitle || \'-\' }}</p>\r\n                <div *ngIf="item.displayMode == 0">\r\n                  <h3>內容：</h3>\r\n                  <quill-view [content]="item.content"></quill-view>\r\n                </div>\r\n                <div *ngIf="item.displayMode == 1">\r\n                  <h3>連結</h3>\r\n                  <p>{{ item.url }}</p>\r\n                </div>\r\n              </div>\r\n            </tr>\r\n          </ng-container>\r\n        </tbody>\r\n      </nz-table> --\x3e\r\n    </div>\r\n  </nz-col>\r\n</nz-row>',providers:[n.ListService,{provide:S.EXTENSIONS_IDENTIFIER,useValue:"Cms::FS.Cms.PostManagement"}],styles:["nz-select{margin-right:8px;width:220px}.bg-white{background-color:#fff}"]}]}],L.ctorParameters=function(){return[{type:F.ExtensionsService},{type:r.Router},{type:x.ToasterService},{type:x.ConfirmationService},{type:A},{type:n.ListService},{type:r.ActivatedRoute},{type:U}]};var R=function(){function e(e){this.environmentService=e}return e.prototype.transform=function(e){return this.environmentService.getApiUrl()+"/api/file-management/file-descriptor/file-content?id="+e},e}();R.decorators=[{type:t.Pipe,args:[{name:"getFileById"}]}],R.ctorParameters=function(){return[{type:n.EnvironmentService}]};var G=[R],j=function(){};j.decorators=[{type:t.NgModule,args:[{declarations:q(G),imports:[k.ThemeAlainMsSharedModule,B.UiExtensionsModule],exports:q(G,[k.ThemeAlainMsSharedModule,B.UiExtensionsModule])}]}];var E=function(){function e(e,t){this.restService=e,this.environmentService=t}return e.prototype.getFileUrl=function(e){return e?this.environmentService.getApiUrl()+"/api/file/files/file-content?id="+e:""},e.prototype.uploadFile=function(e,t){var n=new FormData;return n.append("relativePath",null),n.append("file",e),n.append("name",e.name),n.append("type",e.type),this.restService.request({method:"POST",url:"/api/file-management/file-descriptor/upload",body:n,params:{directoryId:t}})},e.prototype.getFileBlobById=function(e){return this.restService.request({method:"GET",url:"/api/file/files/file-content",params:{id:e},responseType:"blob"})},e}();E.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new E(t.ɵɵinject(n.RestService),t.ɵɵinject(n.EnvironmentService))},token:E,providedIn:"root"}),E.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],E.ctorParameters=function(){return[{type:n.RestService},{type:n.EnvironmentService}]};var V=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.fileName=e,this.fileUrl=t},H=function(e,t,n){this.fileName=e,this.fileUrl=t,this.file=n,this.isUpload=null!=this.file},$=function(){this.image=new V,this.isVisabled=!1},W=function(){function e(e,t,n){var r=this;this.toasterService=e,this.environmentService=t,this.fileService=n,this.imageWidth="104px",this.imageHeight="104px",this.borderWidth="104px",this.borderHeight="104px",this.maxImageCount=null,this.isMultiple=!0,this.inLine=!0,this.showFrontButton=!0,this.existFiles=[],this.deleteFiles=[],this.showFiles=[],this.uploadFiles=[],this.viewImage=new $,this.beforeUpload=function(e){if(!("image/jpeg"===e.type||"image/png"===e.type))return r.toasterService.error("圖片格式須為 jpg 或 png"),!1;var t=e.name,n=r.existFiles.findIndex((function(e){return e.fileName==t}))>-1,i=r.showFiles.findIndex((function(e){return e.fileName==t}))>-1;if(n||i)return!1;var o=e;return r.getBase64(o,(function(e){r.canUpload?(r.uploadFiles.push(o),r.showFiles.push(new V(t,e))):r.toasterService.error("圖片數已達上限")})),!1}}return Object.defineProperty(e.prototype,"canUpload",{get:function(){var e=this.existFiles.length+this.uploadFiles.length;return null==this.maxImageCount||e<this.maxImageCount},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){},e.prototype.ngOnChanges=function(){var e=this;this.existFiles=this.existFiles.filter((function(e){return e.fileUrl})).map((function(t){return new V(t.fileName,e.fileService.getFileUrl(t.fileUrl))})),this.uploadFiles=[],this.showFiles=[],this.deleteFiles=[]},e.prototype.clear=function(){this.existFiles=[],this.deleteFiles=[],this.uploadFiles=[],this.showFiles=[]},e.prototype.getBase64=function(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result.toString())})),n.readAsDataURL(e)},e.prototype.deleteFile=function(e){var t=this.existFiles.findIndex((function(t){return t.fileName==e}))>-1,n=this.showFiles.findIndex((function(t){return t.fileName==e}))>-1;if(t)return this.existFiles=this.existFiles.filter((function(t){return t.fileName!=e})),void this.deleteFiles.push(e);n&&(this.showFiles=this.showFiles.filter((function(t){return t.fileName!=e})),this.uploadFiles=this.uploadFiles.filter((function(t){return t.name!=e})))},e.prototype.controllModal=function(e,t){void 0===t&&(t=new V),this.viewImage.image=t,this.viewImage.isVisabled=e},e.prototype.getDeleteFileNames=function(){return this.deleteFiles},e.prototype.getNewUploadFiles=function(){return this.uploadFiles.map((function(e){return new H(e.name,"",e)}))},e.prototype.getUploadFiles=function(){var e=this,t=this.existFiles.filter((function(t){return!e.deleteFiles.includes(t.fileName)})).map((function(e){return new H(e.fileName,e.fileUrl,null)})),n=this.uploadFiles.map((function(e){return new H(e.name,"",e)}));return t.concat(n)},e}();W.decorators=[{type:t.Component,args:[{selector:"image-picker",template:'<ng-template #Upload>\r\n    <nz-upload\r\n        class="avatar-uploader" style="display: grid;"\r\n        [nzListType]="uploadTemplate ? \'text\' : \'picture\'"\r\n        [nzBeforeUpload]="beforeUpload" \r\n        [nzMultiple]="isMultiple"\r\n        >\r\n\r\n        <div *ngTemplateOutlet="uploadTemplate || UploadImage"></div>\r\n        <ng-template #UploadImage>\r\n            <div class="divBorder divGridCenter" [ngStyle]="{ \'width\': borderWidth, \'height\': borderHeight }">\r\n                <div *ngTemplateOutlet="uploadTextTemplate || UploadText"></div>\r\n            </div>\r\n        </ng-template>\r\n\r\n        <ng-template #UploadText>\r\n            <div style="font-size: 16px; text-align: center;">\r\n                <div class="ant-upload-text">Upload</div>\r\n            </div>\r\n        </ng-template>\r\n    </nz-upload>\r\n</ng-template>\r\n\r\n<ng-template #Image let-item>\r\n    <div class="divBorder imgGrid divGridCenter" \r\n        [ngStyle]="{ \'width\': borderWidth, \'height\': borderHeight }"\r\n        (click)="controllModal(true, item.file)">\r\n\r\n        <div class="imgGridClose">\r\n            <i (click)="deleteFile(item.file.fileName)" nz-icon nzType="close" nzTheme="outline"></i>\r\n        </div>\r\n\r\n        <img [src]="item.file.fileUrl" style="max-width: 100%;" [ngStyle]="{ \'max-height\': imageHeight }" />\r\n    </div>\r\n</ng-template>\r\n\r\n<div [ngClass]="{ \'divGrid\': inLine }" [ngStyle]="{ \'grid-template-columns\': inLine ? \'repeat(auto-fit, \' + borderWidth + \')\' : \'unset\' }">\r\n    \x3c!-- 上傳按鈕(前) --\x3e\r\n    <ng-container *ngIf="canUpload && showFrontButton">\r\n        <div *ngTemplateOutlet="Upload"></div>\r\n    </ng-container>\r\n\r\n    \x3c!-- 傳入的圖片 --\x3e\r\n    <ng-container *ngFor="let item of existFiles; let i = index">\r\n        <div *ngTemplateOutlet="imageTemplate || Image; context: {$implicit: { file: item, i: i }}"></div>\r\n    </ng-container>\r\n\r\n    \x3c!-- 上傳的圖片 --\x3e\r\n    <ng-container *ngFor="let item of showFiles; let i = index">\r\n        <div *ngTemplateOutlet="imageTemplate || Image; context: {$implicit: { file: item, i: i }}"></div>\r\n    </ng-container>\r\n\r\n    \x3c!-- 上傳按鈕(後) --\x3e\r\n    <ng-container *ngIf="canUpload && !showFrontButton">\r\n        <div *ngTemplateOutlet="Upload"></div>\r\n    </ng-container>\r\n    \r\n</div>\r\n\r\n<nz-modal [nzOkText]="null" nzCancelText="關閉" [nzWidth]="1000"\r\n        [nzTitle]="\'預覽圖\'" \r\n        [(nzVisible)]="viewImage.isVisabled" \r\n        (nzOnCancel)="controllModal(false, viewImage.image)">\r\n    <div class="divGridCenter">\r\n        <img [src]="viewImage.image.fileUrl" style="max-width: 100%; max-height: 500px;" />\r\n    </div>\r\n</nz-modal>',styles:[".divBorder{display:block;border:1px dashed #d9d9d9;background:#fafafa}.divGridCenter{display:grid!important;place-items:center}.divGrid{display:grid;grid-gap:1rem}.imgGrid{border:1px solid #ddd;background-color:#f9f9f9;position:relative;cursor:pointer}.imgGridClose{top:-7px;position:absolute;text-align:right;font-size:18px;color:rgba(0,0,0,.55);width:100%}.imgGridClose i{padding:3px;border-radius:2px;opacity:.8;z-index:10;background-color:#ddd}::ng-deep .ant-upload.ant-upload-select-picture-card{margin:unset!important}::ng-deep .ant-upload.ant-upload-select-picture-card>.ant-upload{padding:unset!important}"]}]}],W.ctorParameters=function(){return[{type:x.ToasterService},{type:n.EnvironmentService},{type:E}]},W.propDecorators={imageWidth:[{type:t.Input}],imageHeight:[{type:t.Input}],borderWidth:[{type:t.Input}],borderHeight:[{type:t.Input}],maxImageCount:[{type:t.Input}],isMultiple:[{type:t.Input}],imageTemplate:[{type:t.Input}],uploadTemplate:[{type:t.Input}],uploadTextTemplate:[{type:t.Input}],inLine:[{type:t.Input}],showFrontButton:[{type:t.Input}],existFiles:[{type:t.Input}]};var Q=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.fileName=e,this.fileUrl=t},K=function(e,t,n){this.fileName=e,this.fileUrl=t,this.file=n,this.isUpload=null!=this.file},_=function(){function e(e){var t=this;this.confirmationService=e,this.existFiles=[],this.fileList=[],this.beforeUpload=function(e){return t.existFiles.findIndex((function(t){return t.fileName==e.name}))>-1||t.fileList.findIndex((function(t){return t.name==e.name}))>-1||(t.fileList=t.fileList.concat(e)),!1}}return e.prototype.ngOnInit=function(){},e.prototype.delete=function(e){var t=this;this.confirmationService.warn("確認刪除嗎？","系統訊息").subscribe((function(n){n===x.Confirmation.Status.confirm&&(t.existFiles=t.existFiles.filter((function(t){return t!=e})))}))},e.prototype.getNewUploadFiles=function(){return this.fileList.map((function(e){return new K(e.name,"",e)}))},e}();_.decorators=[{type:t.Component,args:[{selector:"fs-upload-file",template:'\r\n\r\n<nz-upload nzType="drag" [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" [nzMultiple]="true">\r\n  <p class="ant-upload-drag-icon">\r\n    <i nz-icon nzType="inbox"></i>\r\n  </p>\r\n  <p class="ant-upload-text">點擊此處或將檔案拖拽至此處進行上傳</p>\r\n</nz-upload>\r\n\r\n<div class="my-md"></div>\r\n<nz-table #basicTable [nzData]="existFiles"  nzSimple="false" nzSize="small" [nzShowPagination]="false">\r\n  <thead>\r\n    <tr>\r\n      <th>檔名</th>\r\n      <th>-</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr *ngFor="let data of existFiles">\r\n      <td>\r\n        <a [href]="data.fileUrl">{{data.fileName}}</a>\r\n        \x3c!-- <a>{{ data }}</a> --\x3e\r\n      </td>\r\n      <td>\r\n        <a (click)="delete(data)" class="text-red">刪除</a>\r\n      </td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</nz-table>',styles:[""]}]}],_.ctorParameters=function(){return[{type:x.ConfirmationService}]},_.propDecorators={existFiles:[{type:t.Input}]};var J=function(){function e(e,t,n,r,i){var o=this;this.router=e,this.fileService=t,this.activatedRoute=n,this.pageService=r,this.confirmationService=i,this.dateRange=[new Date,new Date],this.defaultImages=[],this.defaultFiles=[],this.blogs=[],this.isLoading=!1,this.coverImage="",this.contentFileName="",this.blobToFile=function(e,t){return new File([e],t,{type:"text/plain;charset=utf-8"})},this.postId=this.activatedRoute.snapshot.paramMap.get("postId"),this.pageService.findByProviderByKeyAndGroup("FS.Cms.Posts",this.postId?this.postId:this.getRand()).subscribe((function(e){o.directory=e}))}return e.prototype.ngOnInit=function(){this.getPost(),this.getBlogs()},e.prototype.getPost=function(){var e=this;this.data={blogId:null,title:"",subtitle:"",url:"",content:"",disable:!1,startTime:"",endTime:"",displayMode:0,sequence:0,attachmentFileInfos:[],postImages:[]},this.contentFileName="",this.dateRange=[new Date,new Date],this.defaultImages=[],this.defaultFiles=[],this.coverImage="",this.postId&&this.pageService.getPostById(this.postId).subscribe((function(t){e.data=t;var n=t.startTime?new Date(t.startTime):new Date,r=t.endTime?new Date(t.endTime):new Date;e.dateRange=[n,r],e.defaultImages=t.postImages.map((function(e){return new V(e.name,e.imageId)})),e.defaultFiles=t.attachmentFileInfos.map((function(t){return new Q(t.name,e.fileService.getFileUrl(t.fileId))}));var i=t.postImages.findIndex((function(e){return e.isCover}));i>-1&&(e.coverImage=t.postImages[i].imageId),t.content&&(e.pageService.getFileDescriptor(t.content).subscribe((function(t){e.contentFileName=t.name})),e.fileService.getFileBlobById(t.content).subscribe((function(t){var n=new Blob([t],{type:"text/plain;charset=utf-8"}),r=new FileReader;r.onload=function(){e.data.content=r.result.toString()},r.readAsText(n)})))}))},e.prototype.getBlogs=function(){var e=this;this.pageService.getBlogs({skipCount:0,maxResultCount:999,sorting:"sequence"}).subscribe((function(t){e.blogs=t.items,e.postId||(e.data.blogId=e.activatedRoute.snapshot.queryParamMap.get("blogId"))}))},e.prototype.deleteFile=function(e){var t=this;this.confirmationService.warn("確定刪除 "+e+" 嗎？","系統訊息").subscribe((function(n){n==x.Confirmation.Status.confirm&&t.defaultImagePicker.deleteFile(e)}))},e.prototype.getRand=function(){return(Math.floor(100*Math.random())+1).toString()},e.prototype.save=function(){var e,t=this,n=M.cloneDeep(this.data);n.startTime=this.dateRange[0].toLocalISOString(),n.endTime=null===(e=this.dateRange[1])||void 0===e?void 0:e.toLocalISOString();var r=w.of("");if(n.displayMode==T.Fs.Cms.Posts.DisplayMode.內文){var i=new Blob([n.content],{type:"text/plain;charset=utf-8"}),o=C.format(new Date,"yyyyMMddHHmmss")+"-"+this.getRand()+".txt";this.contentFileName&&(o=this.contentFileName);var a=this.blobToFile(i,o);r=this.fileService.uploadFile(a,this.directory.id).pipe(P.map((function(e){return e.id})))}var s=this.uploadImage$(n),l=this.uploadFiles$(n);w.forkJoin([s,l,r]).subscribe((function(e){n.postImages=e[0],n.attachmentFileInfos=e[1],n.content=e[2],t.savePost(n)}))},e.prototype.uploadFiles$=function(e){var t=this,n=M.cloneDeep(e),r=this.defaultUploadFile.getNewUploadFiles(),i=this.defaultUploadFile.existFiles.map((function(e){return e.fileName}));if(n.attachmentFileInfos=n.attachmentFileInfos.filter((function(e){return i.some((function(t){return t==e.name}))})),0==r.length)return w.of(n.attachmentFileInfos);var o=r.map((function(e){return t.fileService.uploadFile(e.file,t.directory.id)}));return w.forkJoin(o).pipe(P.map((function(e){return e.map((function(e){return{name:e.name,fileId:e.id}})).concat(n.attachmentFileInfos)})))},e.prototype.uploadImage$=function(e){var t=this,n=M.cloneDeep(e),r=this.defaultImagePicker.getNewUploadFiles(),i=this.defaultImagePicker.existFiles.map((function(e){return e.fileName}));if(n.postImages=n.postImages.filter((function(e){return i.some((function(t){return t==e.name}))})),0==r.length)return w.of(n.postImages);var o=r.map((function(e){return t.fileService.uploadFile(e.file,t.directory.id)}));return w.forkJoin(o).pipe(P.map((function(e){return e.map((function(e){return{name:e.name,isCover:t.coverImage==e.name,imageId:e.id}})).concat(n.postImages)})))},e.prototype.savePost=function(e){var t=this;(this.postId?this.pageService.updatePost(this.postId,e):this.pageService.createPost(e)).subscribe((function(e){t.router.navigate(["cms/post"])}))},e}();J.decorators=[{type:t.Component,args:[{selector:"fs-detail",template:'<nz-spin nzTip="載入中..." [nzSpinning]="isLoading">\r\n\r\n  <nz-card>\r\n\r\n    <form nz-form #f="ngForm" se-container="1" labelWidth="150" *ngIf="data">\r\n      <se label="公告類型">\r\n        <nz-select [(ngModel)]="data.blogId" name="blogId" required>\r\n          <nz-option *ngFor="let item of blogs" [nzValue]="item.id" [nzLabel]="item.displayName"></nz-option>\r\n        </nz-select>\r\n      </se>\r\n      <se label="前台顯示" required>\r\n        <nz-radio-group [(ngModel)]="data.disable" name="disable">\r\n          <label nz-radio [nzValue]="false">開</label>\r\n          <label nz-radio [nzValue]="true">關</label>\r\n        </nz-radio-group>\r\n      </se>\r\n      <se label="發佈時間" required>\r\n        \x3c!-- <nz-range-picker nzShowTime nzFormat="yyyy/MM/dd HH:mm:ss" name="dateRange" [(ngModel)]="dateRange"\r\n          [nzAllowClear]="false"></nz-range-picker> --\x3e\r\n        <nz-date-picker nzShowTime name="startDate" [nzAllowClear]="false"\r\n          [(ngModel)]="dateRange[0]"></nz-date-picker>\r\n\r\n        <nz-date-picker nzShowTime name="endDate" [nzAllowClear]="true"\r\n          [(ngModel)]="dateRange[1]"></nz-date-picker>\r\n        \x3c!-- <nz-date-picker nzShowTime name="published_At" nzPlaceHolder="Select Time" [nzAllowClear]="false"\r\n          [(ngModel)]="data.published_At"></nz-date-picker> --\x3e\r\n      </se>\r\n      <se label="標題" error="必填" required>\r\n        <input type="text" nz-input [(ngModel)]="data.title" name="title" required>\r\n      </se>\r\n      <se label="副標題">\r\n        <input type="text" nz-input [(ngModel)]="data.subtitle" name="Subtitle">\r\n      </se>\r\n      <se label="顯示類型" required>\r\n        <nz-select [(ngModel)]="data.displayMode" name="type">\r\n          <nz-option [nzValue]="0" nzLabel="內文"></nz-option>\r\n          <nz-option [nzValue]="1" nzLabel="連結"></nz-option>\r\n        </nz-select>\r\n      </se>\r\n\r\n      <se label="內文" *ngIf="data.displayMode == 0">\r\n\r\n        <quill-editor [(ngModel)]="data.content" [ngModelOptions]="{standalone: true}">\r\n          \x3c!-- <div quill-editor-toolbar>\r\n            <span class="ql-formats">\r\n              <button class="ql-bold"></button>\r\n              <button class="ql-italic"></button>\r\n              <button class="ql-underline"></button>\r\n              <button class="ql-strike"></button>\r\n            </span>\r\n\r\n            <span class="ql-formats">\r\n              <button class="ql-list" value="ordered"></button>\r\n              <button class="ql-list" value="bullet"></button>\r\n            </span>\r\n\r\n            <span>\r\n              <button type="button" class="ql-header" value="1"></button>\r\n              <button type="button" class="ql-header" value="2"></button>\r\n            </span>\r\n\r\n            <span class="ql-formats">\r\n              <button class="ql-image"></button>\r\n            </span>\r\n\r\n          </div> --\x3e\r\n        </quill-editor>\r\n      </se>\r\n\r\n\r\n      <se label="連結" *ngIf="data.displayMode == 1">\r\n        <input type="text" nz-input [(ngModel)]="data.url" name="url">\r\n      </se>\r\n\r\n      <se label="上傳檔案" optionalHelp="建議圖片比例：1080X608">\r\n        <nz-tabset>\r\n          <nz-tab nzTitle="圖片">\r\n            <se>\r\n              <image-picker #DefaultImagePicker [existFiles]="defaultImages" [uploadTextTemplate]="Upload"\r\n                [imageTemplate]="Image" [inLine]="false" borderWidth="100%" borderHeight="132px"></image-picker>\r\n            </se>\r\n          </nz-tab>\r\n          <nz-tab nzTitle="附件">\r\n            <se>\r\n              <fs-upload-file  #DefaultUploadFile [existFiles]="defaultFiles"></fs-upload-file>\r\n            </se>\r\n          </nz-tab>\r\n        </nz-tabset>\r\n      </se>\r\n\r\n      \x3c!-- <se label="標籤">\r\n        <fs-tag [postId]="data.id" [postTags]="data.postTags"></fs-tag>\r\n      </se> --\x3e\r\n\r\n      <se>\r\n        <button nz-button nzType="primary" (click)="save()" [disabled]="f.invalid">\r\n          {{ !data.id ? \'建立\' : \'更新\' }}\r\n        </button>\r\n      </se>\r\n    </form>\r\n  </nz-card>\r\n\r\n</nz-spin>\r\n\r\n\r\n<ng-template #Upload>\r\n  <div style="text-align: center;">\r\n    <div style="color: #26d7eb; font-size: 48px;">\r\n      <i nz-icon nzType="inbox" style="display: block;"></i>\r\n    </div>\r\n    <div style="font-size: 16px;">\r\n      請將檔案拖移至此，或按下此圖示上傳檔案\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n\r\n<ng-template #Image let-item>\r\n  <div nz-row style="border: 1px solid #ddd; border-right: 0px; margin-top: 5px;">\r\n    <div nz-col nzSpan="4" class="imgItemDiv">\r\n      <a class="text-blue" *ngIf="coverImage != item.file.fileName" (click)="coverImage = item.file.fileName">設為封面圖</a>\r\n      <i nz-icon nzType="check" nzTheme="outline" style="font-size: 16px;" class="text-green"\r\n        *ngIf="coverImage == item.file.fileName"></i>\r\n    </div>\r\n    <div nz-col nzSpan="8" class="imgItemDiv" style="cursor: pointer;"\r\n      (click)="defaultImagePicker.controllModal(true, item.file)">\r\n      <div style="width: 100%;">\r\n        <img [src]="item.file.fileUrl" style="max-height: 40px;" />     \r\n      </div>\r\n    </div>\r\n    <div nz-col nzSpan="8" class="imgItemDiv">\r\n      <div style="width: 100%;">{{ item.file.fileName }}</div>\r\n    </div>\r\n    <div nz-col nzSpan="4" class="imgItemDiv">\r\n      <div style="width: 100%;">\r\n        <a class="text-red" (click)="deleteFile(item.file.fileName)">刪除</a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</ng-template>',styles:[".unchecked{border:1px solid #e4e4e4}.unchecked:hover{background-color:#00c1de;color:#fff}.imgItemDiv{border-right:1px solid #ddd;padding:5px;height:50px;display:grid;place-items:center}"]}]}],J.ctorParameters=function(){return[{type:r.Router},{type:E},{type:r.ActivatedRoute},{type:A},{type:x.ConfirmationService}]},J.propDecorators={defaultImagePicker:[{type:t.ViewChild,args:["DefaultImagePicker"]}],defaultUploadFile:[{type:t.ViewChild,args:["DefaultUploadFile"]}]};var X=function(){function e(e){this.postStateService=e}return e.prototype.resolve=function(){return this.postStateService.setBlog(null)},e}();X.decorators=[{type:t.Injectable}],X.ctorParameters=function(){return[{type:U}]};var Y=[{path:"",component:O,resolve:{RouteConfig:X},children:[{path:"",component:L},{path:"detail",component:J},{path:"detail/:postId",component:J}]}],Z=function(){};Z.decorators=[{type:t.NgModule,args:[{imports:[r.RouterModule.forChild(Y)],exports:[r.RouterModule],providers:[X]}]}];var ee=function(){function e(e,t,n,r,i,o,a,s,l,d){var p=this;this.router=e,this.extensionsService=t,this.pageService=n,this.injector=r,this.list=i,this.fileService=o,this.toasterService=a,this.activatedRoute=s,this.confirmationService=l,this.postStateService=d,this.datas=[],this.count=0,this.defaultImages=[],this.isVisible=!1,this.selected={},this.defaultSelectId=null,this.activatedRoute.queryParamMap.subscribe((function(e){p.defaultSelectId=e.get("blogId"),p.pageService.findByProviderByKeyAndGroup("FS.Cms.Blogs",p.defaultSelectId?p.defaultSelectId:p.getRand()).subscribe((function(e){p.directory=e}))}))}return e.prototype.ngOnDestroy=function(){this.sub&&this.sub.unsubscribe()},e.prototype.getRand=function(){return(Math.floor(100*Math.random())+1).toString()},e.prototype.ngOnInit=function(){var e=this;this.sub=this.extensionsService.Actions$["Cms::FS.Cms.Blogs"].subscribe((function(t){switch(t.name){case"Edit":e.edit(t.record.id);break;case"Delete":e.deleteBlog(t.record);break;case"Add":e.add()}})),this.reload()},e.prototype.reload=function(){var e=this,t={skipCount:0,maxResultCount:10,sorting:"sequence"};this.list.hookToQuery((function(n){return e.pageService.getBlogs(t)})).subscribe((function(t){if(e.datas=t.items,e.count=t.totalCount,e.defaultSelectId){var n=e.datas.find((function(t){return t.id==e.defaultSelectId}));e.showDetail(n)}}))},e.prototype.showDetail=function(e){if(null==e)return this.router.navigate(["./cms/post"]),void this.postStateService.setBlog(null);this.router.navigate(["./cms/post"],{queryParams:{blogId:e.id}}),this.postStateService.setBlog(e)},e.prototype.deleteBlog=function(e){var t=this;this.confirmationService.warn("確認要刪除嗎？(此Blog下的文章將移至不分類)","系統訊息",{cancelText:"取消",yesText:"確定"}).subscribe((function(n){n===x.Confirmation.Status.confirm&&t.pageService.deleteBlog(e.id).subscribe((function(e){t.toasterService.success("刪除成功！"),t.list.get(),t.router.navigate(["./cms/post"])}))}))},e.prototype.handleCancel=function(){this.isVisible=!1},e.prototype.save=function(){var e=this;if(this.form.valid){var t=this.defaultImagePicker.getDeleteFileNames();t.length>0?this.pageService.deleteFile(t[0]).subscribe((function(){e.uploadFile()})):this.uploadFile()}},e.prototype.uploadFile=function(){var e=this,t=this.defaultImagePicker.getUploadFiles(),n="";if(t.length>0){if(this.selected.iconUrl==t[0].fileName)return void this.saveBlog(this.selected.iconUrl);this.fileService.uploadFile(t[0].file,this.directory.id).subscribe((function(t){n=t.id,e.saveBlog(n)}))}else this.saveBlog("")},e.prototype.saveBlog=function(e){var t,n=this,r=Object.assign(Object.assign(Object.assign({},this.selected),this.form.value),{id:this.selected.id});r.iconUrl=e,r.id?t=this.pageService.updateBlog(r.id,r):(r.no=r.displayName,t=this.pageService.createBlog(r)),t.subscribe((function(e){n.toasterService.success("修改成功！"),n.isVisible=!1,n.list.get()}))},e.prototype.add=function(){this.selected={},this.defaultImages=[],this.openModal()},e.prototype.edit=function(e){var t=this;this.pageService.getBlogById(e).subscribe((function(e){t.selected=e,t.defaultImages=[],e.iconUrl&&t.defaultImages.push(new V(e.iconUrl,e.iconUrl)),t.openModal()}))},e.prototype.buildForm=function(){var e=new S.FormPropData(this.injector,this.selected);this.form=null,this.form=S.generateFormFromProps(e)},e.prototype.openModal=function(){this.buildForm(),this.isVisible=!0},e}();ee.decorators=[{type:t.Component,args:[{selector:"fs-list",template:'<div>\r\n  <div class="mb-md">   \r\n    <button nz-button [nzType]="\'primary\'"  style="margin-right: 10px;" (click)="add()"><span>+ {{\'AbpIdentityServer::Add\'|abpLocalization}}</span></button>\r\n    <button nz-button [nzType]="\'primary\'" (click)="showDetail(null)">\r\n      {{\'AbpPermissionManagement::All\'|abpLocalization}}\r\n    </button>\r\n  </div>\r\n\r\n  <nz-extensible-table [data]="datas" [defaultSelectId]="defaultSelectId" [recordsTotal]="count" [list]="list" [haveSelect]="true"\r\n    (select)="showDetail($event)">\r\n  </nz-extensible-table>\r\n\r\n</div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<nz-modal [(nzVisible)]="isVisible" nzTitle="blog" (nzOnCancel)="handleCancel()" [nzFooter]="footer">\r\n  <form [formGroup]="form" *ngIf="form" (ngSubmit)="save()" validateOnSubmit>\r\n    <abp-extensible-form *ngIf="form" [selectedRecord]="selected"></abp-extensible-form>\r\n    <div class="form-group">\r\n      <label for="exampleInputEmail1">圖示(建議圖片大小為 40*30，僅能上傳 jpg, png)</label>\r\n      <image-picker #DefaultImagePicker [existFiles]="defaultImages" [maxImageCount]="1" imageWidth="40px"\r\n        imageHeight="30px" borderWidth="80px" borderHeight="60px"></image-picker>\r\n    </div>\r\n  </form>\r\n</nz-modal>\r\n\r\n<ng-template #footer>\r\n  <button nz-button nzType="default" (click)="handleCancel()">取消</button>\r\n  <button nz-button nzType="primary" (click)="save()">儲存</button>\r\n</ng-template>',providers:[n.ListService,{provide:S.EXTENSIONS_IDENTIFIER,useValue:"Cms::FS.Cms.Blogs"}],styles:[".listSelected{background-color:#e6f2ff!important}nz-list-item{font-size:15px}.bg-white{background-color:#fff}"]}]}],ee.ctorParameters=function(){return[{type:r.Router},{type:F.ExtensionsService},{type:A},{type:t.Injector},{type:n.ListService},{type:E},{type:x.ToasterService},{type:r.ActivatedRoute},{type:x.ConfirmationService},{type:U}]},ee.propDecorators={defaultImagePicker:[{type:t.ViewChild,args:["DefaultImagePicker"]}]};var te=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();te.decorators=[{type:t.Component,args:[{selector:"fs-tag",template:'<br>\r\n\x3c!-- <label>搜尋標籤：</label>\r\n\r\n<nz-select nzSize=\'small\' [(ngModel)]="select" nzAllowClear nzShowSearch style="width: 200px;">\r\n    <nz-option-group *ngFor="let item of tagGroups" [nzLabel]="item.tagGroupName">\r\n        <nz-option *ngFor="let i of item.tags" [nzLabel]="i.name" [nzValue]="i.name"></nz-option>\r\n    </nz-option-group>\r\n</nz-select>\r\n<button nz-button nzType="primary" nzShape="circle"><i nz-icon nzType="search"></i></button> --\x3e\r\n\r\n\x3c!-- 只啟用以下 table --\x3e\r\n\x3c!-- <nz-table #smallTable nzBordered nzSize="small" [nzData]="tagGroups" style="width: 500px;" nzShowPagination="false"\r\n    style="margin-top: 10px;">\r\n    <thead>\r\n        <tr>\r\n            <th nzAlign="center">分類</th>\r\n            <th nzAlign="center">標籤</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr *ngFor="let tagGroup of smallTable.data; let parentIndex = index" class="bg-white">\r\n            <td>\r\n                <nz-tag [nzColor]="tagGroup.check? \'green\' : \'default\'" (click)="checkParent(tagGroup)" class="pointer">\r\n                    <i nz-icon [nzType]="tagGroup.check ? \'check\' : \'close\'"></i>\r\n                    {{ tagGroup.tagGroupName }}\r\n                </nz-tag>\r\n            </td>\r\n            <td>               \r\n                <nz-tag *ngFor="let tagItem of tagGroup.tags; let childIndex = index" class="pointer"\r\n                    [nzColor]="tagItem.check ? \'green\' : \'default\'" (click)="checkChild(tagItem)">\r\n                    <i nz-icon [nzType]="tagItem.check ? \'check\' : \'close\'"></i>\r\n                    {{ tagItem.name }}\r\n                </nz-tag>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n</nz-table> --\x3e\r\n\r\n\x3c!-- <button (click)="save()">check</button> --\x3e',styles:[""]}]}];var ne=[s.NzGridModule,l.NzInputModule,d.NzTableModule,p.NzDropDownModule,u.NzButtonModule,c.NzIconModule,g.NzModalModule,f.NzRadioModule,m.NzUploadModule,h.NzSpinModule,y.NzCardModule,v.NzSelectModule,b.NzDatePickerModule,z.NzTabsModule,I.SEModule],re=function(){function e(){}return e.forChild=function(){return{ngModule:e,providers:[]}},e.forLazy=function(){return new n.LazyModuleFactory(e.forChild())},e.forEarly=function(){return new n.LazyModuleFactory(e.forChild())},e}();re.decorators=[{type:t.NgModule,args:[{declarations:[O,L,J,ee,_,te,W],imports:q([j,n.CoreModule,o.ReactiveFormsModule,o.FormsModule,i.CommonModule,Z],ne,[a.QuillModule.forRoot()]),providers:[A]}]}];var ie=function(){function e(){this.allTagData=new w.Subject,this.tagData=new w.Subject,this.allTagData$=this.allTagData.asObservable(),this.tagData$=this.tagData.asObservable()}return e.prototype.getTageListFromApi=function(){},e.prototype.getTagOneFromApi=function(e){e||this.tagData.next(null)},e}();ie.decorators=[{type:t.Injectable}],ie.ctorParameters=function(){return[]};var oe=function(){function e(e,t){this.PageService=e,this.confirmation=t,this.tagGroupList=[]}return e.prototype.ngOnInit=function(){var e=this;this.subscription=this.PageService.allTagData$.subscribe((function(t){e.tagGroupList=t}))},e.prototype.deleteGroup=function(e){},e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},e}();oe.decorators=[{type:t.Component,args:[{template:'\r\n<nz-tabset nzType="card">\r\n  <nz-tab nzTitle="列表">\r\n    <nz-table #basicTable [nzData]="tagGroupList" nzSize="small" nzBordered>\r\n      <thead>\r\n        <tr>\r\n          <th nzWidth="75px"></th>\r\n          <th>名稱</th>\r\n          <th>項目</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr *ngFor="let tagGroup of basicTable.data" class="bg-white">\r\n          <td nzWidth="75px" nzAlign="center">\r\n            <a nz-dropdown [nzDropdownMenu]="menu">\r\n              操作\r\n              <i nz-icon nzType="down"></i>\r\n            </a>\r\n            <nz-dropdown-menu #menu="nzDropdownMenu">\r\n              <ul nz-menu nzSelectable>\r\n                <li nz-menu-item>\r\n                  <a class="text-blue" [routerLink]="tagGroup.id">編輯</a>\r\n                </li>\r\n                <li nz-menu-item><a class="text-red" (click)="deleteGroup(tagGroup.id)">刪除</a></li>\r\n              </ul>\r\n            </nz-dropdown-menu>\r\n          </td>\r\n          <td>{{ tagGroup.tagGroupName }}</td>\r\n          <td>\r\n            <nz-tag *ngFor="let tagItem of tagGroup.tags">\r\n              {{ tagItem.name }}\r\n            </nz-tag>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </nz-table>\r\n  </nz-tab>\r\n  <nz-tab nzTitle="新增">\r\n    <fs-tag-detail [isCreate]="true"></fs-tag-detail>\r\n  </nz-tab>\r\n</nz-tabset>',styles:[".bg-white{background-color:#fff}"]}]}],oe.ctorParameters=function(){return[{type:ie},{type:x.ConfirmationService}]};var ae=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();ae.decorators=[{type:t.Component,args:[{template:"\x3c!-- <fs-page-bar></fs-page-bar> --\x3e\r\n<router-outlet></router-outlet>",styles:[""]}]}],ae.ctorParameters=function(){return[]};var se=function(){function e(e,t,n){this.pageService=e,this.location=t,this.toasterService=n,this.isCreate=!1,this.deleteTargetTagIds=[],this.data={},this.inputList=[]}return e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},e.prototype.ngOnInit=function(){var e=this;this.subscription=this.pageService.tagData$.subscribe((function(t){e.data=t}))},e.prototype.addOption=function(){this.inputList.push()},e.prototype.removeOption=function(e){this.inputList.splice(e,1)},e.prototype.removeOldOption=function(e){this.deleteTargetTagIds.push(e)},e.prototype.save=function(){},e.prototype.update=function(){},e.prototype.updateTags=function(){},e.prototype.deleteTags=function(){},e.prototype.create=function(){},e.prototype.createTags=function(e){},e.prototype.clear=function(){},e}();se.decorators=[{type:t.Component,args:[{selector:"fs-tag-detail",template:'<nz-card>\r\n  <form nz-form #f="ngForm" se-container="1">\r\n    \x3c!-- <se label="名稱">\r\n      <input type="text" nz-input name="Createname" required [(ngModel)]="data.tagGroupName"  *ngIf="isCreate==false"/>\r\n      <input type="text" nz-input name="name" required [(ngModel)]="data.tagGroupName"   *ngIf="isCreate==true"/>\r\n    </se>\r\n\r\n    <se [label]="addItem" col="1">\r\n      <ng-template #addItem>\r\n        <button nz-button (click)="addOption()">新增項目</button>\r\n      </ng-template>\r\n      <div style="display: grid;grid-template-columns: repeat(auto-fill,200px);gap:8px" *ngIf="isCreate==false">\r\n        <div *ngFor="let inputItem of data.tags;let i = index">\r\n          <nz-input-group [nzAddOnBefore]="addOnBeforeTemplate">\r\n            <input nz-input [(ngModel)]="inputItem.name" [ngModelOptions]="{standalone: true}"/>\r\n          </nz-input-group>\r\n          <ng-template #addOnBeforeTemplate>\r\n            <i nz-icon nzType="close" class="pointer text-red" (click)="removeOldOption(inputItem.id)"></i>\r\n          </ng-template>\r\n        </div>\r\n      </div>\r\n\r\n      <div  style="display: grid;grid-template-columns: repeat(auto-fill,200px);gap:8px" >\r\n        <div *ngFor="let i of inputList">\r\n          <nz-input-group [nzAddOnBefore]="addOnBeforeTemplate">\r\n            <input nz-input [(ngModel)]="i.name"  [ngModelOptions]="{standalone: true}" />\r\n          </nz-input-group>\r\n\r\n          <ng-template #addOnBeforeTemplate>\r\n            <i nz-icon nzType="close" class="pointer text-red" (click)="removeOption(i)"></i>\r\n          </ng-template>\r\n        </div>\r\n      </div>\r\n    </se> --\x3e\r\n\r\n\r\n    <se>\r\n      <button nz-button nzType="primary" (click)="save()">存檔</button>\r\n    </se>\r\n  </form>\r\n</nz-card>',styles:[""]}]}],se.ctorParameters=function(){return[{type:ie},{type:i.Location},{type:x.ToasterService}]},se.propDecorators={isCreate:[{type:t.Input}]};var le=function(){function e(e){this.pageService=e}return e.prototype.resolve=function(){this.pageService.getTageListFromApi()},e}();le.decorators=[{type:t.Injectable}],le.ctorParameters=function(){return[{type:ie}]};var de=function(){function e(e){this.pageService=e}return e.prototype.resolve=function(e){var t=e.params.tagId;t&&this.pageService.getTagOneFromApi(t)},e}();de.decorators=[{type:t.Injectable}],de.ctorParameters=function(){return[{type:ie}]};var pe=[{path:"",component:ae,children:[{path:"",component:oe,resolve:{RouteConfig:le}},{path:":tagId",component:se,resolve:{DetailRouteConfig:de}}]}],ue=function(){};ue.decorators=[{type:t.NgModule,args:[{imports:[r.RouterModule.forChild(pe)],exports:[r.RouterModule],providers:[le,de]}]}];var ce=function(){function e(){}return e.forChild=function(){return{ngModule:e,providers:[]}},e.forLazy=function(){return new n.LazyModuleFactory(e.forChild())},e.forEarly=function(){return new n.LazyModuleFactory(e.forChild())},e}();ce.decorators=[{type:t.NgModule,args:[{declarations:[oe,ae,se],imports:[j,D.NzTagModule,ue],providers:[ie]}]}];var ge=re.forEarly,fe=ce.forEarly,me=[{path:"",pathMatch:"full",redirectTo:"post"},{path:"",canActivate:[n.AuthGuard,n.PermissionGuard],children:[{path:"post",loadChildren:ge},{path:"tag",loadChildren:fe}]}],he=function(){};he.decorators=[{type:t.NgModule,args:[{imports:[r.RouterModule.forChild(me)],exports:[r.RouterModule]}]}];var ye=function(){function e(){}return e.forChild=function(){return{ngModule:e,providers:[]}},e.forLazy=function(){return new n.LazyModuleFactory(e.forChild())},e}();ye.decorators=[{type:t.NgModule,args:[{imports:[j,n.CoreModule,he],exports:[j]}]}],e.CmsAdminModule=ye,e.FileService=E,e.GetFileByIdPipe=R,e.SharedModule=j,e.ɵa=he,e.ɵb=re,e.ɵc=O,e.ɵd=L,e.ɵe=A,e.ɵf=U,e.ɵg=J,e.ɵh=E,e.ɵi=ee,e.ɵj=_,e.ɵk=te,e.ɵl=W,e.ɵm=X,e.ɵn=Z,e.ɵo=ce,e.ɵp=oe,e.ɵq=ie,e.ɵr=ae,e.ɵs=se,e.ɵt=le,e.ɵu=de,e.ɵv=ue,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=fs-tw-cms-admin.umd.min.js.map