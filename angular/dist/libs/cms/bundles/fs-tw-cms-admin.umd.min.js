!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@abp/ng.core"),require("@angular/router"),require("@angular/common"),require("@angular/forms"),require("ngx-quill"),require("ng-zorro-antd/grid"),require("ng-zorro-antd/input"),require("ng-zorro-antd/table"),require("ng-zorro-antd/dropdown"),require("ng-zorro-antd/button"),require("ng-zorro-antd/icon"),require("ng-zorro-antd/modal"),require("ng-zorro-antd/radio"),require("ng-zorro-antd/upload"),require("ng-zorro-antd/spin"),require("ng-zorro-antd/card"),require("ng-zorro-antd/select"),require("ng-zorro-antd/date-picker"),require("ng-zorro-antd/tabs"),require("@delon/abc/se"),require("@abp/ng.theme.shared"),require("@abp/ng.theme.shared/extensions"),require("@fs-tw/cms/config"),require("rxjs"),require("@fs-tw/cms/proxy"),require("lodash"),require("date-fns"),require("@fs-tw/cms/admin/shared"),require("rxjs/operators"),require("ng-zorro-antd/tag")):"function"==typeof define&&define.amd?define("@fs-tw/cms/admin",["exports","@angular/core","@abp/ng.core","@angular/router","@angular/common","@angular/forms","ngx-quill","ng-zorro-antd/grid","ng-zorro-antd/input","ng-zorro-antd/table","ng-zorro-antd/dropdown","ng-zorro-antd/button","ng-zorro-antd/icon","ng-zorro-antd/modal","ng-zorro-antd/radio","ng-zorro-antd/upload","ng-zorro-antd/spin","ng-zorro-antd/card","ng-zorro-antd/select","ng-zorro-antd/date-picker","ng-zorro-antd/tabs","@delon/abc/se","@abp/ng.theme.shared","@abp/ng.theme.shared/extensions","@fs-tw/cms/config","rxjs","@fs-tw/cms/proxy","lodash","date-fns","@fs-tw/cms/admin/shared","rxjs/operators","ng-zorro-antd/tag"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["fs-tw"]=e["fs-tw"]||{},e["fs-tw"].cms=e["fs-tw"].cms||{},e["fs-tw"].cms.admin={}),e.ng.core,e.ng_core,e.ng.router,e.ng.common,e.ng.forms,e.ngxQuill,e.grid,e.input,e.table,e.dropdown,e.button,e.icon,e.modal,e.radio,e.upload,e.spin,e.card,e.select,e.datePicker,e.tabs,e.se,e.ng_theme_shared,e.extensions,e["fs-tw"].cms.config,e.rxjs,e["fs-tw"].cms.proxy,e._,e.dns,e["fs-tw"].cms.admin.shared,e.rxjs.operators,e.tag)}(this,(function(e,t,n,r,o,i,a,s,l,c,d,u,p,g,f,m,h,b,y,z,v,S,I,x,F,C,M,T,w,P,k,B){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function D(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}Object.create;var L=function(){function e(){this.store=new n.InternalStore({})}return e.prototype.getBlog=function(){return this.store.sliceState((function(e){return e.Blog}))},e.prototype.setBlog=function(e){this.store.patch({Blog:e})},e}();L.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new L},token:L,providedIn:"root"}),L.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}];var N=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();N.decorators=[{type:t.Component,args:[{selector:"fs-layout",template:"<router-outlet></router-outlet>\r\n",styles:[""]}]}],N.ctorParameters=function(){return[]};var A=function(){function e(e){this.injector=e,this.blogService=e.get(M.Fs.Cms.Blogs.BlogsApiService),this.postService=e.get(M.Fs.Cms.Posts.PostsApiService),this.directoriesApiService=e.get(M.Fs.Abp.File.Directories.DirectoriesApiService),this.fileDescriptorService=e.get(M.Volo.FileManagement.Files.FileDescriptorService)}return e.prototype.getBlogs=function(e){return this.blogService.getListByBlogGetList(e)},e.prototype.getBlogById=function(e){return this.blogService.getByBlogPrimaryKey({id:e})},e.prototype.createBlog=function(e){return this.blogService.createByBlogCreate(e)},e.prototype.updateBlog=function(e,t){return this.blogService.updateByBlogPrimaryKeyAndBlogUpdate({id:e},t)},e.prototype.deleteBlog=function(e){return this.blogService.deleteByBlogPrimaryKey({id:e})},e.prototype.findByProviderByKeyAndGroup=function(e,t){return this.directoriesApiService.findByProviderByKeyAndGroup(e,t)},e.prototype.deleteFile=function(e){return this.fileDescriptorService.deleteById(e)},e.prototype.getFileDescriptor=function(e){return this.fileDescriptorService.getById(e)},e.prototype.getPostsByBlogId=function(e){return this.postService.getPostsByBlogIdByInput(e)},e.prototype.getPostById=function(e){return this.postService.getByPostPrimaryKey({id:e})},e.prototype.createPost=function(e){return this.postService.createByPostCreate(e)},e.prototype.updatePost=function(e,t){return this.postService.updateByPostPrimaryKeyAndPostUpdate({id:e},t)},e.prototype.deletePost=function(e){return this.postService.deleteByPostPrimaryKey({id:e})},e}();A.decorators=[{type:t.Injectable}],A.ctorParameters=function(){return[{type:t.Injector}]};var q=function(){function e(e,t,n,r,o,i,a){this.extensionsService=e,this.router=t,this.toasterService=n,this.confirmationService=r,this.pageService=o,this.list=i,this.postStateService=a,this.postParams={skipCount:0,maxResultCount:10,keyword:"",blogId:null},this.posts=[],this.totalCount=0}return e.prototype.ngOnInit=function(){var e=this;this.extensionsService.Actions$["Cms::FS.Cms.PostManagement"].subscribe((function(t){switch(t.name){case"Edit":e.gotoDetail(t.record.id);break;case"Delete":e.deleteItem(t.record)}})),this.blog$=this.postStateService.getBlog(),this.onBlogChange()},e.prototype.onBlogChange=function(){var e=this;this.sub=this.blog$.subscribe((function(t){e.blogId=null==t?null:t.id,e.blogName=null==t?"全部":t.displayName,e.postParams.blogId=e.blogId,e.hookToQuery()}))},e.prototype.gotoDetail=function(e){e?this.router.navigate(["/cms/post/detail/"+e]):this.router.navigate(["/cms/post/detail"],{queryParams:{blogId:this.postParams.blogId}})},e.prototype.hookToQuery=function(){var e=this;this.hookToQueryScribe&&this.hookToQueryScribe.unsubscribe();this.hookToQueryScribe=this.list.hookToQuery((function(t){return t.keyword=e.postParams.keyword,t.blogId=e.postParams.blogId,e.pageService.getPostsByBlogId(t)})).subscribe((function(t){e.posts=t.items,e.totalCount=t.totalCount}))},e.prototype.deleteItem=function(e){var t=this;this.confirmationService.warn("確認要刪除嗎？","系統訊息",{cancelText:"取消",yesText:"確定"}).subscribe((function(n){if(n===I.Confirmation.Status.confirm){var r=e.attachmentFileInfos.map((function(e){return e.fileId})),o=e.postImages.map((function(e){return e.imageId})),i=r.concat(o).map((function(e){return t.pageService.deleteFile(e)}));C.forkJoin(i).subscribe(),t.pageService.deletePost(e.id).subscribe((function(e){t.toasterService.success("刪除成功！"),t.list.get()}))}}))},e.prototype.ngOnDestroy=function(){this.hookToQueryScribe&&this.hookToQueryScribe.unsubscribe(),this.sub&&this.sub.unsubscribe()},e}();q.decorators=[{type:t.Component,args:[{template:'<nz-row nzGutter="16">\r\n  <nz-col nzSpan="8">\r\n    <cms-list></cms-list>\r\n  </nz-col>\r\n  <nz-col nzSpan="16">\r\n    <div>\r\n      <div class="mb-md">\r\n        <h5>{{\'Cms::FS.Cms.BlogType\' | abpLocalization}}:{{ blogName }}</h5>\r\n        <button nz-button nzType="primary" (click)="gotoDetail()" style="margin-right: 20px;">\r\n          {{\'AbpIdentityServer::Add\'|abpLocalization}}\r\n        </button>\r\n        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton" style="width: 300px;">\r\n          <input type="text" [(ngModel)]="postParams.keyword" nz-input placeholder="輸入名稱" />\r\n        </nz-input-group>\r\n        <ng-template #suffixIconButton>\r\n          <button nz-button nzType="primary" (click)="hookToQuery()" nzSearch>\r\n            <i nz-icon nzType="search"></i>\r\n          </button>\r\n        </ng-template>\r\n      </div>\r\n      <nz-extensible-table [data]="posts" [scroll]="{x:\'600px\'}" [recordsTotal]="totalCount" [list]="list"\r\n        [haveRowDetail]="false">\r\n     \r\n        <ng-template row-detail-template let-node>\r\n          <div>\r\n            <h3>{{\'Cms::FS.Post.Subtitle\' | abpLocalization}}</h3>\r\n            <p>{{ node.subtitle || \'-\' }}</p>\r\n            <div *ngIf="node.displayMode == 0">\r\n              <h3>{{\'Cms::FS.Post.Content\' | abpLocalization}}</h3>\r\n              <quill-view [content]="node.content"></quill-view>\r\n            </div>\r\n            <div *ngIf="node.displayMode == 1">\r\n              <h3>{{\'Cms::FS.Post.Url\' | abpLocalization}}</h3>\r\n              <p>{{ node.url }}</p>\r\n            </div>\r\n          </div>\r\n        </ng-template>\r\n        \r\n      </nz-extensible-table>\r\n    </div>\r\n  </nz-col>\r\n</nz-row>',providers:[n.ListService,{provide:x.EXTENSIONS_IDENTIFIER,useValue:"Cms::FS.Cms.PostManagement"}],styles:["nz-select{margin-right:8px;width:220px}.bg-white{background-color:#fff}"]}]}],q.ctorParameters=function(){return[{type:F.ExtensionsService},{type:r.Router},{type:I.ToasterService},{type:I.ConfirmationService},{type:A},{type:n.ListService},{type:L}]};var O=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.fileName=e,this.fileUrl=t},R=function(e,t,n){this.fileName=e,this.fileUrl=t,this.file=n,this.isUpload=null!=this.file},U=function(){function e(e){var t=this;this.confirmationService=e,this.existFiles=[],this.fileList=[],this.beforeUpload=function(e){return t.existFiles.findIndex((function(t){return t.fileName==e.name}))>-1||t.fileList.findIndex((function(t){return t.name==e.name}))>-1||(t.fileList=t.fileList.concat(e)),!1}}return e.prototype.ngOnInit=function(){},e.prototype.delete=function(e){var t=this;this.confirmationService.warn("確認刪除嗎？","系統訊息").subscribe((function(n){n===I.Confirmation.Status.confirm&&(t.existFiles=t.existFiles.filter((function(t){return t!=e})))}))},e.prototype.getNewUploadFiles=function(){return this.fileList.map((function(e){return new R(e.name,"",e)}))},e}();U.decorators=[{type:t.Component,args:[{selector:"fs-upload-file",template:'\r\n\r\n<nz-upload nzType="drag" [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" [nzMultiple]="true">\r\n  <p class="ant-upload-drag-icon">\r\n    <i nz-icon nzType="inbox"></i>\r\n  </p>\r\n  <p class="ant-upload-text">點擊此處或將檔案拖拽至此處進行上傳</p>\r\n</nz-upload>\r\n\r\n<div class="my-md"></div>\r\n<nz-table #basicTable [nzData]="existFiles"  nzSimple="false" nzSize="small" [nzShowPagination]="false">\r\n  <thead>\r\n    <tr>\r\n      <th>檔名</th>\r\n      <th>-</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr *ngFor="let data of existFiles">\r\n      <td>\r\n        <a [href]="data.fileUrl">{{data.fileName}}</a>\r\n        \x3c!-- <a>{{ data }}</a> --\x3e\r\n      </td>\r\n      <td>\r\n        <a (click)="delete(data)" class="text-red">刪除</a>\r\n      </td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</nz-table>',styles:[""]}]}],U.ctorParameters=function(){return[{type:I.ConfirmationService}]},U.propDecorators={existFiles:[{type:t.Input}]};var G=function(){function e(e,t,n,r,o){var i=this;this.router=e,this.fileService=t,this.activatedRoute=n,this.pageService=r,this.confirmationService=o,this.dateRange=[new Date,new Date],this.defaultImages=[],this.defaultFiles=[],this.blogs=[],this.isLoading=!1,this.coverImage="",this.contentFileName="",this.blobToFile=function(e,t){return new File([e],t,{type:"text/plain;charset=utf-8"})},this.postId=this.activatedRoute.snapshot.paramMap.get("postId"),this.pageService.findByProviderByKeyAndGroup("FS.Cms.Posts",this.postId?this.postId:this.getRand()).subscribe((function(e){i.directory=e}))}return e.prototype.ngOnInit=function(){this.getPost(),this.getBlogs()},e.prototype.getPost=function(){var e=this;this.data={blogId:null,title:"",subtitle:"",url:"",content:"",disable:!1,startTime:"",endTime:"",displayMode:0,sequence:0,attachmentFileInfos:[],postImages:[]},this.contentFileName="",this.dateRange=[new Date,new Date],this.defaultImages=[],this.defaultFiles=[],this.coverImage="",this.postId&&this.pageService.getPostById(this.postId).subscribe((function(t){e.data=t;var n=t.startTime?new Date(t.startTime):new Date,r=t.endTime?new Date(t.endTime):new Date;e.dateRange=[n,r],e.defaultImages=t.postImages.map((function(e){return new P.ImageFile(e.name,e.imageId)})),e.defaultFiles=t.attachmentFileInfos.map((function(t){return new O(t.name,e.fileService.getFileUrl(t.fileId))}));var o=t.postImages.findIndex((function(e){return e.isCover}));o>-1&&(e.coverImage=t.postImages[o].imageId),t.content&&(e.pageService.getFileDescriptor(t.content).subscribe((function(t){e.contentFileName=t.name})),e.fileService.getFileBlobById(t.content).subscribe((function(t){var n=new Blob([t],{type:"text/plain;charset=utf-8"}),r=new FileReader;r.onload=function(){e.data.content=r.result.toString()},r.readAsText(n)})))}))},e.prototype.getBlogs=function(){var e=this;this.pageService.getBlogs({skipCount:0,maxResultCount:999,sorting:"sequence"}).subscribe((function(t){e.blogs=t.items,e.postId||(e.data.blogId=e.activatedRoute.snapshot.queryParamMap.get("blogId"))}))},e.prototype.deleteFile=function(e){var t=this;this.confirmationService.warn("確定刪除 "+e+" 嗎？","系統訊息").subscribe((function(n){n==I.Confirmation.Status.confirm&&t.defaultImagePicker.deleteFile(e)}))},e.prototype.getRand=function(){return(Math.floor(100*Math.random())+1).toString()},e.prototype.save=function(){var e,t=this,n=T.cloneDeep(this.data);n.startTime=this.dateRange[0].toLocalISOString(),n.endTime=null===(e=this.dateRange[1])||void 0===e?void 0:e.toLocalISOString();var r=C.of("");if(n.displayMode==M.Fs.Cms.Posts.DisplayMode.內文){var o=new Blob([n.content],{type:"text/plain;charset=utf-8"}),i=w.format(new Date,"yyyyMMddHHmmss")+"-"+this.getRand()+".txt";this.contentFileName&&(i=this.contentFileName);var a=this.blobToFile(o,i);r=this.fileService.uploadFile(a,this.directory.id).pipe(k.map((function(e){return e.id})))}var s=this.uploadImage$(n),l=this.uploadFiles$(n);C.forkJoin([s,l,r]).subscribe((function(e){n.postImages=e[0],n.attachmentFileInfos=e[1],n.content=e[2],t.savePost(n)}))},e.prototype.uploadFiles$=function(e){var t=this,n=T.cloneDeep(e),r=this.defaultUploadFile.getNewUploadFiles(),o=this.defaultUploadFile.existFiles.map((function(e){return e.fileName}));if(n.attachmentFileInfos=n.attachmentFileInfos.filter((function(e){return o.some((function(t){return t==e.name}))})),0==r.length)return C.of(n.attachmentFileInfos);var i=r.map((function(e){return t.fileService.uploadFile(e.file,t.directory.id)}));return C.forkJoin(i).pipe(k.map((function(e){return e.map((function(e){return{name:e.name,fileId:e.id}})).concat(n.attachmentFileInfos)})))},e.prototype.uploadImage$=function(e){var t=this,n=T.cloneDeep(e),r=this.defaultImagePicker.getNewUploadFiles(),o=this.defaultImagePicker.existFiles.map((function(e){return e.fileName}));if(n.postImages=n.postImages.filter((function(e){return o.some((function(t){return t==e.name}))})),0==r.length)return C.of(n.postImages);var i=r.map((function(e){return t.fileService.uploadFile(e.file,t.directory.id)}));return C.forkJoin(i).pipe(k.map((function(e){return e.map((function(e){return{name:e.name,isCover:t.coverImage==e.name,imageId:e.id}})).concat(n.postImages)})))},e.prototype.savePost=function(e){var t=this;(this.postId?this.pageService.updatePost(this.postId,e):this.pageService.createPost(e)).subscribe((function(e){t.router.navigate(["cms/post"])}))},e}();G.decorators=[{type:t.Component,args:[{selector:"fs-detail",template:'<nz-spin nzTip="{{\'Cms::FS.Message:Loading\' |abpLocalization }}" [nzSpinning]="isLoading">\r\n\r\n  <nz-card>\r\n\r\n    <form nz-form #f="ngForm" se-container="1" labelWidth="150" *ngIf="data">\r\n      <se label="{{\'Cms::FS.Cms.BlogType\'|abpLocalization}}">\r\n        <nz-select [(ngModel)]="data.blogId" name="blogId" required>\r\n          <nz-option *ngFor="let item of blogs" [nzValue]="item.id" [nzLabel]="item.displayName"></nz-option>\r\n        </nz-select>\r\n      </se>\r\n      <se label="{{\'Cms::FS.Blog.Enable\' |abpLocalization }}" required>\r\n        <nz-radio-group [(ngModel)]="data.disable" name="disable">\r\n          <label nz-radio [nzValue]="false">{{\'Cms::FS.Blog.Enable\' |abpLocalization }}</label>\r\n          <label nz-radio [nzValue]="true">{{\'Cms::FS.Blog.Disable\' |abpLocalization }}</label>\r\n        </nz-radio-group>\r\n      </se>\r\n      <se label="{{\'Cms::FS.Post.PublishDate\'  |abpLocalization}}" required>\r\n        \x3c!-- <nz-range-picker nzShowTime nzFormat="yyyy/MM/dd HH:mm:ss" name="dateRange" [(ngModel)]="dateRange"\r\n          [nzAllowClear]="false"></nz-range-picker> --\x3e\r\n        <nz-date-picker nzShowTime name="startDate" [nzAllowClear]="false"\r\n          [(ngModel)]="dateRange[0]"></nz-date-picker>\r\n\r\n        <nz-date-picker nzShowTime name="endDate" [nzAllowClear]="true"\r\n          [(ngModel)]="dateRange[1]"></nz-date-picker>\r\n        \x3c!-- <nz-date-picker nzShowTime name="published_At" nzPlaceHolder="Select Time" [nzAllowClear]="false"\r\n          [(ngModel)]="data.published_At"></nz-date-picker> --\x3e\r\n      </se>\r\n      <se label="{{\'Cms::FS.Post.Title\'  |abpLocalization}}" error="" required>\r\n        <input type="text" nz-input [(ngModel)]="data.title" name="title" required>\r\n      </se>\r\n      <se label="{{\'Cms::FS.Post.Subtitle\'  |abpLocalization}}">\r\n        <input type="text" nz-input [(ngModel)]="data.subtitle" name="Subtitle">\r\n      </se>\r\n      <se label="{{\'Cms::FS.Post.DisplayMode\'  |abpLocalization}}" required>\r\n        <nz-select [(ngModel)]="data.displayMode" name="type">\r\n          <nz-option [nzValue]="0" nzLabel="{{\'Cms::FS.Post.Content\'  |abpLocalization}}"></nz-option>\r\n          <nz-option [nzValue]="1" nzLabel="{{\'Cms::FS.Post.Url\'  |abpLocalization}}"></nz-option>\r\n        </nz-select>\r\n      </se>\r\n\r\n      <se label="{{\'Cms::FS.Post.Content\'  |abpLocalization}}" *ngIf="data.displayMode == 0">\r\n\r\n        <quill-editor [(ngModel)]="data.content" [ngModelOptions]="{standalone: true}">\r\n        </quill-editor>\r\n      </se>\r\n\r\n\r\n      <se label="{{\'Cms::FS.Post.Url\'  |abpLocalization}}" *ngIf="data.displayMode == 1">\r\n        <input type="text" nz-input [(ngModel)]="data.url" name="url">\r\n      </se>\r\n\r\n      <se label="{{\'Cms::FS.Post.AttachmentFileUrls\'  |abpLocalization}}" optionalHelp="  {{\'Cms::FS.Message:SuggestionImageSize\'| abpLocalization}}：1080X608">\r\n        <nz-tabset>\r\n          <nz-tab nzTitle="{{\'Cms::FS.Post.AttachmentImage\'  |abpLocalization}}">\r\n            <se>\r\n              <image-picker #DefaultImagePicker [existFiles]="defaultImages" [uploadTextTemplate]="Upload"\r\n                [imageTemplate]="Image" [inLine]="false" borderWidth="100%" borderHeight="132px"></image-picker>\r\n            </se>\r\n          </nz-tab>\r\n          <nz-tab nzTitle="{{\'Cms::FS.Post.AttachmentFile\'  |abpLocalization}}">\r\n            <se>\r\n              <fs-upload-file  #DefaultUploadFile [existFiles]="defaultFiles"></fs-upload-file>\r\n            </se>\r\n          </nz-tab>\r\n        </nz-tabset>\r\n      </se>\r\n\r\n      \x3c!-- <se label="標籤">\r\n        <fs-tag [postId]="data.id" [postTags]="data.postTags"></fs-tag>\r\n      </se> --\x3e\r\n\r\n      <se>\r\n        <button nz-button nzType="primary" (click)="save()" [disabled]="f.invalid">\r\n          {{ !data.id ? (\'AbpUi::Create\'  |abpLocalization) : (\'AbpUi::Save\'  |abpLocalization) }}\r\n        </button>\r\n      </se>\r\n    </form>\r\n  </nz-card>\r\n\r\n</nz-spin>\r\n\r\n\r\n<ng-template #Upload>\r\n  <div style="text-align: center;">\r\n    <div style="color: #26d7eb; font-size: 48px;">\r\n      <i nz-icon nzType="inbox" style="display: block;"></i>\r\n    </div>\r\n    <div style="font-size: 16px;">\r\n     {{\'Cms::FS.Message:DragOrClickHere\'| abpLocalization}}\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n\r\n<ng-template #Image let-item>\r\n  <div nz-row style="border: 1px solid #ddd; border-right: 0px; margin-top: 5px;">\r\n    <div nz-col nzSpan="4" class="imgItemDiv">\r\n      <a class="text-blue" *ngIf="coverImage != item.file.fileName" (click)="coverImage = item.file.fileName">{{\'Cms::FS.Post.SetAsCover\'  |abpLocalization}}</a>\r\n      <i nz-icon nzType="check" nzTheme="outline" style="font-size: 16px;" class="text-green"\r\n        *ngIf="coverImage == item.file.fileName"></i>\r\n    </div>\r\n    <div nz-col nzSpan="8" class="imgItemDiv" style="cursor: pointer;"\r\n      (click)="defaultImagePicker.controllModal(true, item.file)">\r\n      <div style="width: 100%;">\r\n        <img [src]="item.file.fileUrl" style="max-height: 40px;" />     \r\n      </div>\r\n    </div>\r\n    <div nz-col nzSpan="8" class="imgItemDiv">\r\n      <div style="width: 100%;">{{ item.file.fileName }}</div>\r\n    </div>\r\n    <div nz-col nzSpan="4" class="imgItemDiv">\r\n      <div style="width: 100%;">\r\n        <a class="text-red" (click)="deleteFile(item.file.fileName)">{{\'AbpUi::Delete\'  |abpLocalization}}</a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</ng-template>',styles:[".unchecked{border:1px solid #e4e4e4}.unchecked:hover{background-color:#00c1de;color:#fff}.imgItemDiv{border-right:1px solid #ddd;padding:5px;height:50px;display:grid;place-items:center}"]}]}],G.ctorParameters=function(){return[{type:r.Router},{type:P.FileService},{type:r.ActivatedRoute},{type:A},{type:I.ConfirmationService}]},G.propDecorators={defaultImagePicker:[{type:t.ViewChild,args:["DefaultImagePicker"]}],defaultUploadFile:[{type:t.ViewChild,args:["DefaultUploadFile"]}]};var j=function(){function e(e){this.postStateService=e}return e.prototype.resolve=function(){return this.postStateService.setBlog(null)},e}();j.decorators=[{type:t.Injectable}],j.ctorParameters=function(){return[{type:L}]};var E=[{path:"",component:N,resolve:{RouteConfig:j},children:[{path:"",component:q},{path:"detail",component:G},{path:"detail/:postId",component:G}]}],V=function(){};V.decorators=[{type:t.NgModule,args:[{imports:[r.RouterModule.forChild(E)],exports:[r.RouterModule],providers:[j]}]}];var $=function(){function e(e,t,n,r,o,i,a,s,l,c){var d=this;this.router=e,this.extensionsService=t,this.pageService=n,this.injector=r,this.list=o,this.fileService=i,this.toasterService=a,this.activatedRoute=s,this.confirmationService=l,this.postStateService=c,this.datas=[],this.count=0,this.defaultImages=[],this.isVisible=!1,this.selected={},this.defaultSelectId=null,this.activatedRoute.queryParamMap.subscribe((function(e){d.defaultSelectId=e.get("blogId"),d.pageService.findByProviderByKeyAndGroup("FS.Cms.Blogs",d.defaultSelectId?d.defaultSelectId:d.getRand()).subscribe((function(e){d.directory=e}))}))}return e.prototype.ngOnDestroy=function(){this.sub&&this.sub.unsubscribe()},e.prototype.getRand=function(){return(Math.floor(100*Math.random())+1).toString()},e.prototype.ngOnInit=function(){var e=this;this.sub=this.extensionsService.Actions$["Cms::FS.Cms.Blogs"].subscribe((function(t){switch(t.name){case"Edit":e.edit(t.record.id);break;case"Delete":e.deleteBlog(t.record);break;case"Add":e.add()}})),this.reload()},e.prototype.reload=function(){var e=this,t={skipCount:0,maxResultCount:10,sorting:"sequence"};this.list.hookToQuery((function(n){return e.pageService.getBlogs(t)})).subscribe((function(t){if(e.datas=t.items,e.count=t.totalCount,e.defaultSelectId){var n=e.datas.find((function(t){return t.id==e.defaultSelectId}));e.showDetail(n)}}))},e.prototype.showDetail=function(e){if(null==e)return this.router.navigate(["./cms/post"]),void this.postStateService.setBlog(null);this.router.navigate(["./cms/post"],{queryParams:{blogId:e.id}}),this.postStateService.setBlog(e)},e.prototype.deleteBlog=function(e){var t=this;this.confirmationService.warn("確認要刪除嗎？(此Blog下的文章將移至不分類)","系統訊息",{cancelText:"取消",yesText:"確定"}).subscribe((function(n){n===I.Confirmation.Status.confirm&&t.pageService.deleteBlog(e.id).subscribe((function(e){t.toasterService.success("刪除成功！"),t.list.get(),t.router.navigate(["./cms/post"])}))}))},e.prototype.handleCancel=function(){this.isVisible=!1},e.prototype.save=function(){var e=this;if(this.form.valid){var t=this.defaultImagePicker.getDeleteFileNames();t.length>0?this.pageService.deleteFile(t[0]).subscribe((function(){e.uploadFile()})):this.uploadFile()}},e.prototype.uploadFile=function(){var e=this,t=this.defaultImagePicker.getUploadFiles(),n="";if(t.length>0){if(this.selected.iconUrl==t[0].fileName)return void this.saveBlog(this.selected.iconUrl);this.fileService.uploadFile(t[0].file,this.directory.id).subscribe((function(t){n=t.id,e.saveBlog(n)}))}else this.saveBlog("")},e.prototype.saveBlog=function(e){var t,n=this,r=Object.assign(Object.assign(Object.assign({},this.selected),this.form.value),{id:this.selected.id});r.iconUrl=e,r.id?t=this.pageService.updateBlog(r.id,r):(r.no=r.displayName,t=this.pageService.createBlog(r)),t.subscribe((function(e){n.toasterService.success("修改成功！"),n.isVisible=!1,n.list.get()}))},e.prototype.add=function(){this.selected={},this.defaultImages=[],this.openModal()},e.prototype.edit=function(e){var t=this;this.pageService.getBlogById(e).subscribe((function(e){t.selected=e,t.defaultImages=[],e.iconUrl&&t.defaultImages.push(new P.ImageFile(e.iconUrl,e.iconUrl)),t.openModal()}))},e.prototype.buildForm=function(){var e=new x.FormPropData(this.injector,this.selected);this.form=null,this.form=x.generateFormFromProps(e)},e.prototype.openModal=function(){this.buildForm(),this.isVisible=!0},e}();$.decorators=[{type:t.Component,args:[{selector:"cms-list",template:'<div>\r\n  <div class="mb-md">   \r\n    <button nz-button [nzType]="\'primary\'"  style="margin-right: 10px;" (click)="add()"><span>+ {{\'AbpIdentityServer::Add\'|abpLocalization}}</span></button>\r\n    <button nz-button [nzType]="\'primary\'" (click)="showDetail(null)">\r\n      {{\'AbpPermissionManagement::All\'|abpLocalization}}\r\n    </button>\r\n  </div>\r\n\r\n  <nz-extensible-table [data]="datas" [defaultSelectId]="defaultSelectId" [recordsTotal]="count" [list]="list" [haveSelect]="true"\r\n    (select)="showDetail($event)">\r\n  </nz-extensible-table>\r\n\r\n</div>\r\n<nz-modal [(nzVisible)]="isVisible" nzTitle="blog" (nzOnCancel)="handleCancel()" [nzFooter]="footer">\r\n  <form [formGroup]="form" *ngIf="form" (ngSubmit)="save()" validateOnSubmit>\r\n    <abp-extensible-form *ngIf="form" [selectedRecord]="selected"></abp-extensible-form>\r\n    <div class="form-group">\r\n      <label for="exampleInputEmail1">{{\'Cms::FS.Message:Image\'|abpLocalization}}</label>\r\n      <image-picker #DefaultImagePicker [existFiles]="defaultImages" [maxImageCount]="1" imageWidth="40px"\r\n        imageHeight="30px" borderWidth="80px" borderHeight="60px"></image-picker>\r\n    </div>\r\n  </form>\r\n</nz-modal>\r\n\r\n<ng-template #footer>\r\n  <button nz-button nzType="default" (click)="handleCancel()">{{\'AbpUi::Cancel\' | abpLocalization}}</button>\r\n  <button nz-button nzType="primary" (click)="save()">{{\'AbpUi::Save\' | abpLocalization}}</button>\r\n</ng-template>',providers:[n.ListService,{provide:x.EXTENSIONS_IDENTIFIER,useValue:"Cms::FS.Cms.Blogs"}],styles:[".listSelected{background-color:#e6f2ff!important}nz-list-item{font-size:15px}.bg-white{background-color:#fff}"]}]}],$.ctorParameters=function(){return[{type:r.Router},{type:F.ExtensionsService},{type:A},{type:t.Injector},{type:n.ListService},{type:P.FileService},{type:I.ToasterService},{type:r.ActivatedRoute},{type:I.ConfirmationService},{type:L}]},$.propDecorators={defaultImagePicker:[{type:t.ViewChild,args:["DefaultImagePicker"]}]};var Q=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();Q.decorators=[{type:t.Component,args:[{selector:"fs-tag",template:'<br>\r\n\x3c!-- <label>搜尋標籤：</label>\r\n\r\n<nz-select nzSize=\'small\' [(ngModel)]="select" nzAllowClear nzShowSearch style="width: 200px;">\r\n    <nz-option-group *ngFor="let item of tagGroups" [nzLabel]="item.tagGroupName">\r\n        <nz-option *ngFor="let i of item.tags" [nzLabel]="i.name" [nzValue]="i.name"></nz-option>\r\n    </nz-option-group>\r\n</nz-select>\r\n<button nz-button nzType="primary" nzShape="circle"><i nz-icon nzType="search"></i></button> --\x3e\r\n\r\n\x3c!-- 只啟用以下 table --\x3e\r\n\x3c!-- <nz-table #smallTable nzBordered nzSize="small" [nzData]="tagGroups" style="width: 500px;" nzShowPagination="false"\r\n    style="margin-top: 10px;">\r\n    <thead>\r\n        <tr>\r\n            <th nzAlign="center">分類</th>\r\n            <th nzAlign="center">標籤</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr *ngFor="let tagGroup of smallTable.data; let parentIndex = index" class="bg-white">\r\n            <td>\r\n                <nz-tag [nzColor]="tagGroup.check? \'green\' : \'default\'" (click)="checkParent(tagGroup)" class="pointer">\r\n                    <i nz-icon [nzType]="tagGroup.check ? \'check\' : \'close\'"></i>\r\n                    {{ tagGroup.tagGroupName }}\r\n                </nz-tag>\r\n            </td>\r\n            <td>               \r\n                <nz-tag *ngFor="let tagItem of tagGroup.tags; let childIndex = index" class="pointer"\r\n                    [nzColor]="tagItem.check ? \'green\' : \'default\'" (click)="checkChild(tagItem)">\r\n                    <i nz-icon [nzType]="tagItem.check ? \'check\' : \'close\'"></i>\r\n                    {{ tagItem.name }}\r\n                </nz-tag>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n</nz-table> --\x3e\r\n\r\n\x3c!-- <button (click)="save()">check</button> --\x3e',styles:[""]}]}];var H=[s.NzGridModule,l.NzInputModule,c.NzTableModule,d.NzDropDownModule,u.NzButtonModule,p.NzIconModule,g.NzModalModule,f.NzRadioModule,m.NzUploadModule,h.NzSpinModule,b.NzCardModule,y.NzSelectModule,z.NzDatePickerModule,v.NzTabsModule,S.SEModule],K=function(){function e(){}return e.forChild=function(){return{ngModule:e,providers:[]}},e.forLazy=function(){return new n.LazyModuleFactory(e.forChild())},e.forEarly=function(){return new n.LazyModuleFactory(e.forChild())},e}();K.decorators=[{type:t.NgModule,args:[{declarations:[N,q,G,$,U,Q],imports:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(D(arguments[t]));return e}([P.SharedModule,n.CoreModule,i.ReactiveFormsModule,i.FormsModule,o.CommonModule,V],H,[a.QuillModule.forRoot()]),providers:[A]}]}];var _=function(){function e(){this.allTagData=new C.Subject,this.tagData=new C.Subject,this.allTagData$=this.allTagData.asObservable(),this.tagData$=this.tagData.asObservable()}return e.prototype.getTageListFromApi=function(){},e.prototype.getTagOneFromApi=function(e){e||this.tagData.next(null)},e}();_.decorators=[{type:t.Injectable}],_.ctorParameters=function(){return[]};var W=function(){function e(e,t){this.PageService=e,this.confirmation=t,this.tagGroupList=[]}return e.prototype.ngOnInit=function(){var e=this;this.subscription=this.PageService.allTagData$.subscribe((function(t){e.tagGroupList=t}))},e.prototype.deleteGroup=function(e){},e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},e}();W.decorators=[{type:t.Component,args:[{template:'\r\n<nz-tabset nzType="card">\r\n  <nz-tab nzTitle="列表">\r\n    <nz-table #basicTable [nzData]="tagGroupList" nzSize="small" nzBordered>\r\n      <thead>\r\n        <tr>\r\n          <th nzWidth="75px"></th>\r\n          <th>名稱</th>\r\n          <th>項目</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr *ngFor="let tagGroup of basicTable.data" class="bg-white">\r\n          <td nzWidth="75px" nzAlign="center">\r\n            <a nz-dropdown [nzDropdownMenu]="menu">\r\n              操作\r\n              <i nz-icon nzType="down"></i>\r\n            </a>\r\n            <nz-dropdown-menu #menu="nzDropdownMenu">\r\n              <ul nz-menu nzSelectable>\r\n                <li nz-menu-item>\r\n                  <a class="text-blue" [routerLink]="tagGroup.id">編輯</a>\r\n                </li>\r\n                <li nz-menu-item><a class="text-red" (click)="deleteGroup(tagGroup.id)">刪除</a></li>\r\n              </ul>\r\n            </nz-dropdown-menu>\r\n          </td>\r\n          <td>{{ tagGroup.tagGroupName }}</td>\r\n          <td>\r\n            <nz-tag *ngFor="let tagItem of tagGroup.tags">\r\n              {{ tagItem.name }}\r\n            </nz-tag>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </nz-table>\r\n  </nz-tab>\r\n  <nz-tab nzTitle="新增">\r\n    <fs-tag-detail [isCreate]="true"></fs-tag-detail>\r\n  </nz-tab>\r\n</nz-tabset>',styles:[".bg-white{background-color:#fff}"]}]}],W.ctorParameters=function(){return[{type:_},{type:I.ConfirmationService}]};var J=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();J.decorators=[{type:t.Component,args:[{template:"\x3c!-- <fs-page-bar></fs-page-bar> --\x3e\r\n<router-outlet></router-outlet>",styles:[""]}]}],J.ctorParameters=function(){return[]};var X=function(){function e(e,t,n){this.pageService=e,this.location=t,this.toasterService=n,this.isCreate=!1,this.deleteTargetTagIds=[],this.data={},this.inputList=[]}return e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},e.prototype.ngOnInit=function(){var e=this;this.subscription=this.pageService.tagData$.subscribe((function(t){e.data=t}))},e.prototype.addOption=function(){this.inputList.push()},e.prototype.removeOption=function(e){this.inputList.splice(e,1)},e.prototype.removeOldOption=function(e){this.deleteTargetTagIds.push(e)},e.prototype.save=function(){},e.prototype.update=function(){},e.prototype.updateTags=function(){},e.prototype.deleteTags=function(){},e.prototype.create=function(){},e.prototype.createTags=function(e){},e.prototype.clear=function(){},e}();X.decorators=[{type:t.Component,args:[{selector:"fs-tag-detail",template:'<nz-card>\r\n  <form nz-form #f="ngForm" se-container="1">\r\n    \x3c!-- <se label="名稱">\r\n      <input type="text" nz-input name="Createname" required [(ngModel)]="data.tagGroupName"  *ngIf="isCreate==false"/>\r\n      <input type="text" nz-input name="name" required [(ngModel)]="data.tagGroupName"   *ngIf="isCreate==true"/>\r\n    </se>\r\n\r\n    <se [label]="addItem" col="1">\r\n      <ng-template #addItem>\r\n        <button nz-button (click)="addOption()">新增項目</button>\r\n      </ng-template>\r\n      <div style="display: grid;grid-template-columns: repeat(auto-fill,200px);gap:8px" *ngIf="isCreate==false">\r\n        <div *ngFor="let inputItem of data.tags;let i = index">\r\n          <nz-input-group [nzAddOnBefore]="addOnBeforeTemplate">\r\n            <input nz-input [(ngModel)]="inputItem.name" [ngModelOptions]="{standalone: true}"/>\r\n          </nz-input-group>\r\n          <ng-template #addOnBeforeTemplate>\r\n            <i nz-icon nzType="close" class="pointer text-red" (click)="removeOldOption(inputItem.id)"></i>\r\n          </ng-template>\r\n        </div>\r\n      </div>\r\n\r\n      <div  style="display: grid;grid-template-columns: repeat(auto-fill,200px);gap:8px" >\r\n        <div *ngFor="let i of inputList">\r\n          <nz-input-group [nzAddOnBefore]="addOnBeforeTemplate">\r\n            <input nz-input [(ngModel)]="i.name"  [ngModelOptions]="{standalone: true}" />\r\n          </nz-input-group>\r\n\r\n          <ng-template #addOnBeforeTemplate>\r\n            <i nz-icon nzType="close" class="pointer text-red" (click)="removeOption(i)"></i>\r\n          </ng-template>\r\n        </div>\r\n      </div>\r\n    </se> --\x3e\r\n\r\n\r\n    <se>\r\n      <button nz-button nzType="primary" (click)="save()">存檔</button>\r\n    </se>\r\n  </form>\r\n</nz-card>',styles:[""]}]}],X.ctorParameters=function(){return[{type:_},{type:o.Location},{type:I.ToasterService}]},X.propDecorators={isCreate:[{type:t.Input}]};var Y=function(){function e(e){this.pageService=e}return e.prototype.resolve=function(){this.pageService.getTageListFromApi()},e}();Y.decorators=[{type:t.Injectable}],Y.ctorParameters=function(){return[{type:_}]};var Z=function(){function e(e){this.pageService=e}return e.prototype.resolve=function(e){var t=e.params.tagId;t&&this.pageService.getTagOneFromApi(t)},e}();Z.decorators=[{type:t.Injectable}],Z.ctorParameters=function(){return[{type:_}]};var ee=[{path:"",component:J,children:[{path:"",component:W,resolve:{RouteConfig:Y}},{path:":tagId",component:X,resolve:{DetailRouteConfig:Z}}]}],te=function(){};te.decorators=[{type:t.NgModule,args:[{imports:[r.RouterModule.forChild(ee)],exports:[r.RouterModule],providers:[Y,Z]}]}];var ne=function(){function e(){}return e.forChild=function(){return{ngModule:e,providers:[]}},e.forLazy=function(){return new n.LazyModuleFactory(e.forChild())},e.forEarly=function(){return new n.LazyModuleFactory(e.forChild())},e}();ne.decorators=[{type:t.NgModule,args:[{declarations:[W,J,X],imports:[P.SharedModule,B.NzTagModule,te],providers:[_]}]}];var re=K.forEarly,oe=ne.forEarly,ie=[{path:"",pathMatch:"full",redirectTo:"post"},{path:"",canActivate:[n.AuthGuard,n.PermissionGuard],children:[{path:"post",loadChildren:re},{path:"tag",loadChildren:oe}]}],ae=function(){};ae.decorators=[{type:t.NgModule,args:[{imports:[r.RouterModule.forChild(ie)],exports:[r.RouterModule]}]}];var se=function(){function e(){}return e.forChild=function(){return{ngModule:e,providers:[]}},e.forLazy=function(){return new n.LazyModuleFactory(e.forChild())},e}();se.decorators=[{type:t.NgModule,args:[{imports:[P.SharedModule,n.CoreModule,ae],exports:[P.SharedModule]}]}],e.CmsAdminModule=se,e.ɵa=ae,e.ɵb=K,e.ɵc=N,e.ɵd=q,e.ɵe=A,e.ɵf=L,e.ɵg=G,e.ɵh=$,e.ɵi=U,e.ɵj=Q,e.ɵk=j,e.ɵl=V,e.ɵm=ne,e.ɵn=W,e.ɵo=_,e.ɵp=J,e.ɵq=X,e.ɵr=Y,e.ɵs=Z,e.ɵt=te,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=fs-tw-cms-admin.umd.min.js.map