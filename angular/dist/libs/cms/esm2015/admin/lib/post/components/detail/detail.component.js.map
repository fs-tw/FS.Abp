{"version":3,"file":"detail.component.js","sourceRoot":"","sources":["../../../../../../../../../libs/cms/admin/src/lib/post/components/detail/detail.component.ts","../../../../../../../../../libs/cms/admin/src/lib/post/components/detail/detail.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\r\nimport { Confirmation, ConfirmationService, ToasterService } from '@abp/ng.theme.shared';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Observable } from 'rxjs';\r\nimport * as _ from 'lodash';\r\n\r\nimport { Fs } from '@fs-tw/cms/proxy';\r\n\r\nimport { PageService } from '../../providers/page.service';\r\nimport { ImageFile, ImagePickerComponent } from '../image-picker/image-picker.component';\r\n\r\n// import { ActivatedRoute, Router } from '@angular/router';\r\n// import { BlogDto, PostImageDto } from '@fs-tw/cms/proxy';\r\n// import { Confirmation, ConfirmationService, ToasterService } from '@abp/ng.theme.shared';\r\n// import { Store } from '@ngxs/store';\r\n// import { forkJoin, Observable } from 'rxjs';\r\n// import { FileService } from '@fs-tw/theme-core';\r\n// import { PageService } from '../../providers/page.service';\r\n// import { PostsStateService } from '../../providers/post/poststate.service';\r\n// import { UploadFileComponent } from '../upload-file/upload-file.component';\r\n// import { TagComponent } from '../tag/tag.component';\r\n// import { finalize } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'fs-detail',\r\n  templateUrl: './detail.component.html',\r\n  styleUrls: ['./detail.component.less']\r\n})\r\nexport class DetailComponent implements OnInit {\r\n  @ViewChild(\"DefaultImagePicker\") defaultImagePicker : ImagePickerComponent;\r\n\r\n  postId: string;\r\n  data: Fs.Cms.Posts.Dtos.PostDto;\r\n  dateRange: Date[] = [new Date(), new Date()];\r\n  defaultImages: ImageFile[] = [];\r\n\r\n  blogs: Fs.Cms.Blogs.Dtos.BlogDto[] = [];\r\n\r\n  isLoading: boolean = false;\r\n\r\n  coverImage: string = '';\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private activatedRoute: ActivatedRoute,\r\n    private pageService: PageService,\r\n    private confirmationService: ConfirmationService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.postId = this.activatedRoute.snapshot.paramMap.get('postId');\r\n    console.log(this.postId);\r\n\r\n    this.getPost();\r\n    this.getBlogs();\r\n  }\r\n\r\n  getPost() {\r\n    this.data = {\r\n      blogId: null,\r\n      title: '',\r\n      subtitle: '',\r\n      url: '',\r\n      content: '',\r\n      disable: false,\r\n      startTime: '',\r\n      endTime: '',\r\n      displayMode: 0,\r\n      sequence: 0,\r\n      attachmentFileUrls: [],\r\n      postImages: []\r\n    } as Fs.Cms.Posts.Dtos.PostDto;\r\n\r\n    this.dateRange = [new Date(), new Date()];\r\n\r\n    this.defaultImages = [new ImageFile('test', 'https://dummyimage.com/200x130/000/fff')];\r\n    this.coverImage = 'test'\r\n\r\n    if (this.postId) {\r\n      this.pageService.getPostById(this.postId).subscribe((x) => {\r\n        this.data = x;\r\n\r\n        let st = x.startTime ? new Date(x.startTime) : new Date();\r\n        let ed = x.endTime ? new Date(x.endTime) : new Date();\r\n        this.dateRange = [st, ed];\r\n\r\n        this.defaultImages = x.postImages.map(y => new ImageFile(y.url, y.url) );\r\n\r\n        let coverImageIndex = x.postImages.findIndex(y => y.isCover);\r\n        if (coverImageIndex > -1) this.coverImage = x.postImages[coverImageIndex].url;\r\n      })\r\n    }\r\n  }\r\n\r\n  getBlogs() {\r\n    let input = {\r\n      skipCount: 0,\r\n      maxResultCount: 999,\r\n      sorting: 'sequence'\r\n    } as Fs.Cms.Blogs.Dtos.BlogGetListDto;\r\n\r\n    this.pageService.getBlogs(input).subscribe((x) => {\r\n      this.blogs = x.items;\r\n    })\r\n  }\r\n\r\n  deleteFile(fileName: string) {\r\n    this.confirmationService.warn(`確定刪除 ${fileName} 嗎？`, \"系統訊息\")\r\n      .subscribe((result) => {\r\n        if (result != Confirmation.Status.confirm) return;\r\n\r\n        this.defaultImagePicker.deleteFile(fileName);\r\n      })\r\n  }\r\n\r\n  save() {\r\n    let item: Fs.Cms.Posts.Dtos.PostDto = _.cloneDeep(this.data);\r\n    item.startTime = this.dateRange[0].toLocalISOString();\r\n    item.endTime = this.dateRange[1].toLocalISOString();\r\n\r\n    // TODO: 上傳檔案、上傳附件、加標籤\r\n\r\n    let action: Observable<any>;\r\n    if (!this.postId) {\r\n      action = this.pageService.createPost(item);\r\n    } else {\r\n      action = this.pageService.updatePost(this.postId, item);\r\n    }\r\n\r\n    action.subscribe((x) => {\r\n      this.router.navigate([\"cms/post\"]);\r\n    })\r\n    \r\n  }\r\n\r\n  // apiUrl = \"\";\r\n  // @ViewChild(UploadFileComponent) uploadFileComponent: UploadFileComponent;\r\n\r\n  // @ViewChild(TagComponent) tagComponent: TagComponent;\r\n\r\n  // data: any =\r\n  //   { published: true, published_At: new Date(), attachmentFileUrls: [], content: \"\", postImages: [], postTags: [] };\r\n\r\n  // isVisible = false;\r\n  // selectImage = \"\";\r\n  // showList = [];\r\n  // fileList = [];\r\n  // isSpinning = false;\r\n  // blogs: BlogDto[] = []\r\n\r\n\r\n\r\n\r\n  // constructor(\r\n  //   private confirmationService: ConfirmationService,\r\n  //   private toasterService: ToasterService,\r\n  //   private postsStateService: PostsStateService,\r\n  //   private configStateService: ConfigStateService,\r\n  //   private activatedRoute: ActivatedRoute,\r\n  //   private pageService: PageService,\r\n  //   private fileService: FileService,\r\n  //   private environmentService:EnvironmentService,\r\n  //   private router: Router,\r\n  // ) {\r\n\r\n  //   this.apiUrl = this.environmentService.getApiUrl() + \"/\";\r\n  //   this.getBlogs();\r\n  //   this.activatedRoute.params.subscribe(x => {\r\n  //     if (x.id) {\r\n  //       this.isSpinning = true;\r\n  //       this.pageService.getPostById(x[\"id\"]).subscribe(post => {\r\n  //         this.data = post;\r\n  //         this.isSpinning = false;\r\n  //         this.init_list();\r\n  //       })\r\n  //     }\r\n  //   });\r\n  // }\r\n\r\n\r\n  // getBlogs() {\r\n  //   this.pageService.blogGetList().subscribe(x => {\r\n  //     this.blogs = x;\r\n  //   });\r\n  // }\r\n\r\n  // ngOnDestroy(): void { }\r\n\r\n  // ngOnInit() { }\r\n\r\n  // getUrl(x: string) {\r\n  //   if (x.includes('http')) {\r\n  //     return x;\r\n  //   } else {\r\n  //     return this.fileService.getFileByName(x);\r\n  //   }\r\n  // }\r\n\r\n  // getFileName(x: string) {\r\n  //   let splitStr = x.split(\"\\\\\");\r\n  //   return splitStr[splitStr.length - 1];\r\n  // }\r\n\r\n  // init_list() {\r\n  //   this.fileList = [];\r\n  //   this.showList = this.data.postImages.map((item, index) => {\r\n  //     return {\r\n  //       uid: index.toString(),\r\n  //       status: 'done',\r\n  //       type: \"image/jpeg\",\r\n  //       url: this.getUrl(item.url),\r\n  //       thumbUrl: this.getUrl(item.url),\r\n  //       needDelete: true,\r\n  //       isCover: item.isCover,\r\n  //       name: this.getFileName(item.url),\r\n  //       or_url: item.url\r\n  //     }\r\n  //   });\r\n  // }\r\n\r\n  // save() {\r\n  //   this.isSpinning = true\r\n  //   let mes = \"建立成功！\";\r\n  //   if (this.data.id) mes = \"更新成功！\";\r\n  //   let cover = this.showList.find(x => { return x.isCover == true });\r\n\r\n  //   let result = this.handleUpload()\r\n  //   let im: string[] = this.showList.map(x => x.or_url);\r\n  //   let old_images = this.data.postImages.filter(x => im.some(y => y == x.url));\r\n  //   this.data.postImages = result.concat(old_images);\r\n  //   if (cover) {\r\n  //     this.data.postImages.forEach(x => {\r\n  //       if (x.url.includes(cover.name)) x.isCover = true;\r\n  //       else x.isCover = false;\r\n  //     });\r\n  //   }\r\n  //   this.data.attachmentFileUrls = this.uploadFileComponent.save();\r\n  //   this.data.published_At = new Date(this.data.published_At).toLocalISOString();\r\n  //   let act: Observable<any>;\r\n  //   if (this.data.id) {\r\n  //     act = this.postsStateService.update(this.data, this.data.id);\r\n  //   } else {\r\n  //     act = this.postsStateService.create(this.data);\r\n  //   }\r\n  //   act.subscribe(x => {\r\n  //     forkJoin(this.tagComponent.save(x.id)).pipe(finalize(() => {\r\n  //       this.toasterService.success(mes);\r\n  //       this.isSpinning = false;\r\n  //       this.router.navigate([\"cms/post\"], { queryParams: { blog: this.data.blogCodeId } });\r\n  //     })).subscribe(x => { })\r\n  //   });\r\n  // }\r\n\r\n  // handleUpload(): PostImageDto[] {\r\n  //   const randomName = Array(32).fill(null).map(() => (Math.round(Math.random() * 16)).toString(16)).join('');\r\n  //   const formData = new FormData();\r\n  //   let postImageList: PostImageDto[] = []\r\n  //   this.fileList.forEach((file: any) => {\r\n  //     let url = `cms\\\\posts\\\\${randomName}\\\\${file.name}`;\r\n  //     postImageList.push({ url, isCover: false });\r\n  //     formData.append('files[]', file, url);\r\n  //   });\r\n  //   this.fileService.uploadFileByFormData(formData).subscribe(() => {\r\n  //   }, (error) => {\r\n  //     this.toasterService.error(\"上傳失敗\");\r\n  //   });\r\n\r\n  //   return postImageList;\r\n  // }\r\n\r\n  // refreshStatus(input) {\r\n  //   this.showList.forEach(x => {\r\n  //     if (x.uid != input.uid) x.isCover = false;\r\n  //   });\r\n  // }\r\n}\r\n","<nz-spin nzTip=\"載入中...\" [nzSpinning]=\"isLoading\">\r\n\r\n  <nz-card>\r\n\r\n    <form nz-form #f=\"ngForm\" se-container=\"1\" labelWidth=\"150\" *ngIf=\"data\">\r\n      <se label=\"公告類型\">\r\n        <nz-select [(ngModel)]=\"data.blogId\" name=\"blogId\" required>\r\n          <nz-option *ngFor=\"let item of blogs\" [nzValue]=\"item.id\" [nzLabel]=\"item.displayName\"></nz-option>\r\n        </nz-select>\r\n      </se>\r\n      <se label=\"前台顯示\" required>\r\n        <nz-radio-group [(ngModel)]=\"data.disable\" name=\"disable\">\r\n          <label nz-radio [nzValue]=\"false\">開</label>\r\n          <label nz-radio [nzValue]=\"true\">關</label>\r\n        </nz-radio-group>\r\n      </se>\r\n      <se label=\"發佈時間\" required>\r\n        <!-- <nz-range-picker nzShowTime nzFormat=\"yyyy/MM/dd HH:mm:ss\" name=\"dateRange\" [(ngModel)]=\"dateRange\"\r\n          [nzAllowClear]=\"false\"></nz-range-picker> -->\r\n        <nz-date-picker nzShowTime name=\"startDate\" [nzAllowClear]=\"false\"\r\n          [(ngModel)]=\"dateRange[0]\"></nz-date-picker>\r\n\r\n        <nz-date-picker nzShowTime name=\"endDate\" [nzAllowClear]=\"true\"\r\n          [(ngModel)]=\"dateRange[1]\"></nz-date-picker>\r\n        <!-- <nz-date-picker nzShowTime name=\"published_At\" nzPlaceHolder=\"Select Time\" [nzAllowClear]=\"false\"\r\n          [(ngModel)]=\"data.published_At\"></nz-date-picker> -->\r\n      </se>\r\n      <se label=\"標題\" error=\"必填\" required>\r\n        <input type=\"text\" nz-input [(ngModel)]=\"data.title\" name=\"title\" required>\r\n      </se>\r\n      <se label=\"副標題\">\r\n        <input type=\"text\" nz-input [(ngModel)]=\"data.subtitle\" name=\"Subtitle\">\r\n      </se>\r\n      <se label=\"顯示類型\" required>\r\n        <nz-select [(ngModel)]=\"data.displayMode\" name=\"type\">\r\n          <nz-option [nzValue]=\"0\" nzLabel=\"內文\"></nz-option>\r\n          <nz-option [nzValue]=\"1\" nzLabel=\"連結\"></nz-option>\r\n        </nz-select>\r\n      </se>\r\n\r\n      <se label=\"內文\" *ngIf=\"data.displayMode == 0\">\r\n\r\n        <quill-editor [(ngModel)]=\"data.content\" [ngModelOptions]=\"{standalone: true}\">\r\n          <div quill-editor-toolbar>\r\n            <span class=\"ql-formats\">\r\n              <button class=\"ql-bold\"></button>\r\n              <button class=\"ql-italic\"></button>\r\n              <button class=\"ql-underline\"></button>\r\n              <button class=\"ql-strike\"></button>\r\n            </span>\r\n\r\n            <span class=\"ql-formats\">\r\n              <button class=\"ql-list\" value=\"ordered\"></button>\r\n              <button class=\"ql-list\" value=\"bullet\"></button>\r\n            </span>\r\n\r\n            <span>\r\n              <button type=\"button\" class=\"ql-header\" value=\"1\"></button>\r\n              <button type=\"button\" class=\"ql-header\" value=\"2\"></button>\r\n            </span>\r\n\r\n            <span class=\"ql-formats\">\r\n              <button class=\"ql-image\"></button>\r\n            </span>\r\n\r\n          </div>\r\n        </quill-editor>\r\n      </se>\r\n\r\n\r\n      <se label=\"連結\" *ngIf=\"data.displayMode == 1\">\r\n        <input type=\"text\" nz-input [(ngModel)]=\"data.url\" name=\"url\">\r\n      </se>\r\n\r\n      <se label=\"上傳檔案\" optionalHelp=\"建議圖片比例：1080X608\">\r\n        <nz-tabset>\r\n          <nz-tab nzTitle=\"圖片\">\r\n            <se>\r\n              <image-picker #DefaultImagePicker [existFiles]=\"defaultImages\" [uploadTextTemplate]=\"Upload\"\r\n                [imageTemplate]=\"Image\" [inLine]=\"false\" borderWidth=\"100%\" borderHeight=\"132px\"></image-picker>\r\n            </se>\r\n          </nz-tab>\r\n          <nz-tab nzTitle=\"附件\">\r\n            <se>\r\n              <fs-upload-file [existFileUrls]=\"data.attachmentFileUrls\"></fs-upload-file>\r\n            </se>\r\n          </nz-tab>\r\n        </nz-tabset>\r\n      </se>\r\n\r\n      <!-- <se label=\"標籤\">\r\n        <fs-tag [postId]=\"data.id\" [postTags]=\"data.postTags\"></fs-tag>\r\n      </se> -->\r\n\r\n      <se>\r\n        <button nz-button nzType=\"primary\" (click)=\"save()\" [disabled]=\"f.invalid\">\r\n          {{ !data.id ? '建立' : '更新' }}\r\n        </button>\r\n      </se>\r\n    </form>\r\n  </nz-card>\r\n\r\n</nz-spin>\r\n\r\n\r\n<ng-template #Upload>\r\n  <div style=\"text-align: center;\">\r\n    <div style=\"color: #26d7eb; font-size: 48px;\">\r\n      <i nz-icon nzType=\"inbox\" style=\"display: block;\"></i>\r\n    </div>\r\n    <div style=\"font-size: 16px;\">\r\n      請將檔案拖移至此，或按下此圖示上傳檔案\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n\r\n<ng-template #Image let-item>\r\n  <div nz-row style=\"border: 1px solid #ddd; border-right: 0px; margin-top: 5px;\">\r\n    <div nz-col nzSpan=\"4\" class=\"imgItemDiv\">\r\n      <a class=\"text-blue\" *ngIf=\"coverImage != item.file.fileName\" (click)=\"coverImage = item.file.fileName\">設為封面圖</a>\r\n      <i nz-icon nzType=\"check\" nzTheme=\"outline\" style=\"font-size: 16px;\" class=\"text-green\"\r\n        *ngIf=\"coverImage == item.file.fileName\"></i>\r\n    </div>\r\n    <div nz-col nzSpan=\"8\" class=\"imgItemDiv\" style=\"cursor: pointer;\"\r\n      (click)=\"defaultImagePicker.controllModal(true, item.file)\">\r\n      <div style=\"width: 100%;\">\r\n        <img [src]=\"item.file.fileUrl\" style=\"max-height: 40px;\" />\r\n      </div>\r\n    </div>\r\n    <div nz-col nzSpan=\"8\" class=\"imgItemDiv\">\r\n      <div style=\"width: 100%;\">{{ item.file.fileName }}</div>\r\n    </div>\r\n    <div nz-col nzSpan=\"4\" class=\"imgItemDiv\">\r\n      <div style=\"width: 100%;\">\r\n        <a class=\"text-red\" (click)=\"deleteFile(item.file.fileName)\">刪除</a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</ng-template>"]}