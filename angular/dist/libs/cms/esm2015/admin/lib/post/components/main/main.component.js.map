{"version":3,"file":"main.component.js","sourceRoot":"","sources":["../../../../../../../../../libs/cms/admin/src/lib/post/components/main/main.component.ts","../../../../../../../../../libs/cms/admin/src/lib/post/components/main/main.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { Fs } from '@fs-tw/cms/proxy';\r\n\r\nimport { PageService } from '../../providers/page.service';\r\nimport { PostStateService } from '../../providers/post-state.service';\r\n\r\n// import { ActivatedRoute, Router } from '@angular/router';\r\n// import { PostWithDetailsDto } from '@fs-tw/cms/proxy';\r\n// import { CodesDto } from '@fs-tw/theme-core';\r\n// import { Confirmation, ConfirmationService, ToasterService } from '@abp/ng.theme.shared';\r\n// import { Select, Store } from '@ngxs/store';\r\n// import { Observable, Subscription } from 'rxjs';\r\n// import { Deletepost, GetPosts } from '../../providers/post/post.actions';\r\n// import { PostState } from '../../providers/post/post.state';\r\n// import { PostsStateService } from '../../providers/post/poststate.service';\r\n// import { PageService } from '../../providers/page.service';\r\n@Component({\r\n  selector: 'fs-main',\r\n  templateUrl: './main.component.html',\r\n  styleUrls: ['./main.component.less']\r\n})\r\nexport class MainComponent implements OnInit {\r\n\r\n  blog$: Observable<Fs.Cms.Blogs.Dtos.BlogDto>;\r\n  blogId: string;\r\n  blogName: string;\r\n\r\n  postParams: Fs.Cms.Posts.Dtos.GetPostByBlogIdInput = {\r\n    skipCount: 0,\r\n    maxResultCount: 10,\r\n    keyword: \"\",\r\n    blogId: null\r\n  } as Fs.Cms.Posts.Dtos.GetPostByBlogIdInput;\r\n\r\n  posts: Fs.Cms.Posts.Dtos.PostWithDetailsDto[] = [];\r\n  totalCount: number = 0;\r\n  loading: boolean = false;\r\n\r\n  constructor(\r\n    private pageService: PageService,\r\n    private postStateService: PostStateService\r\n  ) { }\r\n\r\n  \r\n\r\n  ngOnInit() {\r\n    this.blog$ = this.postStateService.getBlog();\r\n    this.onBlogChange();\r\n  }\r\n\r\n  onBlogChange() {\r\n    this.blog$.subscribe((blog) => {\r\n      this.blogId = blog == null ? null : blog.id;\r\n      this.blogName = blog == null ? \"\" : blog.displayName;\r\n\r\n      this.postParams.blogId = this.blogId;\r\n      this.changePage(1);\r\n    })\r\n  }\r\n\r\n  gotoDetail() {\r\n\r\n  }\r\n\r\n  changePage(page: number) {\r\n    this.postParams.skipCount = (page - 1) * this.postParams.maxResultCount;\r\n\r\n    this.loading = true;\r\n    this.pageService.getPostsByBlogId(this.postParams).subscribe((x) => {\r\n      this.loading = false;\r\n      this.posts = x.items;\r\n      this.totalCount = x.totalCount;\r\n    })\r\n  }\r\n\r\n  deleteItem(item: Fs.Cms.Posts.Dtos.PostWithDetailsDto) {\r\n\r\n  }\r\n\r\n  // ngOnDestroy(): void {\r\n  //   if (this.subscription) {\r\n  //     this.subscription.unsubscribe();\r\n  //   }\r\n  // }\r\n\r\n  // blogName: string = \"\";\r\n\r\n  // ngOnInit(): void {\r\n  //   this.subscription = this.activatedRoute.queryParams.subscribe(x => {\r\n  //     if (x.blog) {\r\n  //       this.blogId = x.blog\r\n  //       this.blogName = x.name;\r\n  //       if (x.blog == 'all') this.blogId = \"\";\r\n  //     } else {\r\n  //       let query = this.postsStateService.getPostQuery();\r\n  //       this.keyword = query.param.value;\r\n  //       this.blogId = query.param.blogCodeId\r\n  //       this.blogName = query.blogName;\r\n  //     }\r\n  //     this.changePage(1);\r\n  //   });\r\n  // }\r\n\r\n  // gotoDetail(id?: string) {\r\n  //   if (id) this.router.navigate([\"/cms/post/detail/\" + id]);\r\n  //   else this.router.navigate([\"/cms/post/detail\"]);\r\n  // }\r\n\r\n  // deleteItem(data: PostWithDetailsDto) {\r\n  //   this.confirmationService.warn(\r\n  //     `確定要刪除 ${data.title}嗎？`,\r\n  //     '系統訊息', {\r\n  //     cancelText: \"關閉\",\r\n  //     yesText: \"確定\"\r\n  //   }).subscribe((status: Confirmation.Status) => {\r\n  //     if (status === Confirmation.Status.confirm) {\r\n  //       this.store.dispatch(new Deletepost(data.id))\r\n  //       this.toasterService.success(\"刪除成功！\");\r\n  //     }\r\n  //   });\r\n  // }\r\n\r\n  // changePage(event: number) {\r\n  //   this.loading = true;\r\n  //   this.store.dispatch(\r\n  //     new GetPosts(\r\n  //       {\r\n  //         param: {\r\n  //           value: this.keyword,\r\n  //           fields: \"Title,Subtitle\",\r\n  //           blogCodeId: this.blogId,\r\n  //           skipCount: (event - 1) * 10,\r\n  //           maxResultCount: 10,\r\n  //           sorting: \"\"\r\n  //         },\r\n  //         blogName: this.blogName\r\n  //       }\r\n  //     )).subscribe(() => this.loading = false);\r\n  // }\r\n\r\n  // search() {\r\n  //   this.changePage(1);\r\n  // }\r\n\r\n}\r\n","<nz-row nzGutter=\"16\">\r\n  <nz-col nzSpan=\"8\">\r\n    <fs-list></fs-list>\r\n  </nz-col>\r\n  <nz-col nzSpan=\"16\">\r\n    <div>\r\n      <div class=\"mb-md\">\r\n        <h5>類型：{{ blogName }}</h5>\r\n        <button\r\n          nz-button\r\n          nzType=\"primary\"\r\n          (click)=\"gotoDetail()\"\r\n          style=\"margin-right: 20px;\"\r\n        >\r\n          新增\r\n        </button>\r\n        <nz-input-group\r\n          nzSearch\r\n          [nzAddOnAfter]=\"suffixIconButton\"\r\n          style=\"width: 300px;\"\r\n        >\r\n          <input\r\n            type=\"text\"\r\n            [(ngModel)]=\"postParams.keyword\"\r\n            nz-input\r\n            placeholder=\"輸入名稱\"\r\n          />\r\n        </nz-input-group>\r\n        <ng-template #suffixIconButton>\r\n          <button nz-button nzType=\"primary\" (click)=\"changePage(1)\" nzSearch>\r\n            <i nz-icon nzType=\"search\"></i>\r\n          </button>\r\n        </ng-template>\r\n      </div>\r\n      <nz-table\r\n        #listTable\r\n        [nzData]=\"posts\"\r\n        nzSize=\"small\"\r\n        nzPageSize=\"10\"\r\n        [nzTotal]=\"totalCount\"\r\n        [nzFrontPagination]=\"false\"\r\n        [nzLoading]=\"loading\"\r\n        (nzPageIndexChange)=\"changePage($event)\"\r\n        nzBordered\r\n      >\r\n        <thead>\r\n          <tr>\r\n            <th nzWidth=\"110px\"></th>\r\n            <th>啟用</th>\r\n            <th>標題</th>\r\n            <th>顯示模式</th>\r\n            <th>發佈日期</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <ng-container *ngFor=\"let item of listTable.data\">\r\n            <tr class=\"bg-white\">\r\n              <td nzShowExpand [(nzExpand)]=\"item.expand\" nzWidth=\"110px\">\r\n                <a nz-dropdown [nzDropdownMenu]=\"menu\">\r\n                  {{ 'AbpIdentity::Actions' | abpLocalization }}\r\n                  <i nz-icon nzType=\"down\"></i>\r\n                </a>\r\n                <nz-dropdown-menu #menu=\"nzDropdownMenu\">\r\n                  <ul nz-menu>\r\n                    <li nz-menu-item (click)=\"gotoDetail(item.id)\">\r\n                      <a>編輯</a>\r\n                    </li>\r\n                    <li nz-menu-item (click)=\"deleteItem(item)\">\r\n                      <a class=\"text-red\">刪除</a>\r\n                    </li>\r\n                  </ul>\r\n                </nz-dropdown-menu>\r\n              </td>\r\n              <td>\r\n                <span *ngIf=\"item.published\"\r\n                  ><i nz-icon nzType=\"check\" nzTheme=\"outline\"></i\r\n                ></span>\r\n                <span *ngIf=\"!item.published\"\r\n                  ><i nz-icon nzType=\"close\" nzTheme=\"outline\"></i\r\n                ></span>\r\n              </td>\r\n              <td>\r\n                {{ item.title }}\r\n              </td>\r\n              <td>\r\n                <span *ngIf=\"item.displayMode == 0\">內容</span>\r\n                <span *ngIf=\"item.displayMode == 1\">連結</span>\r\n              </td>\r\n              <td>{{ item.published_At | date: 'yyyy-MM-dd HH:mm:ss' }}</td>\r\n            </tr>\r\n\r\n            <tr [nzExpand]=\"item.expand\">\r\n              <div>\r\n                <h3>副標題</h3>\r\n                <p>{{ item.subtitle || '-' }}</p>\r\n                <div *ngIf=\"item.displayMode == 0\">\r\n                  <h3>內容：</h3>\r\n                  <quill-view [content]=\"item.content\"></quill-view>\r\n                </div>\r\n                <div *ngIf=\"item.displayMode == 1\">\r\n                  <h3>連結</h3>\r\n                  <p>{{ item.url }}</p>\r\n                </div>\r\n              </div>\r\n            </tr>\r\n          </ng-container>\r\n        </tbody>\r\n      </nz-table>\r\n    </div>\r\n  </nz-col>\r\n</nz-row>\r\n\r\n"]}