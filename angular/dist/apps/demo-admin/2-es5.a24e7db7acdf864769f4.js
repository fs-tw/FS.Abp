!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function t(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"wO+i":function(e,n,t){"use strict";t.d(n,"a",function(){return r});var i=t("lJxs");function r(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n.length;if(0===r)throw new Error("list of properties cannot be empty.");return function(e){return Object(i.a)(function(e,n){return function(t){for(var i=t,r=0;r<n;r++){var a=null!=i?i[e[r]]:void 0;if(void 0===a)return;i=a}return i}}(n,r))(e)}}},"x4+Y":function(n,t,a){"use strict";a.d(t,"a",function(){return B}),a.d(t,"b",function(){return q});var s=a("HmNo"),c=a("1REP"),o=a("fXoL"),l=a("AcyG"),u=a("mrSG"),b=a("LRne"),p=a("vkgz"),m=a("lJxs"),d=a("IzEk"),f=a("eIep"),v=a("nYR2"),h=a("wO+i"),g=a("ofXK"),y=a("3Pt+");function k(e,n){if(1&e&&(o.ac(0,"h4"),o.Sc(1),o.pc(2,"abpLocalization"),o.Zb()),2&e){var t=o.oc().ngIf;o.Gb(1),o.Vc(" ",o.qc(2,2,"AbpPermissionManagement::Permissions")," - ",t.entityName," ")}}function G(e,n){if(1&e){var t=o.bc();o.ac(0,"a",22),o.kc("click",function(){o.Ic(t);var e=o.oc().$implicit;return o.oc(3).onChangeGroup(e)}),o.ac(1,"div"),o.Sc(2),o.ac(3,"span"),o.Sc(4),o.Zb(),o.Zb(),o.Zb()}if(2&e){var i=n.ngIf,r=o.oc().$implicit,a=o.oc(3);o.Mb("active",(null==a.selectedGroup?null:a.selectedGroup.name)===(null==r?null:r.name)),o.Gb(1),o.Mb("font-weight-bold",i.assignedCount),o.Gb(1),o.Uc(" ",null==r?null:r.displayName," "),o.Gb(2),o.Uc("(",i.assignedCount,")")}}var O=function(e){return{assignedCount:e}};function S(e,n){if(1&e&&(o.ac(0,"li",20),o.Qc(1,G,5,6,"a",21),o.Zb()),2&e){var t=n.$implicit,i=o.oc(3);o.Gb(1),o.vc("ngIf",o.zc(1,O,i.getAssignedCount(t.name)))}}function C(e,n){if(1&e&&(o.ac(0,"span",28),o.Sc(1),o.Zb()),2&e){var t=n.$implicit;o.Gb(1),o.Vc("",t.providerName,": ",t.providerKey,"")}}function j(e,n){if(1&e&&(o.Yb(0),o.Qc(1,C,2,2,"span",27),o.Xb()),2&e){var t=o.oc().$implicit;o.Gb(1),o.vc("ngForOf",t.grantedProviders)}}function T(e,n){if(1&e){var t=o.bc();o.ac(0,"div",23),o.Vb(1,"input",24,25),o.ac(3,"label",26),o.kc("click",function(){o.Ic(t);var e=n.$implicit,i=o.Fc(2);return o.oc(3).onClickCheckbox(e,i.value)}),o.Sc(4),o.Qc(5,j,2,1,"ng-container",1),o.Zb(),o.Zb()}if(2&e){var i=n.$implicit,r=o.oc(3);o.vc("ngStyle",i.style),o.Gb(1),o.vc("checked",r.getChecked(i.name))("value",r.getChecked(i.name))("disabled",r.isGrantedByOtherProviderName(i.grantedProviders)),o.Hb("id",i.name),o.Gb(2),o.Hb("for",i.name),o.Gb(1),o.Uc("",i.displayName," "),o.Gb(1),o.vc("ngIf",!r.hideBadges)}}function N(e,n){if(1&e){var t=o.bc();o.ac(0,"div",5),o.ac(1,"input",6),o.kc("ngModelChange",function(e){return o.Ic(t),o.oc(2).selectAllTab=e})("click",function(){return o.Ic(t),o.oc(2).onClickSelectAll()}),o.Zb(),o.ac(2,"label",7),o.Sc(3),o.pc(4,"abpLocalization"),o.Zb(),o.Zb(),o.Vb(5,"hr",8),o.ac(6,"div",9),o.ac(7,"div",10),o.ac(8,"ul",11),o.Qc(9,S,2,3,"li",12),o.pc(10,"async"),o.Zb(),o.Zb(),o.ac(11,"div",13),o.ac(12,"h4"),o.Sc(13),o.Zb(),o.Vb(14,"hr",14),o.ac(15,"div",15),o.ac(16,"div",5),o.ac(17,"input",16),o.kc("ngModelChange",function(e){return o.Ic(t),o.oc(2).selectThisTab=e})("click",function(){return o.Ic(t),o.oc(2).onClickSelectThisTab()}),o.Zb(),o.ac(18,"label",17),o.Sc(19),o.pc(20,"abpLocalization"),o.Zb(),o.Zb(),o.Vb(21,"hr",18),o.Qc(22,T,6,8,"div",19),o.pc(23,"async"),o.Zb(),o.Zb(),o.Zb()}if(2&e){var i=o.oc(2);o.Gb(1),o.vc("ngModel",i.selectAllTab),o.Gb(2),o.Tc(o.qc(4,9,"AbpPermissionManagement::SelectAllInAllTabs")),o.Gb(6),o.vc("ngForOf",o.qc(10,11,i.groups$))("ngForTrackBy",i.trackByFn),o.Gb(4),o.Tc(null==i.selectedGroup?null:i.selectedGroup.displayName),o.Gb(4),o.vc("ngModel",i.selectThisTab),o.Gb(2),o.Tc(o.qc(20,13,"AbpPermissionManagement::SelectAllInThisTab")),o.Gb(3),o.vc("ngForOf",o.qc(23,15,i.selectedGroupPermissions$))("ngForTrackBy",i.trackByFn)}}function P(e,n){if(1&e){var t=o.bc();o.ac(0,"button",29,30),o.Sc(2),o.pc(3,"abpLocalization"),o.Zb(),o.ac(4,"abp-button",31),o.kc("click",function(){return o.Ic(t),o.oc(2).submit()}),o.Sc(5),o.pc(6,"abpLocalization"),o.Zb()}2&e&&(o.Gb(2),o.Uc(" ",o.qc(3,2,"AbpIdentity::Cancel")," "),o.Gb(3),o.Tc(o.qc(6,4,"AbpIdentity::Save")))}function w(e,n){1&e&&(o.Yb(0),o.Qc(1,k,3,4,"ng-template",null,2,o.Rc),o.Qc(3,N,24,17,"ng-template",null,3,o.Rc),o.Qc(5,P,7,6,"ng-template",null,4,o.Rc),o.Xb())}var A=function(e){return{entityName:e}},M=function(){var e=function e(n){r(this,e),this.payload=n};return e.type="[PermissionManagement] Get Permissions",e}(),x=function(){var e=function e(n){r(this,e),this.payload=n};return e.type="[PermissionManagement] Update Permissions",e}(),I=function(){var e=function e(n){var t=this;r(this,e),this.restService=n,this.apiName="AbpPermissionManagement",this.get=function(e,n){return t.restService.request({method:"GET",url:"/api/permission-management/permissions",params:{providerName:e,providerKey:n}},{apiName:t.apiName})},this.update=function(e,n,i){return t.restService.request({method:"PUT",url:"/api/permission-management/permissions",params:{providerName:e,providerKey:n},body:i},{apiName:t.apiName})}};return e.\u0275fac=function(n){return new(n||e)(o.hc(s.U))},e.\u0275prov=Object(o.Qb)({factory:function(){return new e(Object(o.hc)(s.U))},token:e,providedIn:"root"}),e}(),Z=function(){var e=function(){function e(n){r(this,e),this.service=n}return i(e,[{key:"permissionManagementGet",value:function(e,n){var t=e.patchState,i=n.payload,r=(i=void 0===i?{}:i).providerKey,a=i.providerName;return this.service.get(a,r).pipe(Object(p.a)(function(e){return t({permissionRes:e})}))}},{key:"permissionManagementUpdate",value:function(e,n){var t=n.payload;return this.service.update(t.providerName,t.providerKey,{permissions:t.permissions})}}],[{key:"getPermissionGroups",value:function(e){return e.permissionRes.groups||[]}},{key:"getEntityDisplayName",value:function(e){return e.permissionRes.entityDisplayName}}]),e}();return e.\u0275fac=function(n){return new(n||e)(o.hc(I))},e.\u0275prov=o.Qb({token:e,factory:function(n){return e.\u0275fac(n)}}),Object(u.b)([Object(l.a)(M)],e.prototype,"permissionManagementGet",null),Object(u.b)([Object(l.a)(x)],e.prototype,"permissionManagementUpdate",null),Object(u.b)([Object(l.e)()],e,"getPermissionGroups",null),Object(u.b)([Object(l.e)()],e,"getEntityDisplayName",null),e=Object(u.b)([Object(l.f)({name:"PermissionManagementState",defaults:{permissionRes:{}}})],e)}(),B=function(){var n=function(){function n(e,t,i){r(this,n),this.store=e,this.configState=t,this.appConfigService=i,this.hideBadges=!1,this._visible=!1,this.visibleChange=new o.q,this.permissions=[],this.selectThisTab=!1,this.selectAllTab=!1,this.modalBusy=!1,this.trackByFn=function(e,n){return n.name}}return i(n,[{key:"visible",get:function(){return this._visible},set:function(e){var n=this;e!==this._visible&&(e?this.openModal().subscribe(function(){n._visible=!0,n.visibleChange.emit(!0)}):(this.selectedGroup=null,this._visible=!1,this.visibleChange.emit(!1)))}},{key:"selectedGroupPermissions$",get:function(){var e=this,n="margin-".concat("rtl"===document.body.dir?"right":"left",".px");return this.groups$.pipe(Object(m.a)(function(n){return e.selectedGroup?n.find(function(n){return n.name===e.selectedGroup.name}).permissions:[]}),Object(m.a)(function(t){return t.map(function(i){return Object.assign(Object.assign({},i),{style:(r={},a=n,s=F(t,i),a in r?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s,r),isGranted:e.permissions.find(function(e){return e.name===i.name}).isGranted});var r,a,s})}))}},{key:"getChecked",value:function(e){return(this.permissions.find(function(n){return n.name===e})||{isGranted:!1}).isGranted}},{key:"isGrantedByOtherProviderName",value:function(e){var n=this;return!!e.length&&e.findIndex(function(e){return e.providerName!==n.providerName})>-1}},{key:"onClickCheckbox",value:function(e,n){var t=this;e.isGranted&&this.isGrantedByOtherProviderName(e.grantedProviders)||setTimeout(function(){t.permissions=t.permissions.map(function(n){return e.name===n.name?Object.assign(Object.assign({},n),{isGranted:!n.isGranted}):e.name===n.parentName&&e.isGranted?Object.assign(Object.assign({},n),{isGranted:!1}):e.parentName!==n.name||e.isGranted?n:Object.assign(Object.assign({},n),{isGranted:!0})}),t.setTabCheckboxState(),t.setGrantCheckboxState()},0)}},{key:"setTabCheckboxState",value:function(){var e=this;this.selectedGroupPermissions$.pipe(Object(d.a)(1)).subscribe(function(n){var t=n.filter(function(e){return e.isGranted}),i=document.querySelector("#select-all-in-this-tabs");t.length===n.length?(i.indeterminate=!1,e.selectThisTab=!0):0===t.length?(i.indeterminate=!1,e.selectThisTab=!1):i.indeterminate=!0})}},{key:"setGrantCheckboxState",value:function(){var e=this.permissions.filter(function(e){return e.isGranted}),n=document.querySelector("#select-all-in-all-tabs");e.length===this.permissions.length?(n.indeterminate=!1,this.selectAllTab=!0):0===e.length?(n.indeterminate=!1,this.selectAllTab=!1):n.indeterminate=!0}},{key:"onClickSelectThisTab",value:function(){var n=this;this.selectedGroupPermissions$.pipe(Object(d.a)(1)).subscribe(function(t){t.forEach(function(t){if(!t.isGranted||!n.isGrantedByOtherProviderName(t.grantedProviders)){var i=n.permissions.findIndex(function(e){return e.name===t.name});n.permissions=[].concat(e(n.permissions.slice(0,i)),[Object.assign(Object.assign({},n.permissions[i]),{isGranted:!n.selectThisTab})],e(n.permissions.slice(i+1)))}})}),this.setGrantCheckboxState()}},{key:"onClickSelectAll",value:function(){var e=this;this.permissions=this.permissions.map(function(n){return Object.assign(Object.assign({},n),{isGranted:e.isGrantedByOtherProviderName(n.grantedProviders)||!e.selectAllTab})}),this.selectThisTab=!this.selectAllTab}},{key:"onChangeGroup",value:function(e){this.selectedGroup=e,this.setTabCheckboxState()}},{key:"submit",value:function(){var e=this,n=$(this.store.selectSnapshot(Z.getPermissionGroups)),t=this.permissions.filter(function(e){return n.find(function(n){return n.name===e.name}).isGranted!==e.isGranted}).map(function(e){return{name:e.name,isGranted:e.isGranted}});t.length?(this.modalBusy=!0,this.store.dispatch(new x({providerKey:this.providerKey,providerName:this.providerName,permissions:t})).pipe(Object(f.a)(function(){return e.shouldFetchAppConfig()?e.appConfigService.get().pipe(Object(p.a)(function(n){return e.configState.setState(n)})):Object(b.a)(null)}),Object(v.a)(function(){return e.modalBusy=!1})).subscribe(function(){e.visible=!1})):this.visible=!1}},{key:"openModal",value:function(){var e=this;if(!this.providerKey||!this.providerName)throw new Error("Provider Key and Provider Name are required.");return this.store.dispatch(new M({providerKey:this.providerKey,providerName:this.providerName})).pipe(Object(h.a)("PermissionManagementState","permissionRes"),Object(p.a)(function(n){e.selectedGroup=n.groups[0],e.permissions=$(n.groups)}))}},{key:"initModal",value:function(){this.setTabCheckboxState(),this.setGrantCheckboxState()}},{key:"getAssignedCount",value:function(e){return this.permissions.reduce(function(n,t){return t.name.split(".")[0]===e&&t.isGranted?n+1:n},0)}},{key:"shouldFetchAppConfig",value:function(){var e=this,n=this.configState.getOne("currentUser");return"R"===this.providerName?n.roles.some(function(n){return n===e.providerKey}):"U"===this.providerName&&n.id===this.providerKey}}]),n}();return n.\u0275fac=function(e){return new(e||n)(o.Ub(l.g),o.Ub(s.m),o.Ub(s.b))},n.\u0275cmp=o.Ob({type:n,selectors:[["abp-permission-management"]],inputs:{hideBadges:"hideBadges",visible:"visible",providerName:"providerName",providerKey:"providerKey"},outputs:{visibleChange:"visibleChange"},exportAs:["abpPermissionManagement"],decls:3,vars:7,consts:[[3,"visible","busy","visibleChange","init"],[4,"ngIf"],["abpHeader",""],["abpBody",""],["abpFooter",""],[1,"custom-checkbox","custom-control","mb-2"],["type","checkbox","id","select-all-in-all-tabs","name","select-all-in-all-tabs",1,"custom-control-input",3,"ngModel","ngModelChange","click"],["for","select-all-in-all-tabs",1,"custom-control-label"],[1,"mt-2","mb-2"],[1,"row"],[1,"overflow-scroll","col-md-4"],[1,"nav","nav-pills","flex-column"],["class","nav-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-md-8","overflow-scroll"],[1,"mt-2","mb-3"],[1,"pl-1","pt-1"],["type","checkbox","id","select-all-in-this-tabs","name","select-all-in-this-tabs",1,"custom-control-input",3,"ngModel","ngModelChange","click"],["for","select-all-in-this-tabs",1,"custom-control-label"],[1,"mb-3"],["class","custom-checkbox custom-control mb-2",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"nav-item"],["class","nav-link pointer",3,"active","click",4,"ngIf"],[1,"nav-link","pointer",3,"click"],[1,"custom-checkbox","custom-control","mb-2",3,"ngStyle"],["type","checkbox",1,"custom-control-input",3,"checked","value","disabled"],["permissionCheckbox",""],[1,"custom-control-label",3,"click"],["class","badge badge-light",4,"ngFor","ngForOf"],[1,"badge","badge-light"],["type","button",1,"btn","btn-secondary"],["abpClose",""],["iconClass","fa fa-check",3,"click"]],template:function(e,n){1&e&&(o.ac(0,"abp-modal",0),o.kc("visibleChange",function(e){return n.visible=e})("init",function(){return n.initModal()}),o.Qc(1,w,7,0,"ng-container",1),o.pc(2,"async"),o.Zb()),2&e&&(o.vc("visible",n.visible)("busy",n.modalBusy),o.Gb(1),o.vc("ngIf",o.zc(5,A,o.qc(2,3,n.entityName$))))},directives:[c.i,g.q,y.c,y.q,y.t,g.p,g.r,c.b],pipes:[g.b,s.H],styles:[".overflow-scroll[_ngcontent-%COMP%] {\n        max-height: 70vh;\n        overflow-y: scroll;\n      }"]}),Object(u.b)([Object(l.d)(Z.getPermissionGroups)],n.prototype,"groups$",void 0),Object(u.b)([Object(l.d)(Z.getEntityDisplayName)],n.prototype,"entityName$",void 0),n}();function F(e,n){var t=e.find(function(e){return e.name===n.parentName});return t&&t.parentName?20+F(e,t):t?20:0}function $(n){return n.reduce(function(n,t){return[].concat(e(n),e(t.permissions))},[])}var q=function(){var e=function e(){r(this,e)};return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=o.Sb({type:e}),e.\u0275inj=o.Rb({imports:[[s.o,c.o,l.c.forFeature([Z])]]}),e}()}}])}();