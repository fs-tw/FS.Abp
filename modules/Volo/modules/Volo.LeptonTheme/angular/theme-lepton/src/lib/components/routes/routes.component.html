<div class="lp-sidebar-wrapper">
  <nav role="navigation" class="lp-sidebar-navi">
    <ul>
      <ng-container
        *ngFor="let route of routes.visible$ | async; trackBy: trackByFn"
        [ngTemplateOutlet]="isDropdown(route) ? dropdownLink : defaultLink"
        [ngTemplateOutletContext]="{ $implicit: route }"
      >
      </ng-container>

      <ng-template #defaultLink let-route>
        <li
          routerLinkActive="active-page current"
          [routerLinkActiveOptions]="{ exact: route.path === '/' }"
          *abpPermission="route.requiredPolicy"
          (click)="$event.stopPropagation(); onNavigate(route)"
        >
          <a [routerLink]="[route.path]" (click)="clickedToLink.emit()">
            <ng-container
              *ngTemplateOutlet="linkContent; context: { $implicit: route }"
            ></ng-container>
          </a>
        </li>
      </ng-template>

      <ng-template #linkContent let-route>
        <span *ngIf="route.iconClass" class="lp-icon">
          <i [ngClass]="route.iconClass"></i>
        </span>
        <span class="lp-text">
          {{ route.name | abpLocalization }}
        </span>
      </ng-template>

      <ng-template #dropdownLink let-route>
        <li
          *abpPermission="route.requiredPolicy"
          [abpVisibility]="routeContainer"
          class="has-drop"
          [class.current]="expandedRoutes.has(route.name)"
        >
          <a
            href="javascript:void(0)"
            (click)="
              $event.stopPropagation();
              isMenuPlacementTop && !smallScreen ? null : toggleExpand(route)
            "
          >
            <ng-container
              *ngTemplateOutlet="linkContent; context: { $implicit: route }"
            ></ng-container>

            <span class="lp-arrow-icon" [attr.for]="route.name">
              <i class="fa fa-chevron-down"></i>
            </span>
          </a>
          <ul
            class="dropdown-ul"
            [ngClass]="{
              'd-block overflow-hidden': isMenuPlacementTop && !smallScreen ? false : true
            }"
            [id]="route.name"
          >
            <div
              #routeContainer
              [@collapse]="
                !isMenuPlacementTop
                  ? expandedRoutes.has(route.name)
                    ? 'expanded'
                    : 'collapsed'
                  : ''
              "
            >
              <ng-container
                *ngFor="let child of route.children; trackBy: trackByFn"
                [ngTemplateOutlet]="dropdownMenu"
                [ngTemplateOutletContext]="{ $implicit: child }"
              ></ng-container>
            </div>
          </ul>
        </li>
      </ng-template>

      <ng-template #dropdownMenu let-route let-parentName="parentName">
        <ng-container
          *ngTemplateOutlet="
            isDropdown(route) ? dropdownLink : defaultLink;
            context: { $implicit: route }
          "
        ></ng-container>
      </ng-template>
    </ul>
  </nav>
</div>
