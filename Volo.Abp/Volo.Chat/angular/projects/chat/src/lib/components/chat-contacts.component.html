<div class="border-right">
  <div class="p-3 bg-light border-bottom">
    <div class="form-row">
      <div class="col">
        <input
          id="contacts-filter"
          type="search"
          class="form-control form-control-sm"
          autocomplete="off"
          spellcheck="false"
          [(ngModel)]="filter"
          [placeholder]="'Chat::SearchInContacts' | abpLocalization"
          [attr.aria-label]="'Chat::SearchInContacts' | abpLocalization"
          (input.debounce)="get()"
        />
      </div>
    </div>
  </div>

  <div class="messages-box m-0 p-0">
    <div class="list-group rounded-0" id="contact-list">
      <ng-container
        *ngFor="let contact of contacts; let i = index; trackBy: trackByUserId"
        [ngTemplateOutlet]="contactTemplate"
        [ngTemplateOutletContext]="{ $implicit: contact, index: i }"
      >
      </ng-container>
      <div
        *ngIf="otherContacts.length"
        class="list-group-item px-2 py-1 bg-light text-muted text-center font-size-sm text-uppercase border-left-0 border-right-0"
      >
        <small>{{ 'Chat::OtherContacts' | abpLocalization }}</small>
      </div>
      <ng-container
        *ngFor="let contact of otherContacts; let i = index; trackBy: trackByUserId"
        [ngTemplateOutlet]="contactTemplate"
        [ngTemplateOutletContext]="{ $implicit: contact, index: i }"
      >
      </ng-container>
    </div>
  </div>
</div>

<ng-template #contactTemplate let-contact let-i="index">
  <a
    (click)="selectContact(contact)"
    class="chat-contact list-group-item list-group-item-action px-4 rounded-0 border-left-0 pointer {{
      selectedContact.userId === contact.userId ? 'active text-white' : ''
    }}"
    ><div class="media">
      <abp-conversation-avatar [contact]="contact"></abp-conversation-avatar>
      <div class="media-body ml-2 d-none d-md-block">
        <div class="d-flex align-items-center justify-content-between mb-1">
          <h6 class="mb-0">
            <small *ngIf="contact.unreadMessageCount" class="badge badge-success mr-1">{{
              contact.unreadMessageCount
            }}</small
            >{{ getContactName(contact) }}
          </h6>
          <small class="small font-weight-bold last-message-date">{{
            contact.lastMessageDate | date
          }}</small>
        </div>
        <p class="mb-0 text-small last-message">
          {{
            contact.lastMessage.length > 24
              ? (contact.lastMessage | slice: 0:23) + '...'
              : contact.lastMessage
          }}
        </p>
      </div>
    </div>
  </a>
</ng-template>
