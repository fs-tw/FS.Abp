{"version":3,"file":"menu.provider.js","sourceRoot":"../../../../../libs/theme-alain/layout/src/","sources":["lib/providers/menu.provider.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AACzC,OAAO,EAAE,aAAa,EAAiB,gBAAgB,EAAE,iBAAiB,EAAE,MAAM,cAAc,CAAC;AACjG,OAAO,EAAE,eAAe,EAAE,MAAM,eAAe,CAAC;AAChD,OAAO,EAAE,WAAW,EAAQ,eAAe,EAAE,MAAM,cAAc,CAAC;AAElE,MAAM,CAAC,MAAM,qBAAqB,GAAG;IACnC;QACE,OAAO,EAAE,eAAe;QACxB,UAAU,EAAE,cAAc;QAC1B,IAAI,EAAE,CAAC,QAAQ,CAAC;QAChB,KAAK,EAAE,IAAI;KACZ;CACF,CAAC;AAEF,MAAM,UAAU,cAAc,CAAC,QAAkB;IAC/C,OAAO,GAAG,EAAE;QACV,MAAM,WAAW,GAAgB,QAAQ,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QAC3D,MAAM,MAAM,GAAkB,QAAQ,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QAC1D,MAAM,gBAAgB,GAAqB,QAAQ,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QAC1E,MAAM,iBAAiB,GAAsB,QAAQ,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QAC7E,MAAM,eAAe,GAAoB,QAAQ,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAEvE,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;YAC5B,WAAW,CAAC,KAAK,EAAE,CAAC;YACpB,IAAI,SAAS,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI,sCAAsC,IAAI,eAAe,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAC3G,IAAI,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE;gBACtC,OAAO,SAAS,CAAC,CAAC,CAAC,CAAC;YACtB,CAAC,CAAC,CAAC;YACH,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACzB,CAAC,CAAC,CAAA;QAEF,eAAe,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;YACnC,UAAU,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;QACrE,CAAC,CAAC,CAAC;QAGH,SAAS,SAAS,CAAC,IAAyB;YAC1C,MAAM,IAAI,GAAS;gBACjB,IAAI,EAAE,gBAAgB,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC;gBAC3C,IAAI,EAAE,IAAI,CAAC,IAAI;gBACf,IAAI,EAAE,IAAI,CAAC,SAAS;gBACpB,QAAQ,EAAE,EAAE;aACb,CAAA;YACD,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC3E,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;aACtD;YACD,OAAO,IAAI,CAAC;QAEd,CAAC;QACD,SAAS,eAAe,CAAC,cAAsB;YAC7C,IAAI,CAAC,CAAC,cAAc,EAAE;gBACpB,OAAO,iBAAiB,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;aAC3D;YACD,OAAO,IAAI,CAAC;QACd,CAAC;IAGH,CAAC,CAAC;AACJ,CAAC","sourcesContent":["import { Injector } from '@angular/core';\r\nimport { RoutesService, ABP, TreeNode, LocalizationPipe, PermissionService } from '@abp/ng.core';\r\nimport { APP_INITIALIZER } from '@angular/core';\r\nimport { MenuService, Menu, SettingsService } from '@delon/theme';\r\n\r\nexport const LAYOUT_MENU_PROVIDERS = [\r\n  {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: configureMenus,\r\n    deps: [Injector],\r\n    multi: true,\r\n  },\r\n];\r\n\r\nexport function configureMenus(injector: Injector) {\r\n  return () => {\r\n    const menuService: MenuService = injector.get(MenuService);\r\n    const routes: RoutesService = injector.get(RoutesService);\r\n    const localizationPipe: LocalizationPipe = injector.get(LocalizationPipe);\r\n    const permissionService: PermissionService = injector.get(PermissionService);\r\n    const settingsService: SettingsService = injector.get(SettingsService);\r\n\r\n    routes.visible$.subscribe(x => {\r\n      menuService.clear();\r\n      let condition = x => x.name == 'AbpUiNavigation::Menu:Administration' && isGrantedPolicy(x.requiredPolicy);\r\n      let menus = x.filter(condition).map(r => {\r\n        return mapToMenu(r);\r\n      });\r\n      menuService.add(menus);\r\n    })\r\n\r\n    settingsService.notify.subscribe(x => {\r\n      setTimeout(() => { window.dispatchEvent(new Event('resize')); }, 0)\r\n    });\r\n\r\n\r\n    function mapToMenu(item: TreeNode<ABP.Route>) {\r\n      const menu: Menu = {\r\n        text: localizationPipe.transform(item.name),\r\n        link: item.path,\r\n        icon: item.iconClass,\r\n        children: []\r\n      }\r\n      if (item.children.filter(x => isGrantedPolicy(x.requiredPolicy)).length > 0) {\r\n        menu.children = item.children.map(x => mapToMenu(x));\r\n      }\r\n      return menu;\r\n\r\n    }\r\n    function isGrantedPolicy(requiredPolicy: string) {\r\n      if (!!requiredPolicy) {\r\n        return permissionService.getGrantedPolicy(requiredPolicy);\r\n      }\r\n      return true;\r\n    }\r\n\r\n\r\n  };\r\n}"]}