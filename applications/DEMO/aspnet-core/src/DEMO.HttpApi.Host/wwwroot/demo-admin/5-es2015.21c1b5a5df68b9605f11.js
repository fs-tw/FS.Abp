(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"wO+i":function(e,t,i){"use strict";i.d(t,"a",function(){return n});var s=i("lJxs");function n(...e){const t=e.length;if(0===t)throw new Error("list of properties cannot be empty.");return i=>Object(s.a)(function(e,t){return i=>{let s=i;for(let n=0;n<t;n++){const t=null!=s?s[e[n]]:void 0;if(void 0===t)return;s=t}return s}}(e,t))(i)}},"x4+Y":function(e,t,i){"use strict";i.d(t,"a",function(){return A}),i.d(t,"b",function(){return B});var s=i("HmNo"),n=i("1REP"),c=i("fXoL"),r=i("AcyG"),a=i("mrSG"),o=i("LRne"),l=i("vkgz"),b=i("lJxs"),p=i("IzEk"),m=i("eIep"),d=i("nYR2"),u=i("wO+i"),h=i("ofXK"),g=i("3Pt+");function v(e,t){if(1&e&&(c.ac(0,"h4"),c.Sc(1),c.pc(2,"abpLocalization"),c.Zb()),2&e){const e=c.oc().ngIf;c.Gb(1),c.Vc(" ",c.qc(2,2,"AbpPermissionManagement::Permissions")," - ",e.entityName," ")}}function f(e,t){if(1&e){const e=c.bc();c.ac(0,"a",22),c.kc("click",function(){c.Ic(e);const t=c.oc().$implicit;return c.oc(3).onChangeGroup(t)}),c.ac(1,"div"),c.Sc(2),c.ac(3,"span"),c.Sc(4),c.Zb(),c.Zb(),c.Zb()}if(2&e){const e=t.ngIf,i=c.oc().$implicit,s=c.oc(3);c.Mb("active",(null==s.selectedGroup?null:s.selectedGroup.name)===(null==i?null:i.name)),c.Gb(1),c.Mb("font-weight-bold",e.assignedCount),c.Gb(1),c.Uc(" ",null==i?null:i.displayName," "),c.Gb(2),c.Uc("(",e.assignedCount,")")}}const y=function(e){return{assignedCount:e}};function G(e,t){if(1&e&&(c.ac(0,"li",20),c.Qc(1,f,5,6,"a",21),c.Zb()),2&e){const e=t.$implicit,i=c.oc(3);c.Gb(1),c.vc("ngIf",c.zc(1,y,i.getAssignedCount(e.name)))}}function k(e,t){if(1&e&&(c.ac(0,"span",28),c.Sc(1),c.Zb()),2&e){const e=t.$implicit;c.Gb(1),c.Vc("",e.providerName,": ",e.providerKey,"")}}function O(e,t){if(1&e&&(c.Yb(0),c.Qc(1,k,2,2,"span",27),c.Xb()),2&e){const e=c.oc().$implicit;c.Gb(1),c.vc("ngForOf",e.grantedProviders)}}function C(e,t){if(1&e){const e=c.bc();c.ac(0,"div",23),c.Vb(1,"input",24,25),c.ac(3,"label",26),c.kc("click",function(){c.Ic(e);const i=t.$implicit,s=c.Fc(2);return c.oc(3).onClickCheckbox(i,s.value)}),c.Sc(4),c.Qc(5,O,2,1,"ng-container",1),c.Zb(),c.Zb()}if(2&e){const e=t.$implicit,i=c.oc(3);c.vc("ngStyle",e.style),c.Gb(1),c.vc("checked",i.getChecked(e.name))("value",i.getChecked(e.name))("disabled",i.isGrantedByOtherProviderName(e.grantedProviders)),c.Hb("id",e.name),c.Gb(2),c.Hb("for",e.name),c.Gb(1),c.Uc("",e.displayName," "),c.Gb(1),c.vc("ngIf",!i.hideBadges)}}function S(e,t){if(1&e){const e=c.bc();c.ac(0,"div",5),c.ac(1,"input",6),c.kc("ngModelChange",function(t){return c.Ic(e),c.oc(2).selectAllTab=t})("click",function(){return c.Ic(e),c.oc(2).onClickSelectAll()}),c.Zb(),c.ac(2,"label",7),c.Sc(3),c.pc(4,"abpLocalization"),c.Zb(),c.Zb(),c.Vb(5,"hr",8),c.ac(6,"div",9),c.ac(7,"div",10),c.ac(8,"ul",11),c.Qc(9,G,2,3,"li",12),c.pc(10,"async"),c.Zb(),c.Zb(),c.ac(11,"div",13),c.ac(12,"h4"),c.Sc(13),c.Zb(),c.Vb(14,"hr",14),c.ac(15,"div",15),c.ac(16,"div",5),c.ac(17,"input",16),c.kc("ngModelChange",function(t){return c.Ic(e),c.oc(2).selectThisTab=t})("click",function(){return c.Ic(e),c.oc(2).onClickSelectThisTab()}),c.Zb(),c.ac(18,"label",17),c.Sc(19),c.pc(20,"abpLocalization"),c.Zb(),c.Zb(),c.Vb(21,"hr",18),c.Qc(22,C,6,8,"div",19),c.pc(23,"async"),c.Zb(),c.Zb(),c.Zb()}if(2&e){const e=c.oc(2);c.Gb(1),c.vc("ngModel",e.selectAllTab),c.Gb(2),c.Tc(c.qc(4,9,"AbpPermissionManagement::SelectAllInAllTabs")),c.Gb(6),c.vc("ngForOf",c.qc(10,11,e.groups$))("ngForTrackBy",e.trackByFn),c.Gb(4),c.Tc(null==e.selectedGroup?null:e.selectedGroup.displayName),c.Gb(4),c.vc("ngModel",e.selectThisTab),c.Gb(2),c.Tc(c.qc(20,13,"AbpPermissionManagement::SelectAllInThisTab")),c.Gb(3),c.vc("ngForOf",c.qc(23,15,e.selectedGroupPermissions$))("ngForTrackBy",e.trackByFn)}}function N(e,t){if(1&e){const e=c.bc();c.ac(0,"button",29,30),c.Sc(2),c.pc(3,"abpLocalization"),c.Zb(),c.ac(4,"abp-button",31),c.kc("click",function(){return c.Ic(e),c.oc(2).submit()}),c.Sc(5),c.pc(6,"abpLocalization"),c.Zb()}2&e&&(c.Gb(2),c.Uc(" ",c.qc(3,2,"AbpIdentity::Cancel")," "),c.Gb(3),c.Tc(c.qc(6,4,"AbpIdentity::Save")))}function T(e,t){1&e&&(c.Yb(0),c.Qc(1,v,3,4,"ng-template",null,2,c.Rc),c.Qc(3,S,24,17,"ng-template",null,3,c.Rc),c.Qc(5,N,7,6,"ng-template",null,4,c.Rc),c.Xb())}const j=function(e){return{entityName:e}};let P=(()=>{class e{constructor(e){this.payload=e}}return e.type="[PermissionManagement] Get Permissions",e})(),M=(()=>{class e{constructor(e){this.payload=e}}return e.type="[PermissionManagement] Update Permissions",e})(),w=(()=>{class e{constructor(e){this.restService=e,this.apiName="AbpPermissionManagement",this.get=(e,t)=>this.restService.request({method:"GET",url:"/api/permission-management/permissions",params:{providerName:e,providerKey:t}},{apiName:this.apiName}),this.update=(e,t,i)=>this.restService.request({method:"PUT",url:"/api/permission-management/permissions",params:{providerName:e,providerKey:t},body:i},{apiName:this.apiName})}}return e.\u0275fac=function(t){return new(t||e)(c.hc(s.U))},e.\u0275prov=Object(c.Qb)({factory:function(){return new e(Object(c.hc)(s.U))},token:e,providedIn:"root"}),e})(),x=(()=>{let e=class{constructor(e){this.service=e}static getPermissionGroups({permissionRes:e}){return e.groups||[]}static getEntityDisplayName({permissionRes:e}){return e.entityDisplayName}permissionManagementGet({patchState:e},{payload:{providerKey:t,providerName:i}={}}){return this.service.get(i,t).pipe(Object(l.a)(t=>e({permissionRes:t})))}permissionManagementUpdate(e,{payload:t}){return this.service.update(t.providerName,t.providerKey,{permissions:t.permissions})}};return e.\u0275fac=function(t){return new(t||e)(c.hc(w))},e.\u0275prov=c.Qb({token:e,factory:function(t){return e.\u0275fac(t)}}),Object(a.b)([Object(r.a)(P)],e.prototype,"permissionManagementGet",null),Object(a.b)([Object(r.a)(M)],e.prototype,"permissionManagementUpdate",null),Object(a.b)([Object(r.e)()],e,"getPermissionGroups",null),Object(a.b)([Object(r.e)()],e,"getEntityDisplayName",null),e=Object(a.b)([Object(r.f)({name:"PermissionManagementState",defaults:{permissionRes:{}}})],e),e})(),A=(()=>{class e{constructor(e,t,i){this.store=e,this.configState=t,this.appConfigService=i,this.hideBadges=!1,this._visible=!1,this.visibleChange=new c.q,this.permissions=[],this.selectThisTab=!1,this.selectAllTab=!1,this.modalBusy=!1,this.trackByFn=(e,t)=>t.name}get visible(){return this._visible}set visible(e){e!==this._visible&&(e?this.openModal().subscribe(()=>{this._visible=!0,this.visibleChange.emit(!0)}):(this.selectedGroup=null,this._visible=!1,this.visibleChange.emit(!1)))}get selectedGroupPermissions$(){const e=`margin-${"rtl"===document.body.dir?"right":"left"}.px`;return this.groups$.pipe(Object(b.a)(e=>this.selectedGroup?e.find(e=>e.name===this.selectedGroup.name).permissions:[]),Object(b.a)(t=>t.map(i=>Object.assign(Object.assign({},i),{style:{[e]:I(t,i)},isGranted:this.permissions.find(e=>e.name===i.name).isGranted}))))}getChecked(e){return(this.permissions.find(t=>t.name===e)||{isGranted:!1}).isGranted}isGrantedByOtherProviderName(e){return!!e.length&&e.findIndex(e=>e.providerName!==this.providerName)>-1}onClickCheckbox(e,t){e.isGranted&&this.isGrantedByOtherProviderName(e.grantedProviders)||setTimeout(()=>{this.permissions=this.permissions.map(t=>e.name===t.name?Object.assign(Object.assign({},t),{isGranted:!t.isGranted}):e.name===t.parentName&&e.isGranted?Object.assign(Object.assign({},t),{isGranted:!1}):e.parentName!==t.name||e.isGranted?t:Object.assign(Object.assign({},t),{isGranted:!0})),this.setTabCheckboxState(),this.setGrantCheckboxState()},0)}setTabCheckboxState(){this.selectedGroupPermissions$.pipe(Object(p.a)(1)).subscribe(e=>{const t=e.filter(e=>e.isGranted),i=document.querySelector("#select-all-in-this-tabs");t.length===e.length?(i.indeterminate=!1,this.selectThisTab=!0):0===t.length?(i.indeterminate=!1,this.selectThisTab=!1):i.indeterminate=!0})}setGrantCheckboxState(){const e=this.permissions.filter(e=>e.isGranted),t=document.querySelector("#select-all-in-all-tabs");e.length===this.permissions.length?(t.indeterminate=!1,this.selectAllTab=!0):0===e.length?(t.indeterminate=!1,this.selectAllTab=!1):t.indeterminate=!0}onClickSelectThisTab(){this.selectedGroupPermissions$.pipe(Object(p.a)(1)).subscribe(e=>{e.forEach(e=>{if(e.isGranted&&this.isGrantedByOtherProviderName(e.grantedProviders))return;const t=this.permissions.findIndex(t=>t.name===e.name);this.permissions=[...this.permissions.slice(0,t),Object.assign(Object.assign({},this.permissions[t]),{isGranted:!this.selectThisTab}),...this.permissions.slice(t+1)]})}),this.setGrantCheckboxState()}onClickSelectAll(){this.permissions=this.permissions.map(e=>Object.assign(Object.assign({},e),{isGranted:this.isGrantedByOtherProviderName(e.grantedProviders)||!this.selectAllTab})),this.selectThisTab=!this.selectAllTab}onChangeGroup(e){this.selectedGroup=e,this.setTabCheckboxState()}submit(){const e=Z(this.store.selectSnapshot(x.getPermissionGroups)),t=this.permissions.filter(t=>e.find(e=>e.name===t.name).isGranted!==t.isGranted).map(({name:e,isGranted:t})=>({name:e,isGranted:t}));t.length?(this.modalBusy=!0,this.store.dispatch(new M({providerKey:this.providerKey,providerName:this.providerName,permissions:t})).pipe(Object(m.a)(()=>this.shouldFetchAppConfig()?this.appConfigService.get().pipe(Object(l.a)(e=>this.configState.setState(e))):Object(o.a)(null)),Object(d.a)(()=>this.modalBusy=!1)).subscribe(()=>{this.visible=!1})):this.visible=!1}openModal(){if(!this.providerKey||!this.providerName)throw new Error("Provider Key and Provider Name are required.");return this.store.dispatch(new P({providerKey:this.providerKey,providerName:this.providerName})).pipe(Object(u.a)("PermissionManagementState","permissionRes"),Object(l.a)(e=>{this.selectedGroup=e.groups[0],this.permissions=Z(e.groups)}))}initModal(){this.setTabCheckboxState(),this.setGrantCheckboxState()}getAssignedCount(e){return this.permissions.reduce((t,i)=>i.name.split(".")[0]===e&&i.isGranted?t+1:t,0)}shouldFetchAppConfig(){const e=this.configState.getOne("currentUser");return"R"===this.providerName?e.roles.some(e=>e===this.providerKey):"U"===this.providerName&&e.id===this.providerKey}}return e.\u0275fac=function(t){return new(t||e)(c.Ub(r.g),c.Ub(s.m),c.Ub(s.b))},e.\u0275cmp=c.Ob({type:e,selectors:[["abp-permission-management"]],inputs:{hideBadges:"hideBadges",visible:"visible",providerName:"providerName",providerKey:"providerKey"},outputs:{visibleChange:"visibleChange"},exportAs:["abpPermissionManagement"],decls:3,vars:7,consts:[[3,"visible","busy","visibleChange","init"],[4,"ngIf"],["abpHeader",""],["abpBody",""],["abpFooter",""],[1,"custom-checkbox","custom-control","mb-2"],["type","checkbox","id","select-all-in-all-tabs","name","select-all-in-all-tabs",1,"custom-control-input",3,"ngModel","ngModelChange","click"],["for","select-all-in-all-tabs",1,"custom-control-label"],[1,"mt-2","mb-2"],[1,"row"],[1,"overflow-scroll","col-md-4"],[1,"nav","nav-pills","flex-column"],["class","nav-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-md-8","overflow-scroll"],[1,"mt-2","mb-3"],[1,"pl-1","pt-1"],["type","checkbox","id","select-all-in-this-tabs","name","select-all-in-this-tabs",1,"custom-control-input",3,"ngModel","ngModelChange","click"],["for","select-all-in-this-tabs",1,"custom-control-label"],[1,"mb-3"],["class","custom-checkbox custom-control mb-2",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"nav-item"],["class","nav-link pointer",3,"active","click",4,"ngIf"],[1,"nav-link","pointer",3,"click"],[1,"custom-checkbox","custom-control","mb-2",3,"ngStyle"],["type","checkbox",1,"custom-control-input",3,"checked","value","disabled"],["permissionCheckbox",""],[1,"custom-control-label",3,"click"],["class","badge badge-light",4,"ngFor","ngForOf"],[1,"badge","badge-light"],["type","button",1,"btn","btn-secondary"],["abpClose",""],["iconClass","fa fa-check",3,"click"]],template:function(e,t){1&e&&(c.ac(0,"abp-modal",0),c.kc("visibleChange",function(e){return t.visible=e})("init",function(){return t.initModal()}),c.Qc(1,T,7,0,"ng-container",1),c.pc(2,"async"),c.Zb()),2&e&&(c.vc("visible",t.visible)("busy",t.modalBusy),c.Gb(1),c.vc("ngIf",c.zc(5,j,c.qc(2,3,t.entityName$))))},directives:[n.h,h.q,g.c,g.q,g.t,h.p,h.r,n.b],pipes:[h.b,s.H],styles:[".overflow-scroll[_ngcontent-%COMP%] {\n        max-height: 70vh;\n        overflow-y: scroll;\n      }"]}),Object(a.b)([Object(r.d)(x.getPermissionGroups)],e.prototype,"groups$",void 0),Object(a.b)([Object(r.d)(x.getEntityDisplayName)],e.prototype,"entityName$",void 0),e})();function I(e,t){const i=e.find(e=>e.name===t.parentName);if(i&&i.parentName){let t=20;return t+=I(e,i)}return i?20:0}function Z(e){return e.reduce((e,t)=>[...e,...t.permissions],[])}let B=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.Sb({type:e}),e.\u0275inj=c.Rb({imports:[[s.o,n.n,r.c.forFeature([x])]]}),e})()}}]);